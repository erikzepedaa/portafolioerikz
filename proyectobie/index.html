
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../about/">
      
      
      
        
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.0">
    
    
      
        <title>Proyecto Balsa Stewart - Bitacora Web de Erik Zepeda</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.618322db.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.5.2/css/all.css">
    
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#proyecto-balsa-stewart" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Bitacora Web de Erik Zepeda" class="md-header__button md-logo" aria-label="Bitacora Web de Erik Zepeda" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Bitacora Web de Erik Zepeda
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Proyecto Balsa Stewart
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-hidden="true"  type="radio" name="__palette" id="__palette_0">
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Bitacora Web de Erik Zepeda" class="md-nav__button md-logo" aria-label="Bitacora Web de Erik Zepeda" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Bitacora Web de Erik Zepeda
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Vehículo Controlado por Bluetooth con Motores DC
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../Trabajo%203/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Control de Giro, Velocidad y Posición con ESP32
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../Trabajo2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Comunicación Bluetooth entre ESP32 y Celular
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../aa/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Encendido de LED con Pulsador usando Arduino
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../about/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ¿Quien soy?
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    Proyecto Balsa Stewart
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    Proyecto Balsa Stewart
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#resumen" class="md-nav__link">
    <span class="md-ellipsis">
      
        Resumen
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#objetivo-principal" class="md-nav__link">
    <span class="md-ellipsis">
      
        Objetivo Principal
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#objetivos-especificos" class="md-nav__link">
    <span class="md-ellipsis">
      
        Objetivos Específicos:
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#meta-de-la-practica" class="md-nav__link">
    <span class="md-ellipsis">
      
        Meta de la practica
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#organizacion-del-equipo" class="md-nav__link">
    <span class="md-ellipsis">
      
        Organización del Equipo
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#materiales-utilizados" class="md-nav__link">
    <span class="md-ellipsis">
      
        Materiales Utilizados
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tecnologias-utilizadas" class="md-nav__link">
    <span class="md-ellipsis">
      
        Tecnologías Utilizadas
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sistema-electronico" class="md-nav__link">
    <span class="md-ellipsis">
      
        Sistema Electrónico
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#diseno-electrico-y-consideraciones" class="md-nav__link">
    <span class="md-ellipsis">
      
        Diseño eléctrico y consideraciones
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ingenieria-de-la-carcasa" class="md-nav__link">
    <span class="md-ellipsis">
      
        Ingeniería de la carcasa
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#programacion" class="md-nav__link">
    <span class="md-ellipsis">
      
        Programación
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#resultados-y-observaciones" class="md-nav__link">
    <span class="md-ellipsis">
      
        Resultados y Observaciones
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#evidencias" class="md-nav__link">
    <span class="md-ellipsis">
      
        Evidencias
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#piezas-disenadas-en-stl" class="md-nav__link">
    <span class="md-ellipsis">
      
        Piezas Diseñadas en STL
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#reflexiones-finales" class="md-nav__link">
    <span class="md-ellipsis">
      
        Reflexiones Finales
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#codigo-principal" class="md-nav__link">
    <span class="md-ellipsis">
      
        Codigo Principal
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#codigo-test-de-cuadrantes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Codigo Test de Cuadrantes
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#resumen" class="md-nav__link">
    <span class="md-ellipsis">
      
        Resumen
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#objetivo-principal" class="md-nav__link">
    <span class="md-ellipsis">
      
        Objetivo Principal
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#objetivos-especificos" class="md-nav__link">
    <span class="md-ellipsis">
      
        Objetivos Específicos:
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#meta-de-la-practica" class="md-nav__link">
    <span class="md-ellipsis">
      
        Meta de la practica
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#organizacion-del-equipo" class="md-nav__link">
    <span class="md-ellipsis">
      
        Organización del Equipo
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#materiales-utilizados" class="md-nav__link">
    <span class="md-ellipsis">
      
        Materiales Utilizados
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tecnologias-utilizadas" class="md-nav__link">
    <span class="md-ellipsis">
      
        Tecnologías Utilizadas
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sistema-electronico" class="md-nav__link">
    <span class="md-ellipsis">
      
        Sistema Electrónico
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#diseno-electrico-y-consideraciones" class="md-nav__link">
    <span class="md-ellipsis">
      
        Diseño eléctrico y consideraciones
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ingenieria-de-la-carcasa" class="md-nav__link">
    <span class="md-ellipsis">
      
        Ingeniería de la carcasa
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#programacion" class="md-nav__link">
    <span class="md-ellipsis">
      
        Programación
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#resultados-y-observaciones" class="md-nav__link">
    <span class="md-ellipsis">
      
        Resultados y Observaciones
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#evidencias" class="md-nav__link">
    <span class="md-ellipsis">
      
        Evidencias
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#piezas-disenadas-en-stl" class="md-nav__link">
    <span class="md-ellipsis">
      
        Piezas Diseñadas en STL
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#reflexiones-finales" class="md-nav__link">
    <span class="md-ellipsis">
      
        Reflexiones Finales
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#codigo-principal" class="md-nav__link">
    <span class="md-ellipsis">
      
        Codigo Principal
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#codigo-test-de-cuadrantes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Codigo Test de Cuadrantes
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="proyecto-balsa-stewart">Proyecto Balsa Stewart</h1>
<h2 id="resumen">Resumen</h2>
<ul>
<li><strong>Nombre del proyecto:</strong> <em>Plataforma niveladora con servomotores</em>  </li>
<li><strong>Equipo / Autor(es):</strong> <em>Carlos Alberto Vasquez Perasa, Luis Hernesto Tamez Velazquez, Erik Andre Zepeda Tapia, Sebastian Gomez Rodrigues, Juan Manuel Gaona Serrano</em>  </li>
<li><strong>Curso / Asignatura:</strong> <em>Introducción a la mecatronica</em>  </li>
<li><strong>Fecha:</strong> <em>05/11/2025</em>  </li>
<li><strong>Descripción breve:</strong> <em>Este proyecto consiste en el desarrollo e implementación de una plataforma de autonivelación basada en la Plataforma Stewart. Este tipo de plataforma se utiliza en diversas industrias, como en simuladores de vuelo y posicionamiento de precisión.</em></li>
</ul>
<hr />
<h2 id="objetivo-principal">Objetivo Principal</h2>
<p>El objetivo principal es mantener un objeto, específicamente una pelota, en una posición fija sobre la superficie de la plataforma, evitando su caída.</p>
<h2 id="objetivos-especificos">Objetivos Específicos:</h2>
<p>Visión por Computadora: Una cámara captura la posición y el color (rojo) de la pelota en tiempo real.
Control: La información de la cámara es procesada por un programa en phyton que manda información a un programa c++ que se encarga del control de un SP32, que a su ves controla los servomotores.
Actuación: La nivelación se ejecuta mediante el control preciso de tres servomotores ubicados con una separación de un angulo de 120°, los cuales ajustan los actuadores de la plataforma para inclinar y desplazar el plano y así mantener la pelota en el centro.</p>
<p><strong>Incluye:</strong> <em>Piezas de solidWorks y en .STL, planos para corte laser en .DXF, Codigo de la camara en phyton, codigo para SP32 en c++</em> - <strong>No incluye:</strong> <em>La conexión de la parte mecanica, ni las medidad de los tornillos utilizados</em></p>
<h2 id="meta-de-la-practica">Meta de la practica</h2>
<p>Establecer una comunicación inalámbrica entre el ESP32 y un celular mediante Bluetooth, para recibir mensajes escritos desde una app móvil y mostrarlos en el monitor serial de la computadora.</p>
<h2 id="organizacion-del-equipo">Organización del Equipo</h2>
<p>El equipo se dividió en dos áreas principales: desarrollo del codigo de programacion y desarrollo electrónico.</p>
<h2 id="materiales-utilizados">Materiales Utilizados</h2>
<table>
<thead>
<tr>
<th>Nombre de la Pieza</th>
<th>Cantidad</th>
</tr>
</thead>
<tbody>
<tr>
<td>Tornillo de cabeza de casquillo M2 x 8</td>
<td>6</td>
</tr>
<tr>
<td>Tornillo de cabeza de casquillo M2.5 x 10</td>
<td>4</td>
</tr>
<tr>
<td>Tornillo de cabeza de casquillo M3 x 5</td>
<td>18</td>
</tr>
<tr>
<td>Tornillo de cabeza de casquillo M3 x 10</td>
<td>3</td>
</tr>
<tr>
<td>Tornillo de cabeza de casquillo M3 x 15</td>
<td>1</td>
</tr>
<tr>
<td>Tornillo de cabeza de casquillo M3 x 20</td>
<td>3</td>
</tr>
<tr>
<td>Tornillo de cabeza de casquillo M4 x 20</td>
<td>6</td>
</tr>
<tr>
<td>Tornillo de cabeza de casquillo M4 x 30</td>
<td>6</td>
</tr>
<tr>
<td>Tornillo de cabeza de casquillo M5 x 30</td>
<td>3</td>
</tr>
<tr>
<td>BASE 3D</td>
<td>1</td>
</tr>
<tr>
<td>SEGUNDA BASE 3D</td>
<td>1</td>
</tr>
<tr>
<td>BRAZOS PRINCIPALES</td>
<td>3</td>
</tr>
<tr>
<td>BRAZOS SECUNDARIOS</td>
<td>3</td>
</tr>
<tr>
<td>Motores DC 15kg 180 grados</td>
<td>3</td>
</tr>
<tr>
<td>Balsa</td>
<td>1</td>
</tr>
<tr>
<td>Camara Webcam</td>
<td>1</td>
</tr>
<tr>
<td>Esp32</td>
<td>1</td>
</tr>
<tr>
<td>Protoboard</td>
<td>1</td>
</tr>
<tr>
<td>Jumpers</td>
<td>+10</td>
</tr>
<tr>
<td>Cable usb A</td>
<td>1</td>
</tr>
<tr>
<td>---</td>
<td></td>
</tr>
</tbody>
</table>
<h2 id="tecnologias-utilizadas">Tecnologías Utilizadas</h2>
<ul>
<li><strong>Lenguajes:</strong> <code>Python</code>, <code>C++</code>, <code>Visual Studio Code</code></li>
<li><strong>Hardware:</strong> <code>ESP32</code>, <code>Arduino</code></li>
<li><strong>Software:</strong> <code>ARDUINO IDE</code> </li>
</ul>
<h2 id="sistema-electronico">Sistema Electrónico</h2>
<p>Componentes principales
-Controlador: ESP32 (Wi-Fi/Bluetooth integrado).
-Actuadores: 3 servos de alto torque (15 kg·cm, 180°).
-Fuente: Adaptador 5 V (corriente suficiente para 3 servos + ESP32).
-Interconexión: Protoboard + jumpers.
-Extras: Webcam Logitech (alimentación USB), volante Logitech G29 (alimentación propia), tornillería para montaje.</p>
<h2 id="diseno-electrico-y-consideraciones">Diseño eléctrico y consideraciones</h2>
<ol>
<li>Alimentación</li>
</ol>
<h2 id="ingenieria-de-la-carcasa">Ingeniería de la carcasa</h2>
<p>Se eligió PLA (impresión FDM) por su facilidad de fabricación y rigidez adecuada para temperaturas hasta ~55–60 °C. Las paredes principales son de 2.4 mm (tres perímetros de 0.8 mm), con nervaduras internas de 3 mm para reducir flexión en la tapa superior. Se añadieron insertos roscados M3 por calor en cuatro pilares, mejorando el ciclo de mantenimiento sin degradar el material. La ventilación se resolvió con ranuras de 6×1 mm alineadas sobre el regulador DC-DC y el driver del motor; la orientación de capa minimiza concentraciones de tensión en las esquinas (chaflanes de 1.5 mm). Se verificó holgura de 0.3 mm para acoplar el sensor N y evitar interferencias con el mazo de cables.</p>
<h2 id="programacion">Programación</h2>
<p>Todos los codigos desarrollados por el equipo se encuentran al final del reporte :)</p>
<p><img src="../recursos/imgs/F1.jpg" alt="Diagrama del sistema" width="320">
<img src="../recursos/imgs/F3.jpg" alt="Diagrama del sistema" width="320">
<img src="../recursos/imgs/F4.jpg" alt="Diagrama del sistema" width="320">
<img src="../recursos/imgs/F5.jpg" alt="Diagrama del sistema" width="320"></p>
<h2 id="resultados-y-observaciones">Resultados y Observaciones</h2>
<p>La conexión Bluetooth fue exitosa y estable.
Los mensajes escritos desde el celular se reflejaban correctamente en el monitor serial.
El ESP32 respondió de forma inmediata a los datos recibidos.
No se presentaron errores de transmisión ni desconexiones durante la prueba.</p>
<h2 id="evidencias">Evidencias</h2>
<p><a href="https://youtube.com/shorts/Mo1GiXa5FQk?si=V_IwKdBk0SmisMpB">Ver en YouTube</a>
<a href="https://youtube.com/shorts/oSkWEF_ZbRw?si=tQmtDbEzEKuWXeTJ">Ver en YouTube</a></p>
<h2 id="piezas-disenadas-en-stl">Piezas Diseñadas en STL</h2>
<p>Diseño de piezas en STL
Las piezas del proyecto fueron modeladas en software CAD y exportadas en formato STL para su fabricación mediante impresión 3D. En las siguientes imágenes, tomadas desde PrusaSlicer, se aprecia la disposición y orientación de las piezas sobre la cama de impresión, así como los parámetros de configuración utilizados para optimizar la calidad y resistencia:</p>
<p>Estas configuraciones garantizan una fabricación precisa, reduciendo desperdicio de material y asegurando la funcionalidad mecánica del conjunto.</p>
<p><img src="../recursos/imgs/F6.jpg" alt="Diagrama del sistema" width="320">
<img src="../recursos/imgs/F7.jpg" alt="Diagrama del sistema" width="320">
<img src="../recursos/imgs/F8.jpg" alt="Diagrama del sistema" width="320">
<img src="../recursos/imgs/F9.jpg" alt="Diagrama del sistema" width="320"></p>
<h2 id="reflexiones-finales">Reflexiones Finales</h2>
<p>Al comenzar este proyecto, enfrentamos un gran desafío tanto en la parte mecánica como en la lógica de programación, ya que era un territorio nuevo dentro de nuestros conocimientos. Puedo decir que la visión artificial resultó ser una herramienta muy práctica y útil en nuestra vida diaria; nunca imaginábamos todo lo que podríamos lograr aplicándola.</p>
<p>Durante el desarrollo aprendimos a gestionar mejor nuestro tiempo, a ver más allá de la electrónica e incorporar también los aspectos mecánicos, físicos y cinemáticos del sistema. Esto nos permitió comprender mejor el comportamiento del conjunto y detectar fallas con mayor precisión, como la inclinación de los servomotores, las librerías utilizadas, los métodos de detección y los materiales empleados.</p>
<p>A pesar de ser un proceso exigente y lleno de retos, también fue una experiencia divertida y emocionante. Sin duda, esperamos realizar más proyectos de este tipo en el futuro para seguir aprendiendo y mejorando nuestras habilidades en ingeniería mecatrónica.sino que también abrió oportunidades para futuras mejoras, como la optimización del consumo energético y la incorporación de sistemas más avanzados de control y sensorización.</p>
<h2 id="codigo-principal">Codigo Principal</h2>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>import<span class="w"> </span>cv2
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>import<span class="w"> </span>numpy<span class="w"> </span>as<span class="w"> </span>np
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>import<span class="w"> </span>math
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>import<span class="w"> </span>serial
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>import<span class="w"> </span><span class="nb">time</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="c1"># ===================== CONFIGURACION SERIAL =====================</span>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a><span class="nv">PUERTO_SERIAL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;COM11&#39;</span><span class="w"> </span><span class="c1"># &lt;-- AJUSTA ESTO AL PUERTO DE TU ESP32</span>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a><span class="nv">BAUDRATE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">115200</span>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a><span class="nv">TIMEOUT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span>.01
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a>
</span><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a>
</span><span id="__span-0-14"><a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a>try:
</span><span id="__span-0-15"><a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a><span class="w">    </span><span class="nv">arduino</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>serial.Serial<span class="o">(</span>PUERTO_SERIAL,<span class="w"> </span>BAUDRATE,<span class="w"> </span><span class="nv">timeout</span><span class="o">=</span>TIMEOUT<span class="o">)</span>
</span><span id="__span-0-16"><a id="__codelineno-0-16" name="__codelineno-0-16" href="#__codelineno-0-16"></a><span class="w">    </span>time.sleep<span class="o">(</span><span class="m">2</span><span class="o">)</span>
</span><span id="__span-0-17"><a id="__codelineno-0-17" name="__codelineno-0-17" href="#__codelineno-0-17"></a><span class="w">    </span>print<span class="o">(</span><span class="s2">&quot;✓ Serial conectado en&quot;</span>,<span class="w"> </span>PUERTO_SERIAL<span class="o">)</span>
</span><span id="__span-0-18"><a id="__codelineno-0-18" name="__codelineno-0-18" href="#__codelineno-0-18"></a>except<span class="w"> </span>Exception<span class="w"> </span>as<span class="w"> </span>e:
</span><span id="__span-0-19"><a id="__codelineno-0-19" name="__codelineno-0-19" href="#__codelineno-0-19"></a><span class="w">    </span>print<span class="o">(</span>f<span class="s2">&quot;✗ ERROR: No se pudo conectar en {PUERTO_SERIAL}. {e}&quot;</span><span class="o">)</span>
</span><span id="__span-0-20"><a id="__codelineno-0-20" name="__codelineno-0-20" href="#__codelineno-0-20"></a><span class="w">    </span><span class="nv">arduino</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>None
</span><span id="__span-0-21"><a id="__codelineno-0-21" name="__codelineno-0-21" href="#__codelineno-0-21"></a>
</span><span id="__span-0-22"><a id="__codelineno-0-22" name="__codelineno-0-22" href="#__codelineno-0-22"></a><span class="c1"># ===================== PARAMETROS HOUGH (PLATO) =====================</span>
</span><span id="__span-0-23"><a id="__codelineno-0-23" name="__codelineno-0-23" href="#__codelineno-0-23"></a><span class="nv">dp</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="m">0</span>.8
</span><span id="__span-0-24"><a id="__codelineno-0-24" name="__codelineno-0-24" href="#__codelineno-0-24"></a><span class="nv">minDist</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="m">280</span>
</span><span id="__span-0-25"><a id="__codelineno-0-25" name="__codelineno-0-25" href="#__codelineno-0-25"></a><span class="nv">param1</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="m">165</span>
</span><span id="__span-0-26"><a id="__codelineno-0-26" name="__codelineno-0-26" href="#__codelineno-0-26"></a><span class="nv">param2</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="m">15</span>
</span><span id="__span-0-27"><a id="__codelineno-0-27" name="__codelineno-0-27" href="#__codelineno-0-27"></a><span class="nv">minRadius</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">130</span>
</span><span id="__span-0-28"><a id="__codelineno-0-28" name="__codelineno-0-28" href="#__codelineno-0-28"></a><span class="nv">maxRadius</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">211</span>
</span><span id="__span-0-29"><a id="__codelineno-0-29" name="__codelineno-0-29" href="#__codelineno-0-29"></a>
</span><span id="__span-0-30"><a id="__codelineno-0-30" name="__codelineno-0-30" href="#__codelineno-0-30"></a>
</span><span id="__span-0-31"><a id="__codelineno-0-31" name="__codelineno-0-31" href="#__codelineno-0-31"></a><span class="c1"># ===================== FILTRO EXPONENCIAL DEL PLATO =====================</span>
</span><span id="__span-0-32"><a id="__codelineno-0-32" name="__codelineno-0-32" href="#__codelineno-0-32"></a><span class="nv">alpha_plato</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span>.9<span class="w"> </span>
</span><span id="__span-0-33"><a id="__codelineno-0-33" name="__codelineno-0-33" href="#__codelineno-0-33"></a><span class="nv">plato_cx_f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">plato_cy_f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">plato_r_f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>None<span class="w"> </span>
</span><span id="__span-0-34"><a id="__codelineno-0-34" name="__codelineno-0-34" href="#__codelineno-0-34"></a>
</span><span id="__span-0-35"><a id="__codelineno-0-35" name="__codelineno-0-35" href="#__codelineno-0-35"></a>
</span><span id="__span-0-36"><a id="__codelineno-0-36" name="__codelineno-0-36" href="#__codelineno-0-36"></a><span class="c1"># ===================== COEFICIENTES DE SUAVIZADO DE ERROR =====================</span>
</span><span id="__span-0-37"><a id="__codelineno-0-37" name="__codelineno-0-37" href="#__codelineno-0-37"></a><span class="nv">alpha_err</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span>.6
</span><span id="__span-0-38"><a id="__codelineno-0-38" name="__codelineno-0-38" href="#__codelineno-0-38"></a><span class="nv">errX_f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">errY_f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span>.0<span class="w"> </span>
</span><span id="__span-0-39"><a id="__codelineno-0-39" name="__codelineno-0-39" href="#__codelineno-0-39"></a>
</span><span id="__span-0-40"><a id="__codelineno-0-40" name="__codelineno-0-40" href="#__codelineno-0-40"></a>
</span><span id="__span-0-41"><a id="__codelineno-0-41" name="__codelineno-0-41" href="#__codelineno-0-41"></a><span class="c1"># ===================== VIDEO =====================</span>
</span><span id="__span-0-42"><a id="__codelineno-0-42" name="__codelineno-0-42" href="#__codelineno-0-42"></a><span class="nv">cap</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>cv2.VideoCapture<span class="o">(</span><span class="m">0</span><span class="o">)</span>
</span><span id="__span-0-43"><a id="__codelineno-0-43" name="__codelineno-0-43" href="#__codelineno-0-43"></a>cap.set<span class="o">(</span>cv2.CAP_PROP_FRAME_WIDTH,<span class="w"> </span><span class="m">640</span><span class="o">)</span>
</span><span id="__span-0-44"><a id="__codelineno-0-44" name="__codelineno-0-44" href="#__codelineno-0-44"></a>cap.set<span class="o">(</span>cv2.CAP_PROP_FRAME_HEIGHT,<span class="w"> </span><span class="m">480</span><span class="o">)</span>
</span><span id="__span-0-45"><a id="__codelineno-0-45" name="__codelineno-0-45" href="#__codelineno-0-45"></a>
</span><span id="__span-0-46"><a id="__codelineno-0-46" name="__codelineno-0-46" href="#__codelineno-0-46"></a>
</span><span id="__span-0-47"><a id="__codelineno-0-47" name="__codelineno-0-47" href="#__codelineno-0-47"></a><span class="c1"># ===================== ANGULOS DE SERVO (INICIALES) =====================</span>
</span><span id="__span-0-48"><a id="__codelineno-0-48" name="__codelineno-0-48" href="#__codelineno-0-48"></a><span class="nv">BASE_ANGLE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">50</span>.0<span class="w"> </span>
</span><span id="__span-0-49"><a id="__codelineno-0-49" name="__codelineno-0-49" href="#__codelineno-0-49"></a><span class="nv">MIN_ANGLE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">30</span>.0<span class="w">  </span>
</span><span id="__span-0-50"><a id="__codelineno-0-50" name="__codelineno-0-50" href="#__codelineno-0-50"></a><span class="nv">MAX_ANGLE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">70</span>.0<span class="w">   </span>
</span><span id="__span-0-51"><a id="__codelineno-0-51" name="__codelineno-0-51" href="#__codelineno-0-51"></a>
</span><span id="__span-0-52"><a id="__codelineno-0-52" name="__codelineno-0-52" href="#__codelineno-0-52"></a>
</span><span id="__span-0-53"><a id="__codelineno-0-53" name="__codelineno-0-53" href="#__codelineno-0-53"></a><span class="nv">COS_30</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>math.cos<span class="o">(</span>math.radians<span class="o">(</span><span class="m">30</span><span class="o">))</span><span class="w"> </span>
</span><span id="__span-0-54"><a id="__codelineno-0-54" name="__codelineno-0-54" href="#__codelineno-0-54"></a><span class="nv">SIN_30</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>math.sin<span class="o">(</span>math.radians<span class="o">(</span><span class="m">30</span><span class="o">))</span><span class="w"> </span>
</span><span id="__span-0-55"><a id="__codelineno-0-55" name="__codelineno-0-55" href="#__codelineno-0-55"></a>
</span><span id="__span-0-56"><a id="__codelineno-0-56" name="__codelineno-0-56" href="#__codelineno-0-56"></a>
</span><span id="__span-0-57"><a id="__codelineno-0-57" name="__codelineno-0-57" href="#__codelineno-0-57"></a><span class="c1"># ===================== PID BASICO =====================</span>
</span><span id="__span-0-58"><a id="__codelineno-0-58" name="__codelineno-0-58" href="#__codelineno-0-58"></a>class<span class="w"> </span>PID:
</span><span id="__span-0-59"><a id="__codelineno-0-59" name="__codelineno-0-59" href="#__codelineno-0-59"></a><span class="w">    </span>def<span class="w"> </span>__init__<span class="o">(</span>self,<span class="w"> </span>Kp,<span class="w"> </span>Ki,<span class="w"> </span>Kd,<span class="w"> </span><span class="nv">setpoint</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">dt</span><span class="o">=</span><span class="m">0</span>.03<span class="o">)</span>:
</span><span id="__span-0-60"><a id="__codelineno-0-60" name="__codelineno-0-60" href="#__codelineno-0-60"></a><span class="w">        </span>self.Kp<span class="w"> </span><span class="o">=</span><span class="w"> </span>Kp
</span><span id="__span-0-61"><a id="__codelineno-0-61" name="__codelineno-0-61" href="#__codelineno-0-61"></a><span class="w">        </span>self.Ki<span class="w"> </span><span class="o">=</span><span class="w"> </span>Ki
</span><span id="__span-0-62"><a id="__codelineno-0-62" name="__codelineno-0-62" href="#__codelineno-0-62"></a><span class="w">        </span>self.Kd<span class="w"> </span><span class="o">=</span><span class="w"> </span>Kd
</span><span id="__span-0-63"><a id="__codelineno-0-63" name="__codelineno-0-63" href="#__codelineno-0-63"></a><span class="w">        </span>self.setpoint<span class="w"> </span><span class="o">=</span><span class="w"> </span>setpoint
</span><span id="__span-0-64"><a id="__codelineno-0-64" name="__codelineno-0-64" href="#__codelineno-0-64"></a><span class="w">        </span>self.dt<span class="w"> </span><span class="o">=</span><span class="w"> </span>dt
</span><span id="__span-0-65"><a id="__codelineno-0-65" name="__codelineno-0-65" href="#__codelineno-0-65"></a><span class="w">        </span>self.prev_error<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span>
</span><span id="__span-0-66"><a id="__codelineno-0-66" name="__codelineno-0-66" href="#__codelineno-0-66"></a><span class="w">        </span>self.integral<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span>
</span><span id="__span-0-67"><a id="__codelineno-0-67" name="__codelineno-0-67" href="#__codelineno-0-67"></a>
</span><span id="__span-0-68"><a id="__codelineno-0-68" name="__codelineno-0-68" href="#__codelineno-0-68"></a>
</span><span id="__span-0-69"><a id="__codelineno-0-69" name="__codelineno-0-69" href="#__codelineno-0-69"></a><span class="w">    </span>def<span class="w"> </span>update<span class="o">(</span>self,<span class="w"> </span>measurement<span class="o">)</span>:
</span><span id="__span-0-70"><a id="__codelineno-0-70" name="__codelineno-0-70" href="#__codelineno-0-70"></a><span class="w">        </span><span class="nv">error</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>self.setpoint<span class="w"> </span>-<span class="w"> </span>measurement
</span><span id="__span-0-71"><a id="__codelineno-0-71" name="__codelineno-0-71" href="#__codelineno-0-71"></a><span class="w">        </span>self.integral<span class="w"> </span>+<span class="o">=</span><span class="w"> </span>error<span class="w"> </span>*<span class="w"> </span>self.dt
</span><span id="__span-0-72"><a id="__codelineno-0-72" name="__codelineno-0-72" href="#__codelineno-0-72"></a><span class="w">        </span>self.integral<span class="w"> </span><span class="o">=</span><span class="w"> </span>np.clip<span class="o">(</span>self.integral,<span class="w"> </span>-50,<span class="w"> </span><span class="m">50</span><span class="o">)</span><span class="w"> </span>
</span><span id="__span-0-73"><a id="__codelineno-0-73" name="__codelineno-0-73" href="#__codelineno-0-73"></a><span class="w">        </span><span class="nv">derivative</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">(</span>error<span class="w"> </span>-<span class="w"> </span>self.prev_error<span class="o">)</span><span class="w"> </span>/<span class="w"> </span>self.dt
</span><span id="__span-0-74"><a id="__codelineno-0-74" name="__codelineno-0-74" href="#__codelineno-0-74"></a>
</span><span id="__span-0-75"><a id="__codelineno-0-75" name="__codelineno-0-75" href="#__codelineno-0-75"></a><span class="w">        </span><span class="nv">output</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>self.Kp<span class="w"> </span>*<span class="w"> </span>error<span class="w"> </span>+<span class="w"> </span>self.Ki<span class="w"> </span>*<span class="w"> </span>self.integral<span class="w"> </span>+<span class="w"> </span>self.Kd<span class="w"> </span>*<span class="w"> </span>derivative
</span><span id="__span-0-76"><a id="__codelineno-0-76" name="__codelineno-0-76" href="#__codelineno-0-76"></a>
</span><span id="__span-0-77"><a id="__codelineno-0-77" name="__codelineno-0-77" href="#__codelineno-0-77"></a><span class="w">        </span><span class="nv">output</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>np.clip<span class="o">(</span>output,<span class="w"> </span>-20,<span class="w"> </span><span class="m">20</span><span class="o">)</span>
</span><span id="__span-0-78"><a id="__codelineno-0-78" name="__codelineno-0-78" href="#__codelineno-0-78"></a><span class="w">        </span>self.prev_error<span class="w"> </span><span class="o">=</span><span class="w"> </span>error
</span><span id="__span-0-79"><a id="__codelineno-0-79" name="__codelineno-0-79" href="#__codelineno-0-79"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span>output
</span><span id="__span-0-80"><a id="__codelineno-0-80" name="__codelineno-0-80" href="#__codelineno-0-80"></a>
</span><span id="__span-0-81"><a id="__codelineno-0-81" name="__codelineno-0-81" href="#__codelineno-0-81"></a>
</span><span id="__span-0-82"><a id="__codelineno-0-82" name="__codelineno-0-82" href="#__codelineno-0-82"></a><span class="c1"># Inicializar PIDs de inclinación</span>
</span><span id="__span-0-83"><a id="__codelineno-0-83" name="__codelineno-0-83" href="#__codelineno-0-83"></a><span class="nv">pid_dt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span>.03<span class="w"> </span>
</span><span id="__span-0-84"><a id="__codelineno-0-84" name="__codelineno-0-84" href="#__codelineno-0-84"></a><span class="nv">pid_x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>PID<span class="o">(</span><span class="nv">Kp</span><span class="o">=</span><span class="m">10</span>.0,<span class="w"> </span><span class="nv">Ki</span><span class="o">=</span><span class="m">0</span>.2,<span class="w"> </span><span class="nv">Kd</span><span class="o">=</span><span class="m">1</span>.0,<span class="w"> </span><span class="nv">dt</span><span class="o">=</span>pid_dt<span class="o">)</span><span class="w"> </span>
</span><span id="__span-0-85"><a id="__codelineno-0-85" name="__codelineno-0-85" href="#__codelineno-0-85"></a><span class="nv">pid_y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>PID<span class="o">(</span><span class="nv">Kp</span><span class="o">=</span><span class="m">10</span>.0,<span class="w"> </span><span class="nv">Ki</span><span class="o">=</span><span class="m">0</span>.2,<span class="w"> </span><span class="nv">Kd</span><span class="o">=</span><span class="m">1</span>.0,<span class="w"> </span><span class="nv">dt</span><span class="o">=</span>pid_dt<span class="o">)</span>
</span><span id="__span-0-86"><a id="__codelineno-0-86" name="__codelineno-0-86" href="#__codelineno-0-86"></a>
</span><span id="__span-0-87"><a id="__codelineno-0-87" name="__codelineno-0-87" href="#__codelineno-0-87"></a>
</span><span id="__span-0-88"><a id="__codelineno-0-88" name="__codelineno-0-88" href="#__codelineno-0-88"></a><span class="c1"># ===================== CINEMÁTICA DE 3 SERVOS =====================</span>
</span><span id="__span-0-89"><a id="__codelineno-0-89" name="__codelineno-0-89" href="#__codelineno-0-89"></a>def<span class="w"> </span>calcular_angulos_servos<span class="o">(</span>theta_x,<span class="w"> </span>theta_y,<span class="w"> </span>base_angle,<span class="w"> </span>min_angle,<span class="w"> </span>max_angle<span class="o">)</span>:
</span><span id="__span-0-90"><a id="__codelineno-0-90" name="__codelineno-0-90" href="#__codelineno-0-90"></a><span class="w">    </span><span class="nv">angle_1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>base_angle<span class="w"> </span>+<span class="w"> </span>theta_y<span class="w"> </span>
</span><span id="__span-0-91"><a id="__codelineno-0-91" name="__codelineno-0-91" href="#__codelineno-0-91"></a><span class="w">    </span><span class="nv">angle_2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>base_angle<span class="w"> </span>+<span class="w"> </span><span class="o">(</span>theta_x<span class="w"> </span>*<span class="w"> </span>COS_30<span class="o">)</span><span class="w"> </span>-<span class="w"> </span><span class="o">(</span>theta_y<span class="w"> </span>*<span class="w"> </span>SIN_30<span class="o">)</span>
</span><span id="__span-0-92"><a id="__codelineno-0-92" name="__codelineno-0-92" href="#__codelineno-0-92"></a><span class="w">    </span><span class="nv">angle_3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>base_angle<span class="w"> </span>-<span class="w"> </span><span class="o">(</span>theta_x<span class="w"> </span>*<span class="w"> </span>COS_30<span class="o">)</span><span class="w"> </span>-<span class="w"> </span><span class="o">(</span>theta_y<span class="w"> </span>*<span class="w"> </span>SIN_30<span class="o">)</span>
</span><span id="__span-0-93"><a id="__codelineno-0-93" name="__codelineno-0-93" href="#__codelineno-0-93"></a>
</span><span id="__span-0-94"><a id="__codelineno-0-94" name="__codelineno-0-94" href="#__codelineno-0-94"></a><span class="w">    </span><span class="nv">angle_1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>np.clip<span class="o">(</span>angle_1,<span class="w"> </span>min_angle,<span class="w"> </span>max_angle<span class="o">)</span>
</span><span id="__span-0-95"><a id="__codelineno-0-95" name="__codelineno-0-95" href="#__codelineno-0-95"></a><span class="w">    </span><span class="nv">angle_2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>np.clip<span class="o">(</span>angle_2,<span class="w"> </span>min_angle,<span class="w"> </span>max_angle<span class="o">)</span>
</span><span id="__span-0-96"><a id="__codelineno-0-96" name="__codelineno-0-96" href="#__codelineno-0-96"></a><span class="w">    </span><span class="nv">angle_3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>np.clip<span class="o">(</span>angle_3,<span class="w"> </span>min_angle,<span class="w"> </span>max_angle<span class="o">)</span>
</span><span id="__span-0-97"><a id="__codelineno-0-97" name="__codelineno-0-97" href="#__codelineno-0-97"></a>
</span><span id="__span-0-98"><a id="__codelineno-0-98" name="__codelineno-0-98" href="#__codelineno-0-98"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span>int<span class="o">(</span>angle_1<span class="o">)</span>,<span class="w"> </span>int<span class="o">(</span>angle_2<span class="o">)</span>,<span class="w"> </span>int<span class="o">(</span>angle_3<span class="o">)</span>
</span><span id="__span-0-99"><a id="__codelineno-0-99" name="__codelineno-0-99" href="#__codelineno-0-99"></a>
</span><span id="__span-0-100"><a id="__codelineno-0-100" name="__codelineno-0-100" href="#__codelineno-0-100"></a>
</span><span id="__span-0-101"><a id="__codelineno-0-101" name="__codelineno-0-101" href="#__codelineno-0-101"></a><span class="c1"># ===================== ENVIO DE CONFIGURACION AL ESP32 =====================</span>
</span><span id="__span-0-102"><a id="__codelineno-0-102" name="__codelineno-0-102" href="#__codelineno-0-102"></a>def<span class="w"> </span>enviar_config_angulos<span class="o">(</span>base,<span class="w"> </span>min_ang,<span class="w"> </span>max_ang<span class="o">)</span>:
</span><span id="__span-0-103"><a id="__codelineno-0-103" name="__codelineno-0-103" href="#__codelineno-0-103"></a><span class="w">    </span><span class="s2">&quot;&quot;&quot;Envía la configuración de ángulos al ESP32&quot;&quot;&quot;</span>
</span><span id="__span-0-104"><a id="__codelineno-0-104" name="__codelineno-0-104" href="#__codelineno-0-104"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span>arduino<span class="w"> </span>is<span class="w"> </span>not<span class="w"> </span>None:
</span><span id="__span-0-105"><a id="__codelineno-0-105" name="__codelineno-0-105" href="#__codelineno-0-105"></a><span class="w">        </span>try:
</span><span id="__span-0-106"><a id="__codelineno-0-106" name="__codelineno-0-106" href="#__codelineno-0-106"></a><span class="w">            </span><span class="nv">comando_config</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>f<span class="s2">&quot;CFG:BASE:{base},MIN:{min_ang},MAX:{max_ang}\n&quot;</span>
</span><span id="__span-0-107"><a id="__codelineno-0-107" name="__codelineno-0-107" href="#__codelineno-0-107"></a><span class="w">            </span>arduino.write<span class="o">(</span>comando_config.encode<span class="o">(</span><span class="s1">&#39;ascii&#39;</span><span class="o">))</span>
</span><span id="__span-0-108"><a id="__codelineno-0-108" name="__codelineno-0-108" href="#__codelineno-0-108"></a><span class="w">            </span>print<span class="o">(</span>f<span class="s2">&quot;✓ Config enviada: BASE={base}°, MIN={min_ang}°, MAX={max_ang}°&quot;</span><span class="o">)</span>
</span><span id="__span-0-109"><a id="__codelineno-0-109" name="__codelineno-0-109" href="#__codelineno-0-109"></a><span class="w">        </span>except<span class="w"> </span>Exception<span class="w"> </span>as<span class="w"> </span>e:
</span><span id="__span-0-110"><a id="__codelineno-0-110" name="__codelineno-0-110" href="#__codelineno-0-110"></a><span class="w">            </span>print<span class="o">(</span>f<span class="s2">&quot;Error al enviar config: {e}&quot;</span><span class="o">)</span>
</span><span id="__span-0-111"><a id="__codelineno-0-111" name="__codelineno-0-111" href="#__codelineno-0-111"></a>
</span><span id="__span-0-112"><a id="__codelineno-0-112" name="__codelineno-0-112" href="#__codelineno-0-112"></a>
</span><span id="__span-0-113"><a id="__codelineno-0-113" name="__codelineno-0-113" href="#__codelineno-0-113"></a><span class="c1"># ===================== CONFIGURACIÓN DE TRACKBARS =====================</span>
</span><span id="__span-0-114"><a id="__codelineno-0-114" name="__codelineno-0-114" href="#__codelineno-0-114"></a>def<span class="w"> </span>on_trackbar<span class="o">(</span>val<span class="o">)</span>:
</span><span id="__span-0-115"><a id="__codelineno-0-115" name="__codelineno-0-115" href="#__codelineno-0-115"></a><span class="w">    </span>pass
</span><span id="__span-0-116"><a id="__codelineno-0-116" name="__codelineno-0-116" href="#__codelineno-0-116"></a>
</span><span id="__span-0-117"><a id="__codelineno-0-117" name="__codelineno-0-117" href="#__codelineno-0-117"></a>
</span><span id="__span-0-118"><a id="__codelineno-0-118" name="__codelineno-0-118" href="#__codelineno-0-118"></a><span class="c1"># Función para crear imagen de información con valores reales</span>
</span><span id="__span-0-119"><a id="__codelineno-0-119" name="__codelineno-0-119" href="#__codelineno-0-119"></a>def<span class="w"> </span>crear_imagen_info_pid<span class="o">(</span>kp,<span class="w"> </span>ki,<span class="w"> </span>kd<span class="o">)</span>:
</span><span id="__span-0-120"><a id="__codelineno-0-120" name="__codelineno-0-120" href="#__codelineno-0-120"></a><span class="w">    </span><span class="nv">img</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>np.zeros<span class="o">((</span><span class="m">150</span>,<span class="w"> </span><span class="m">400</span>,<span class="w"> </span><span class="m">3</span><span class="o">)</span>,<span class="w"> </span><span class="nv">dtype</span><span class="o">=</span>np.uint8<span class="o">)</span>
</span><span id="__span-0-121"><a id="__codelineno-0-121" name="__codelineno-0-121" href="#__codelineno-0-121"></a><span class="w">    </span>img<span class="o">[</span>:<span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">(</span><span class="m">40</span>,<span class="w"> </span><span class="m">40</span>,<span class="w"> </span><span class="m">40</span><span class="o">)</span><span class="w">  </span><span class="c1"># Fondo gris oscuro</span>
</span><span id="__span-0-122"><a id="__codelineno-0-122" name="__codelineno-0-122" href="#__codelineno-0-122"></a>
</span><span id="__span-0-123"><a id="__codelineno-0-123" name="__codelineno-0-123" href="#__codelineno-0-123"></a><span class="w">    </span><span class="nv">font</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>cv2.FONT_HERSHEY_SIMPLEX
</span><span id="__span-0-124"><a id="__codelineno-0-124" name="__codelineno-0-124" href="#__codelineno-0-124"></a><span class="w">    </span>cv2.putText<span class="o">(</span>img,<span class="w"> </span><span class="s2">&quot;VALORES PID ACTUALES&quot;</span>,<span class="w"> </span><span class="o">(</span><span class="m">70</span>,<span class="w"> </span><span class="m">30</span><span class="o">)</span>,<span class="w"> </span>font,<span class="w"> </span><span class="m">0</span>.7,<span class="w"> </span><span class="o">(</span><span class="m">255</span>,<span class="w"> </span><span class="m">255</span>,<span class="w"> </span><span class="m">255</span><span class="o">)</span>,<span class="w"> </span><span class="m">2</span><span class="o">)</span>
</span><span id="__span-0-125"><a id="__codelineno-0-125" name="__codelineno-0-125" href="#__codelineno-0-125"></a><span class="w">    </span>cv2.line<span class="o">(</span>img,<span class="w"> </span><span class="o">(</span><span class="m">20</span>,<span class="w"> </span><span class="m">40</span><span class="o">)</span>,<span class="w"> </span><span class="o">(</span><span class="m">380</span>,<span class="w"> </span><span class="m">40</span><span class="o">)</span>,<span class="w"> </span><span class="o">(</span><span class="m">100</span>,<span class="w"> </span><span class="m">100</span>,<span class="w"> </span><span class="m">100</span><span class="o">)</span>,<span class="w"> </span><span class="m">1</span><span class="o">)</span>
</span><span id="__span-0-126"><a id="__codelineno-0-126" name="__codelineno-0-126" href="#__codelineno-0-126"></a>
</span><span id="__span-0-127"><a id="__codelineno-0-127" name="__codelineno-0-127" href="#__codelineno-0-127"></a><span class="w">    </span>cv2.putText<span class="o">(</span>img,<span class="w"> </span>f<span class="s2">&quot;Kp = {kp:.2f}&quot;</span>,<span class="w"> </span><span class="o">(</span><span class="m">50</span>,<span class="w"> </span><span class="m">75</span><span class="o">)</span>,<span class="w"> </span>font,<span class="w"> </span><span class="m">0</span>.8,<span class="w"> </span><span class="o">(</span><span class="m">0</span>,<span class="w"> </span><span class="m">255</span>,<span class="w"> </span><span class="m">255</span><span class="o">)</span>,<span class="w"> </span><span class="m">2</span><span class="o">)</span>
</span><span id="__span-0-128"><a id="__codelineno-0-128" name="__codelineno-0-128" href="#__codelineno-0-128"></a><span class="w">    </span>cv2.putText<span class="o">(</span>img,<span class="w"> </span>f<span class="s2">&quot;Ki = {ki:.3f}&quot;</span>,<span class="w"> </span><span class="o">(</span><span class="m">50</span>,<span class="w"> </span><span class="m">105</span><span class="o">)</span>,<span class="w"> </span>font,<span class="w"> </span><span class="m">0</span>.8,<span class="w"> </span><span class="o">(</span><span class="m">0</span>,<span class="w"> </span><span class="m">255</span>,<span class="w"> </span><span class="m">255</span><span class="o">)</span>,<span class="w"> </span><span class="m">2</span><span class="o">)</span>
</span><span id="__span-0-129"><a id="__codelineno-0-129" name="__codelineno-0-129" href="#__codelineno-0-129"></a><span class="w">    </span>cv2.putText<span class="o">(</span>img,<span class="w"> </span>f<span class="s2">&quot;Kd = {kd:.2f}&quot;</span>,<span class="w"> </span><span class="o">(</span><span class="m">50</span>,<span class="w"> </span><span class="m">135</span><span class="o">)</span>,<span class="w"> </span>font,<span class="w"> </span><span class="m">0</span>.8,<span class="w"> </span><span class="o">(</span><span class="m">0</span>,<span class="w"> </span><span class="m">255</span>,<span class="w"> </span><span class="m">255</span><span class="o">)</span>,<span class="w"> </span><span class="m">2</span><span class="o">)</span>
</span><span id="__span-0-130"><a id="__codelineno-0-130" name="__codelineno-0-130" href="#__codelineno-0-130"></a>
</span><span id="__span-0-131"><a id="__codelineno-0-131" name="__codelineno-0-131" href="#__codelineno-0-131"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span>img
</span><span id="__span-0-132"><a id="__codelineno-0-132" name="__codelineno-0-132" href="#__codelineno-0-132"></a>
</span><span id="__span-0-133"><a id="__codelineno-0-133" name="__codelineno-0-133" href="#__codelineno-0-133"></a>
</span><span id="__span-0-134"><a id="__codelineno-0-134" name="__codelineno-0-134" href="#__codelineno-0-134"></a>def<span class="w"> </span>crear_imagen_info_angulos<span class="o">(</span>base,<span class="w"> </span>min_ang,<span class="w"> </span>max_ang<span class="o">)</span>:
</span><span id="__span-0-135"><a id="__codelineno-0-135" name="__codelineno-0-135" href="#__codelineno-0-135"></a><span class="w">    </span><span class="nv">img</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>np.zeros<span class="o">((</span><span class="m">150</span>,<span class="w"> </span><span class="m">400</span>,<span class="w"> </span><span class="m">3</span><span class="o">)</span>,<span class="w"> </span><span class="nv">dtype</span><span class="o">=</span>np.uint8<span class="o">)</span>
</span><span id="__span-0-136"><a id="__codelineno-0-136" name="__codelineno-0-136" href="#__codelineno-0-136"></a><span class="w">    </span>img<span class="o">[</span>:<span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">(</span><span class="m">40</span>,<span class="w"> </span><span class="m">40</span>,<span class="w"> </span><span class="m">40</span><span class="o">)</span><span class="w">  </span><span class="c1"># Fondo gris oscuro</span>
</span><span id="__span-0-137"><a id="__codelineno-0-137" name="__codelineno-0-137" href="#__codelineno-0-137"></a>
</span><span id="__span-0-138"><a id="__codelineno-0-138" name="__codelineno-0-138" href="#__codelineno-0-138"></a><span class="w">    </span><span class="nv">font</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>cv2.FONT_HERSHEY_SIMPLEX
</span><span id="__span-0-139"><a id="__codelineno-0-139" name="__codelineno-0-139" href="#__codelineno-0-139"></a><span class="w">    </span>cv2.putText<span class="o">(</span>img,<span class="w"> </span><span class="s2">&quot;ANGULOS DE SERVOS&quot;</span>,<span class="w"> </span><span class="o">(</span><span class="m">85</span>,<span class="w"> </span><span class="m">30</span><span class="o">)</span>,<span class="w"> </span>font,<span class="w"> </span><span class="m">0</span>.7,<span class="w"> </span><span class="o">(</span><span class="m">255</span>,<span class="w"> </span><span class="m">255</span>,<span class="w"> </span><span class="m">255</span><span class="o">)</span>,<span class="w"> </span><span class="m">2</span><span class="o">)</span>
</span><span id="__span-0-140"><a id="__codelineno-0-140" name="__codelineno-0-140" href="#__codelineno-0-140"></a><span class="w">    </span>cv2.line<span class="o">(</span>img,<span class="w"> </span><span class="o">(</span><span class="m">20</span>,<span class="w"> </span><span class="m">40</span><span class="o">)</span>,<span class="w"> </span><span class="o">(</span><span class="m">380</span>,<span class="w"> </span><span class="m">40</span><span class="o">)</span>,<span class="w"> </span><span class="o">(</span><span class="m">100</span>,<span class="w"> </span><span class="m">100</span>,<span class="w"> </span><span class="m">100</span><span class="o">)</span>,<span class="w"> </span><span class="m">1</span><span class="o">)</span>
</span><span id="__span-0-141"><a id="__codelineno-0-141" name="__codelineno-0-141" href="#__codelineno-0-141"></a>
</span><span id="__span-0-142"><a id="__codelineno-0-142" name="__codelineno-0-142" href="#__codelineno-0-142"></a><span class="w">    </span>cv2.putText<span class="o">(</span>img,<span class="w"> </span>f<span class="s2">&quot;Base = {base}.0 grados&quot;</span>,<span class="w"> </span><span class="o">(</span><span class="m">50</span>,<span class="w"> </span><span class="m">75</span><span class="o">)</span>,<span class="w"> </span>font,<span class="w"> </span><span class="m">0</span>.7,<span class="w"> </span><span class="o">(</span><span class="m">255</span>,<span class="w"> </span><span class="m">165</span>,<span class="w"> </span><span class="m">0</span><span class="o">)</span>,<span class="w"> </span><span class="m">2</span><span class="o">)</span>
</span><span id="__span-0-143"><a id="__codelineno-0-143" name="__codelineno-0-143" href="#__codelineno-0-143"></a><span class="w">    </span>cv2.putText<span class="o">(</span>img,<span class="w"> </span>f<span class="s2">&quot;Min  = {min_ang}.0 grados&quot;</span>,<span class="w"> </span><span class="o">(</span><span class="m">50</span>,<span class="w"> </span><span class="m">105</span><span class="o">)</span>,<span class="w"> </span>font,<span class="w"> </span><span class="m">0</span>.7,<span class="w"> </span><span class="o">(</span><span class="m">255</span>,<span class="w"> </span><span class="m">165</span>,<span class="w"> </span><span class="m">0</span><span class="o">)</span>,<span class="w"> </span><span class="m">2</span><span class="o">)</span>
</span><span id="__span-0-144"><a id="__codelineno-0-144" name="__codelineno-0-144" href="#__codelineno-0-144"></a><span class="w">    </span>cv2.putText<span class="o">(</span>img,<span class="w"> </span>f<span class="s2">&quot;Max  = {max_ang}.0 grados&quot;</span>,<span class="w"> </span><span class="o">(</span><span class="m">50</span>,<span class="w"> </span><span class="m">135</span><span class="o">)</span>,<span class="w"> </span>font,<span class="w"> </span><span class="m">0</span>.7,<span class="w"> </span><span class="o">(</span><span class="m">255</span>,<span class="w"> </span><span class="m">165</span>,<span class="w"> </span><span class="m">0</span><span class="o">)</span>,<span class="w"> </span><span class="m">2</span><span class="o">)</span>
</span><span id="__span-0-145"><a id="__codelineno-0-145" name="__codelineno-0-145" href="#__codelineno-0-145"></a>
</span><span id="__span-0-146"><a id="__codelineno-0-146" name="__codelineno-0-146" href="#__codelineno-0-146"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span>img
</span><span id="__span-0-147"><a id="__codelineno-0-147" name="__codelineno-0-147" href="#__codelineno-0-147"></a>
</span><span id="__span-0-148"><a id="__codelineno-0-148" name="__codelineno-0-148" href="#__codelineno-0-148"></a>
</span><span id="__span-0-149"><a id="__codelineno-0-149" name="__codelineno-0-149" href="#__codelineno-0-149"></a><span class="c1"># Crear ventana de control PID</span>
</span><span id="__span-0-150"><a id="__codelineno-0-150" name="__codelineno-0-150" href="#__codelineno-0-150"></a>cv2.namedWindow<span class="o">(</span><span class="s2">&quot;PID Tuner&quot;</span><span class="o">)</span>
</span><span id="__span-0-151"><a id="__codelineno-0-151" name="__codelineno-0-151" href="#__codelineno-0-151"></a>cv2.resizeWindow<span class="o">(</span><span class="s2">&quot;PID Tuner&quot;</span>,<span class="w"> </span><span class="m">400</span>,<span class="w"> </span><span class="m">150</span><span class="o">)</span>
</span><span id="__span-0-152"><a id="__codelineno-0-152" name="__codelineno-0-152" href="#__codelineno-0-152"></a>
</span><span id="__span-0-153"><a id="__codelineno-0-153" name="__codelineno-0-153" href="#__codelineno-0-153"></a><span class="c1"># Trackbars PID (sin texto de unidades, se muestra en la imagen)</span>
</span><span id="__span-0-154"><a id="__codelineno-0-154" name="__codelineno-0-154" href="#__codelineno-0-154"></a>cv2.createTrackbar<span class="o">(</span><span class="s2">&quot;Kp x10&quot;</span>,<span class="w"> </span><span class="s2">&quot;PID Tuner&quot;</span>,<span class="w"> </span>int<span class="o">(</span>pid_x.Kp<span class="w"> </span>*<span class="w"> </span><span class="m">10</span><span class="o">)</span>,<span class="w"> </span><span class="m">500</span>,<span class="w"> </span>on_trackbar<span class="o">)</span>
</span><span id="__span-0-155"><a id="__codelineno-0-155" name="__codelineno-0-155" href="#__codelineno-0-155"></a>cv2.createTrackbar<span class="o">(</span><span class="s2">&quot;Ki x100&quot;</span>,<span class="w"> </span><span class="s2">&quot;PID Tuner&quot;</span>,<span class="w"> </span>int<span class="o">(</span>pid_x.Ki<span class="w"> </span>*<span class="w"> </span><span class="m">100</span><span class="o">)</span>,<span class="w"> </span><span class="m">100</span>,<span class="w"> </span>on_trackbar<span class="o">)</span>
</span><span id="__span-0-156"><a id="__codelineno-0-156" name="__codelineno-0-156" href="#__codelineno-0-156"></a>cv2.createTrackbar<span class="o">(</span><span class="s2">&quot;Kd x10&quot;</span>,<span class="w"> </span><span class="s2">&quot;PID Tuner&quot;</span>,<span class="w"> </span>int<span class="o">(</span>pid_x.Kd<span class="w"> </span>*<span class="w"> </span><span class="m">10</span><span class="o">)</span>,<span class="w"> </span><span class="m">50</span>,<span class="w"> </span>on_trackbar<span class="o">)</span>
</span><span id="__span-0-157"><a id="__codelineno-0-157" name="__codelineno-0-157" href="#__codelineno-0-157"></a>
</span><span id="__span-0-158"><a id="__codelineno-0-158" name="__codelineno-0-158" href="#__codelineno-0-158"></a><span class="c1"># Crear ventana de control de Ángulos</span>
</span><span id="__span-0-159"><a id="__codelineno-0-159" name="__codelineno-0-159" href="#__codelineno-0-159"></a>cv2.namedWindow<span class="o">(</span><span class="s2">&quot;Servo Angles&quot;</span><span class="o">)</span>
</span><span id="__span-0-160"><a id="__codelineno-0-160" name="__codelineno-0-160" href="#__codelineno-0-160"></a>cv2.resizeWindow<span class="o">(</span><span class="s2">&quot;Servo Angles&quot;</span>,<span class="w"> </span><span class="m">400</span>,<span class="w"> </span><span class="m">150</span><span class="o">)</span>
</span><span id="__span-0-161"><a id="__codelineno-0-161" name="__codelineno-0-161" href="#__codelineno-0-161"></a>
</span><span id="__span-0-162"><a id="__codelineno-0-162" name="__codelineno-0-162" href="#__codelineno-0-162"></a><span class="c1"># Trackbars de ángulos (0-180 grados)</span>
</span><span id="__span-0-163"><a id="__codelineno-0-163" name="__codelineno-0-163" href="#__codelineno-0-163"></a>cv2.createTrackbar<span class="o">(</span><span class="s2">&quot;Base&quot;</span>,<span class="w"> </span><span class="s2">&quot;Servo Angles&quot;</span>,<span class="w"> </span>int<span class="o">(</span>BASE_ANGLE<span class="o">)</span>,<span class="w"> </span><span class="m">180</span>,<span class="w"> </span>on_trackbar<span class="o">)</span>
</span><span id="__span-0-164"><a id="__codelineno-0-164" name="__codelineno-0-164" href="#__codelineno-0-164"></a>cv2.createTrackbar<span class="o">(</span><span class="s2">&quot;Min&quot;</span>,<span class="w"> </span><span class="s2">&quot;Servo Angles&quot;</span>,<span class="w"> </span>int<span class="o">(</span>MIN_ANGLE<span class="o">)</span>,<span class="w"> </span><span class="m">180</span>,<span class="w"> </span>on_trackbar<span class="o">)</span>
</span><span id="__span-0-165"><a id="__codelineno-0-165" name="__codelineno-0-165" href="#__codelineno-0-165"></a>cv2.createTrackbar<span class="o">(</span><span class="s2">&quot;Max&quot;</span>,<span class="w"> </span><span class="s2">&quot;Servo Angles&quot;</span>,<span class="w"> </span>int<span class="o">(</span>MAX_ANGLE<span class="o">)</span>,<span class="w"> </span><span class="m">180</span>,<span class="w"> </span>on_trackbar<span class="o">)</span>
</span><span id="__span-0-166"><a id="__codelineno-0-166" name="__codelineno-0-166" href="#__codelineno-0-166"></a>
</span><span id="__span-0-167"><a id="__codelineno-0-167" name="__codelineno-0-167" href="#__codelineno-0-167"></a><span class="c1"># Enviar configuración inicial</span>
</span><span id="__span-0-168"><a id="__codelineno-0-168" name="__codelineno-0-168" href="#__codelineno-0-168"></a>enviar_config_angulos<span class="o">(</span>int<span class="o">(</span>BASE_ANGLE<span class="o">)</span>,<span class="w"> </span>int<span class="o">(</span>MIN_ANGLE<span class="o">)</span>,<span class="w"> </span>int<span class="o">(</span>MAX_ANGLE<span class="o">))</span>
</span><span id="__span-0-169"><a id="__codelineno-0-169" name="__codelineno-0-169" href="#__codelineno-0-169"></a>
</span><span id="__span-0-170"><a id="__codelineno-0-170" name="__codelineno-0-170" href="#__codelineno-0-170"></a>print<span class="o">(</span><span class="s2">&quot;🎯 Detección de Plato y Errores de Pelota (Fondo Negro)&quot;</span><span class="o">)</span>
</span><span id="__span-0-171"><a id="__codelineno-0-171" name="__codelineno-0-171" href="#__codelineno-0-171"></a>print<span class="o">(</span><span class="s2">&quot;📐 Ajusta los ángulos en tiempo real con los sliders&quot;</span><span class="o">)</span>
</span><span id="__span-0-172"><a id="__codelineno-0-172" name="__codelineno-0-172" href="#__codelineno-0-172"></a>print<span class="o">(</span><span class="s2">&quot;Presiona &#39;q&#39; para salir&quot;</span><span class="o">)</span>
</span><span id="__span-0-173"><a id="__codelineno-0-173" name="__codelineno-0-173" href="#__codelineno-0-173"></a>
</span><span id="__span-0-174"><a id="__codelineno-0-174" name="__codelineno-0-174" href="#__codelineno-0-174"></a><span class="c1"># Variables para detectar cambios en ángulos</span>
</span><span id="__span-0-175"><a id="__codelineno-0-175" name="__codelineno-0-175" href="#__codelineno-0-175"></a><span class="nv">prev_base</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>int<span class="o">(</span>BASE_ANGLE<span class="o">)</span>
</span><span id="__span-0-176"><a id="__codelineno-0-176" name="__codelineno-0-176" href="#__codelineno-0-176"></a><span class="nv">prev_min</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>int<span class="o">(</span>MIN_ANGLE<span class="o">)</span>
</span><span id="__span-0-177"><a id="__codelineno-0-177" name="__codelineno-0-177" href="#__codelineno-0-177"></a><span class="nv">prev_max</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>int<span class="o">(</span>MAX_ANGLE<span class="o">)</span>
</span><span id="__span-0-178"><a id="__codelineno-0-178" name="__codelineno-0-178" href="#__codelineno-0-178"></a>
</span><span id="__span-0-179"><a id="__codelineno-0-179" name="__codelineno-0-179" href="#__codelineno-0-179"></a><span class="c1"># Bucle principal de control</span>
</span><span id="__span-0-180"><a id="__codelineno-0-180" name="__codelineno-0-180" href="#__codelineno-0-180"></a><span class="k">while</span><span class="w"> </span>True:
</span><span id="__span-0-181"><a id="__codelineno-0-181" name="__codelineno-0-181" href="#__codelineno-0-181"></a><span class="w">    </span><span class="c1"># --- LECTURA Y ACTUALIZACIÓN DEL PID ---</span>
</span><span id="__span-0-182"><a id="__codelineno-0-182" name="__codelineno-0-182" href="#__codelineno-0-182"></a><span class="w">    </span><span class="nv">kp_val</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>cv2.getTrackbarPos<span class="o">(</span><span class="s2">&quot;Kp x10&quot;</span>,<span class="w"> </span><span class="s2">&quot;PID Tuner&quot;</span><span class="o">)</span><span class="w"> </span>/<span class="w"> </span><span class="m">10</span>.0
</span><span id="__span-0-183"><a id="__codelineno-0-183" name="__codelineno-0-183" href="#__codelineno-0-183"></a><span class="w">    </span><span class="nv">ki_val</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>cv2.getTrackbarPos<span class="o">(</span><span class="s2">&quot;Ki x100&quot;</span>,<span class="w"> </span><span class="s2">&quot;PID Tuner&quot;</span><span class="o">)</span><span class="w"> </span>/<span class="w"> </span><span class="m">100</span>.0
</span><span id="__span-0-184"><a id="__codelineno-0-184" name="__codelineno-0-184" href="#__codelineno-0-184"></a><span class="w">    </span><span class="nv">kd_val</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>cv2.getTrackbarPos<span class="o">(</span><span class="s2">&quot;Kd x10&quot;</span>,<span class="w"> </span><span class="s2">&quot;PID Tuner&quot;</span><span class="o">)</span><span class="w"> </span>/<span class="w"> </span><span class="m">10</span>.0
</span><span id="__span-0-185"><a id="__codelineno-0-185" name="__codelineno-0-185" href="#__codelineno-0-185"></a>
</span><span id="__span-0-186"><a id="__codelineno-0-186" name="__codelineno-0-186" href="#__codelineno-0-186"></a><span class="w">    </span>pid_x.Kp,<span class="w"> </span>pid_x.Ki,<span class="w"> </span>pid_x.Kd<span class="w"> </span><span class="o">=</span><span class="w"> </span>kp_val,<span class="w"> </span>ki_val,<span class="w"> </span>kd_val
</span><span id="__span-0-187"><a id="__codelineno-0-187" name="__codelineno-0-187" href="#__codelineno-0-187"></a><span class="w">    </span>pid_y.Kp,<span class="w"> </span>pid_y.Ki,<span class="w"> </span>pid_y.Kd<span class="w"> </span><span class="o">=</span><span class="w"> </span>kp_val,<span class="w"> </span>ki_val,<span class="w"> </span>kd_val
</span><span id="__span-0-188"><a id="__codelineno-0-188" name="__codelineno-0-188" href="#__codelineno-0-188"></a>
</span><span id="__span-0-189"><a id="__codelineno-0-189" name="__codelineno-0-189" href="#__codelineno-0-189"></a><span class="w">    </span><span class="c1"># --- LECTURA DE ÁNGULOS DESDE TRACKBARS ---</span>
</span><span id="__span-0-190"><a id="__codelineno-0-190" name="__codelineno-0-190" href="#__codelineno-0-190"></a><span class="w">    </span><span class="nv">current_base</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>cv2.getTrackbarPos<span class="o">(</span><span class="s2">&quot;Base&quot;</span>,<span class="w"> </span><span class="s2">&quot;Servo Angles&quot;</span><span class="o">)</span>
</span><span id="__span-0-191"><a id="__codelineno-0-191" name="__codelineno-0-191" href="#__codelineno-0-191"></a><span class="w">    </span><span class="nv">current_min</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>cv2.getTrackbarPos<span class="o">(</span><span class="s2">&quot;Min&quot;</span>,<span class="w"> </span><span class="s2">&quot;Servo Angles&quot;</span><span class="o">)</span>
</span><span id="__span-0-192"><a id="__codelineno-0-192" name="__codelineno-0-192" href="#__codelineno-0-192"></a><span class="w">    </span><span class="nv">current_max</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>cv2.getTrackbarPos<span class="o">(</span><span class="s2">&quot;Max&quot;</span>,<span class="w"> </span><span class="s2">&quot;Servo Angles&quot;</span><span class="o">)</span>
</span><span id="__span-0-193"><a id="__codelineno-0-193" name="__codelineno-0-193" href="#__codelineno-0-193"></a>
</span><span id="__span-0-194"><a id="__codelineno-0-194" name="__codelineno-0-194" href="#__codelineno-0-194"></a><span class="w">    </span><span class="c1"># Mostrar valores reales en las ventanas de trackbars</span>
</span><span id="__span-0-195"><a id="__codelineno-0-195" name="__codelineno-0-195" href="#__codelineno-0-195"></a><span class="w">    </span><span class="nv">img_pid_info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>crear_imagen_info_pid<span class="o">(</span>kp_val,<span class="w"> </span>ki_val,<span class="w"> </span>kd_val<span class="o">)</span>
</span><span id="__span-0-196"><a id="__codelineno-0-196" name="__codelineno-0-196" href="#__codelineno-0-196"></a><span class="w">    </span>cv2.imshow<span class="o">(</span><span class="s2">&quot;PID Tuner&quot;</span>,<span class="w"> </span>img_pid_info<span class="o">)</span>
</span><span id="__span-0-197"><a id="__codelineno-0-197" name="__codelineno-0-197" href="#__codelineno-0-197"></a>
</span><span id="__span-0-198"><a id="__codelineno-0-198" name="__codelineno-0-198" href="#__codelineno-0-198"></a><span class="w">    </span><span class="nv">img_angle_info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>crear_imagen_info_angulos<span class="o">(</span>current_base,<span class="w"> </span>current_min,<span class="w"> </span>current_max<span class="o">)</span>
</span><span id="__span-0-199"><a id="__codelineno-0-199" name="__codelineno-0-199" href="#__codelineno-0-199"></a><span class="w">    </span>cv2.imshow<span class="o">(</span><span class="s2">&quot;Servo Angles&quot;</span>,<span class="w"> </span>img_angle_info<span class="o">)</span>
</span><span id="__span-0-200"><a id="__codelineno-0-200" name="__codelineno-0-200" href="#__codelineno-0-200"></a>
</span><span id="__span-0-201"><a id="__codelineno-0-201" name="__codelineno-0-201" href="#__codelineno-0-201"></a><span class="w">    </span><span class="c1"># Validar que Min &lt; Base &lt; Max</span>
</span><span id="__span-0-202"><a id="__codelineno-0-202" name="__codelineno-0-202" href="#__codelineno-0-202"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span>current_min<span class="w"> </span>&gt;<span class="o">=</span><span class="w"> </span>current_max:
</span><span id="__span-0-203"><a id="__codelineno-0-203" name="__codelineno-0-203" href="#__codelineno-0-203"></a><span class="w">        </span><span class="nv">current_max</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>current_min<span class="w"> </span>+<span class="w"> </span><span class="m">1</span>
</span><span id="__span-0-204"><a id="__codelineno-0-204" name="__codelineno-0-204" href="#__codelineno-0-204"></a><span class="w">        </span>cv2.setTrackbarPos<span class="o">(</span><span class="s2">&quot;Max&quot;</span>,<span class="w"> </span><span class="s2">&quot;Servo Angles&quot;</span>,<span class="w"> </span>current_max<span class="o">)</span>
</span><span id="__span-0-205"><a id="__codelineno-0-205" name="__codelineno-0-205" href="#__codelineno-0-205"></a>
</span><span id="__span-0-206"><a id="__codelineno-0-206" name="__codelineno-0-206" href="#__codelineno-0-206"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span>current_base<span class="w"> </span>&lt;<span class="w"> </span>current_min:
</span><span id="__span-0-207"><a id="__codelineno-0-207" name="__codelineno-0-207" href="#__codelineno-0-207"></a><span class="w">        </span><span class="nv">current_base</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>current_min
</span><span id="__span-0-208"><a id="__codelineno-0-208" name="__codelineno-0-208" href="#__codelineno-0-208"></a><span class="w">        </span>cv2.setTrackbarPos<span class="o">(</span><span class="s2">&quot;Base&quot;</span>,<span class="w"> </span><span class="s2">&quot;Servo Angles&quot;</span>,<span class="w"> </span>current_base<span class="o">)</span>
</span><span id="__span-0-209"><a id="__codelineno-0-209" name="__codelineno-0-209" href="#__codelineno-0-209"></a><span class="w">    </span><span class="k">elif</span><span class="w"> </span>current_base<span class="w"> </span>&gt;<span class="w"> </span>current_max:
</span><span id="__span-0-210"><a id="__codelineno-0-210" name="__codelineno-0-210" href="#__codelineno-0-210"></a><span class="w">        </span><span class="nv">current_base</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>current_max
</span><span id="__span-0-211"><a id="__codelineno-0-211" name="__codelineno-0-211" href="#__codelineno-0-211"></a><span class="w">        </span>cv2.setTrackbarPos<span class="o">(</span><span class="s2">&quot;Base&quot;</span>,<span class="w"> </span><span class="s2">&quot;Servo Angles&quot;</span>,<span class="w"> </span>current_base<span class="o">)</span>
</span><span id="__span-0-212"><a id="__codelineno-0-212" name="__codelineno-0-212" href="#__codelineno-0-212"></a>
</span><span id="__span-0-213"><a id="__codelineno-0-213" name="__codelineno-0-213" href="#__codelineno-0-213"></a><span class="w">    </span><span class="c1"># Detectar cambios y enviar nueva configuración</span>
</span><span id="__span-0-214"><a id="__codelineno-0-214" name="__codelineno-0-214" href="#__codelineno-0-214"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">(</span>current_base<span class="w"> </span>!<span class="o">=</span><span class="w"> </span>prev_base<span class="w"> </span>or<span class="w"> </span>current_min<span class="w"> </span>!<span class="o">=</span><span class="w"> </span>prev_min<span class="w"> </span>or<span class="w"> </span>current_max<span class="w"> </span>!<span class="o">=</span><span class="w"> </span>prev_max<span class="o">)</span>:
</span><span id="__span-0-215"><a id="__codelineno-0-215" name="__codelineno-0-215" href="#__codelineno-0-215"></a><span class="w">        </span>enviar_config_angulos<span class="o">(</span>current_base,<span class="w"> </span>current_min,<span class="w"> </span>current_max<span class="o">)</span>
</span><span id="__span-0-216"><a id="__codelineno-0-216" name="__codelineno-0-216" href="#__codelineno-0-216"></a><span class="w">        </span>prev_base,<span class="w"> </span>prev_min,<span class="w"> </span><span class="nv">prev_max</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>current_base,<span class="w"> </span>current_min,<span class="w"> </span>current_max
</span><span id="__span-0-217"><a id="__codelineno-0-217" name="__codelineno-0-217" href="#__codelineno-0-217"></a>
</span><span id="__span-0-218"><a id="__codelineno-0-218" name="__codelineno-0-218" href="#__codelineno-0-218"></a><span class="w">    </span><span class="c1"># --- RESTO DE LÓGICA DE VISIÓN Y CONTROL ---</span>
</span><span id="__span-0-219"><a id="__codelineno-0-219" name="__codelineno-0-219" href="#__codelineno-0-219"></a><span class="w">    </span>ret,<span class="w"> </span><span class="nv">frame</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>cap.read<span class="o">()</span>
</span><span id="__span-0-220"><a id="__codelineno-0-220" name="__codelineno-0-220" href="#__codelineno-0-220"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span>not<span class="w"> </span>ret:
</span><span id="__span-0-221"><a id="__codelineno-0-221" name="__codelineno-0-221" href="#__codelineno-0-221"></a><span class="w">        </span><span class="k">break</span>
</span><span id="__span-0-222"><a id="__codelineno-0-222" name="__codelineno-0-222" href="#__codelineno-0-222"></a>
</span><span id="__span-0-223"><a id="__codelineno-0-223" name="__codelineno-0-223" href="#__codelineno-0-223"></a><span class="w">    </span><span class="nv">frame</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>cv2.flip<span class="o">(</span>frame,<span class="w"> </span><span class="m">1</span><span class="o">)</span>
</span><span id="__span-0-224"><a id="__codelineno-0-224" name="__codelineno-0-224" href="#__codelineno-0-224"></a><span class="w">    </span><span class="nv">frame_display</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>frame.copy<span class="o">()</span><span class="w"> </span>
</span><span id="__span-0-225"><a id="__codelineno-0-225" name="__codelineno-0-225" href="#__codelineno-0-225"></a>
</span><span id="__span-0-226"><a id="__codelineno-0-226" name="__codelineno-0-226" href="#__codelineno-0-226"></a><span class="w">    </span><span class="c1"># --- 1) DETECCION DEL PLATO (HOUGH) ---</span>
</span><span id="__span-0-227"><a id="__codelineno-0-227" name="__codelineno-0-227" href="#__codelineno-0-227"></a><span class="w">    </span><span class="nv">gray</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>cv2.cvtColor<span class="o">(</span>frame,<span class="w"> </span>cv2.COLOR_BGR2GRAY<span class="o">)</span>
</span><span id="__span-0-228"><a id="__codelineno-0-228" name="__codelineno-0-228" href="#__codelineno-0-228"></a><span class="w">    </span><span class="nv">blurred</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>cv2.GaussianBlur<span class="o">(</span>gray,<span class="w"> </span><span class="o">(</span><span class="m">5</span>,5<span class="o">)</span>,<span class="w"> </span><span class="m">0</span><span class="o">)</span>
</span><span id="__span-0-229"><a id="__codelineno-0-229" name="__codelineno-0-229" href="#__codelineno-0-229"></a><span class="w">    </span><span class="nv">circles</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>cv2.HoughCircles<span class="o">(</span>
</span><span id="__span-0-230"><a id="__codelineno-0-230" name="__codelineno-0-230" href="#__codelineno-0-230"></a><span class="w">        </span>blurred,<span class="w"> </span>cv2.HOUGH_GRADIENT,
</span><span id="__span-0-231"><a id="__codelineno-0-231" name="__codelineno-0-231" href="#__codelineno-0-231"></a><span class="w">        </span><span class="nv">dp</span><span class="o">=</span>dp,<span class="w"> </span><span class="nv">minDist</span><span class="o">=</span>minDist,
</span><span id="__span-0-232"><a id="__codelineno-0-232" name="__codelineno-0-232" href="#__codelineno-0-232"></a><span class="w">        </span><span class="nv">param1</span><span class="o">=</span>param1,<span class="w"> </span><span class="nv">param2</span><span class="o">=</span>param2,
</span><span id="__span-0-233"><a id="__codelineno-0-233" name="__codelineno-0-233" href="#__codelineno-0-233"></a><span class="w">        </span><span class="nv">minRadius</span><span class="o">=</span>minRadius,<span class="w"> </span><span class="nv">maxRadius</span><span class="o">=</span>maxRadius
</span><span id="__span-0-234"><a id="__codelineno-0-234" name="__codelineno-0-234" href="#__codelineno-0-234"></a><span class="w">    </span><span class="o">)</span>
</span><span id="__span-0-235"><a id="__codelineno-0-235" name="__codelineno-0-235" href="#__codelineno-0-235"></a>
</span><span id="__span-0-236"><a id="__codelineno-0-236" name="__codelineno-0-236" href="#__codelineno-0-236"></a><span class="w">    </span>plato_cx,<span class="w"> </span>plato_cy,<span class="w"> </span><span class="nv">plato_r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>None,<span class="w"> </span>None,<span class="w"> </span>None
</span><span id="__span-0-237"><a id="__codelineno-0-237" name="__codelineno-0-237" href="#__codelineno-0-237"></a>
</span><span id="__span-0-238"><a id="__codelineno-0-238" name="__codelineno-0-238" href="#__codelineno-0-238"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span>circles<span class="w"> </span>is<span class="w"> </span>not<span class="w"> </span>None:
</span><span id="__span-0-239"><a id="__codelineno-0-239" name="__codelineno-0-239" href="#__codelineno-0-239"></a><span class="w">        </span><span class="nv">circles</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>np.round<span class="o">(</span>circles<span class="o">[</span><span class="m">0</span>,<span class="w"> </span>:<span class="o">])</span>.astype<span class="o">(</span><span class="s2">&quot;int&quot;</span><span class="o">)</span>
</span><span id="__span-0-240"><a id="__codelineno-0-240" name="__codelineno-0-240" href="#__codelineno-0-240"></a><span class="w">        </span><span class="nv">radios</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span>r<span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="o">(</span>_,_,r<span class="o">)</span><span class="w"> </span><span class="k">in</span><span class="w"> </span>circles<span class="o">]</span>
</span><span id="__span-0-241"><a id="__codelineno-0-241" name="__codelineno-0-241" href="#__codelineno-0-241"></a><span class="w">        </span><span class="nv">idx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>np.argmax<span class="o">(</span>radios<span class="o">)</span>
</span><span id="__span-0-242"><a id="__codelineno-0-242" name="__codelineno-0-242" href="#__codelineno-0-242"></a><span class="w">        </span>plato_cx,<span class="w"> </span>plato_cy,<span class="w"> </span><span class="nv">plato_r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>circles<span class="o">[</span>idx<span class="o">]</span>
</span><span id="__span-0-243"><a id="__codelineno-0-243" name="__codelineno-0-243" href="#__codelineno-0-243"></a>
</span><span id="__span-0-244"><a id="__codelineno-0-244" name="__codelineno-0-244" href="#__codelineno-0-244"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span>plato_cx_f<span class="w"> </span>is<span class="w"> </span>None:
</span><span id="__span-0-245"><a id="__codelineno-0-245" name="__codelineno-0-245" href="#__codelineno-0-245"></a><span class="w">            </span>plato_cx_f,<span class="w"> </span>plato_cy_f,<span class="w"> </span><span class="nv">plato_r_f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>plato_cx,<span class="w"> </span>plato_cy,<span class="w"> </span>plato_r
</span><span id="__span-0-246"><a id="__codelineno-0-246" name="__codelineno-0-246" href="#__codelineno-0-246"></a><span class="w">        </span><span class="k">else</span>:
</span><span id="__span-0-247"><a id="__codelineno-0-247" name="__codelineno-0-247" href="#__codelineno-0-247"></a><span class="w">            </span><span class="nv">plato_cx_f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>int<span class="o">(</span>alpha_plato*plato_cx<span class="w"> </span>+<span class="w"> </span><span class="o">(</span><span class="m">1</span>-alpha_plato<span class="o">)</span>*plato_cx_f<span class="o">)</span>
</span><span id="__span-0-248"><a id="__codelineno-0-248" name="__codelineno-0-248" href="#__codelineno-0-248"></a><span class="w">            </span><span class="nv">plato_cy_f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>int<span class="o">(</span>alpha_plato*plato_cy<span class="w"> </span>+<span class="w"> </span><span class="o">(</span><span class="m">1</span>-alpha_plato<span class="o">)</span>*plato_cy_f<span class="o">)</span>
</span><span id="__span-0-249"><a id="__codelineno-0-249" name="__codelineno-0-249" href="#__codelineno-0-249"></a><span class="w">            </span><span class="nv">plato_r_f</span><span class="w">  </span><span class="o">=</span><span class="w"> </span>int<span class="o">(</span>alpha_plato*plato_r<span class="w"> </span>+<span class="w"> </span><span class="o">(</span><span class="m">1</span>-alpha_plato<span class="o">)</span>*plato_r_f<span class="o">)</span>
</span><span id="__span-0-250"><a id="__codelineno-0-250" name="__codelineno-0-250" href="#__codelineno-0-250"></a>
</span><span id="__span-0-251"><a id="__codelineno-0-251" name="__codelineno-0-251" href="#__codelineno-0-251"></a><span class="w">        </span>cv2.circle<span class="o">(</span>frame_display,<span class="w"> </span><span class="o">(</span>plato_cx_f,<span class="w"> </span>plato_cy_f<span class="o">)</span>,<span class="w"> </span>plato_r_f,<span class="w"> </span><span class="o">(</span><span class="m">0</span>,255,0<span class="o">)</span>,<span class="w"> </span><span class="m">3</span><span class="o">)</span>
</span><span id="__span-0-252"><a id="__codelineno-0-252" name="__codelineno-0-252" href="#__codelineno-0-252"></a><span class="w">        </span>cv2.circle<span class="o">(</span>frame_display,<span class="w"> </span><span class="o">(</span>plato_cx_f,<span class="w"> </span>plato_cy_f<span class="o">)</span>,<span class="w"> </span><span class="m">6</span>,<span class="w"> </span><span class="o">(</span><span class="m">0</span>,255,0<span class="o">)</span>,<span class="w"> </span>-1<span class="o">)</span><span class="w"> </span><span class="c1"># Centro</span>
</span><span id="__span-0-253"><a id="__codelineno-0-253" name="__codelineno-0-253" href="#__codelineno-0-253"></a>
</span><span id="__span-0-254"><a id="__codelineno-0-254" name="__codelineno-0-254" href="#__codelineno-0-254"></a><span class="w">        </span><span class="c1"># --- NUEVO CÍRCULO: ZONA MUERTA ---</span>
</span><span id="__span-0-255"><a id="__codelineno-0-255" name="__codelineno-0-255" href="#__codelineno-0-255"></a><span class="w">        </span><span class="nv">DEADZONE_RADIUS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">10</span><span class="w"> </span><span class="c1"># Radio en píxeles para la zona muerta (ajusta si es necesario)</span>
</span><span id="__span-0-256"><a id="__codelineno-0-256" name="__codelineno-0-256" href="#__codelineno-0-256"></a><span class="w">        </span>cv2.circle<span class="o">(</span>frame_display,<span class="w"> </span><span class="o">(</span>plato_cx_f,<span class="w"> </span>plato_cy_f<span class="o">)</span>,<span class="w"> </span>DEADZONE_RADIUS,<span class="w"> </span><span class="o">(</span><span class="m">0</span>,165,255<span class="o">)</span>,<span class="w"> </span><span class="m">2</span><span class="o">)</span>
</span><span id="__span-0-257"><a id="__codelineno-0-257" name="__codelineno-0-257" href="#__codelineno-0-257"></a>
</span><span id="__span-0-258"><a id="__codelineno-0-258" name="__codelineno-0-258" href="#__codelineno-0-258"></a><span class="w">        </span>cv2.putText<span class="o">(</span>frame_display,<span class="w"> </span>f<span class="s2">&quot;PLATO DETECTADO (r={plato_r_f})&quot;</span>,<span class="w"> </span>
</span><span id="__span-0-259"><a id="__codelineno-0-259" name="__codelineno-0-259" href="#__codelineno-0-259"></a><span class="w">                             </span><span class="o">(</span>plato_cx_f<span class="w"> </span>-<span class="w"> </span><span class="m">120</span>,<span class="w"> </span>plato_cy_f<span class="w"> </span>-<span class="w"> </span>plato_r_f<span class="w"> </span>-<span class="w"> </span><span class="m">10</span><span class="o">)</span>,<span class="w"> </span>
</span><span id="__span-0-260"><a id="__codelineno-0-260" name="__codelineno-0-260" href="#__codelineno-0-260"></a><span class="w">                             </span>cv2.FONT_HERSHEY_SIMPLEX,<span class="w"> </span><span class="m">0</span>.6,<span class="w"> </span><span class="o">(</span><span class="m">0</span>,255,0<span class="o">)</span>,<span class="w"> </span><span class="m">2</span><span class="o">)</span>
</span><span id="__span-0-261"><a id="__codelineno-0-261" name="__codelineno-0-261" href="#__codelineno-0-261"></a><span class="w">    </span><span class="k">else</span>:
</span><span id="__span-0-262"><a id="__codelineno-0-262" name="__codelineno-0-262" href="#__codelineno-0-262"></a><span class="w">        </span><span class="nv">plato_cx_f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">plato_cy_f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">plato_r_f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>None
</span><span id="__span-0-263"><a id="__codelineno-0-263" name="__codelineno-0-263" href="#__codelineno-0-263"></a><span class="w">        </span>cv2.putText<span class="o">(</span>frame_display,<span class="w"> </span><span class="s2">&quot;PLATO NO DETECTADO&quot;</span>,<span class="w"> </span><span class="o">(</span><span class="m">10</span>,<span class="w"> </span><span class="m">30</span><span class="o">)</span>,<span class="w"> </span>cv2.FONT_HERSHEY_SIMPLEX,<span class="w"> </span><span class="m">0</span>.7,<span class="w"> </span><span class="o">(</span><span class="m">0</span>,0,255<span class="o">)</span>,<span class="w"> </span><span class="m">2</span><span class="o">)</span>
</span><span id="__span-0-264"><a id="__codelineno-0-264" name="__codelineno-0-264" href="#__codelineno-0-264"></a>
</span><span id="__span-0-265"><a id="__codelineno-0-265" name="__codelineno-0-265" href="#__codelineno-0-265"></a><span class="w">    </span><span class="c1"># --- A) ENMASCARAMIENTO CIRCULAR (FONDO NEGRO) ---</span>
</span><span id="__span-0-266"><a id="__codelineno-0-266" name="__codelineno-0-266" href="#__codelineno-0-266"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span>plato_cx_f<span class="w"> </span>is<span class="w"> </span>not<span class="w"> </span>None:
</span><span id="__span-0-267"><a id="__codelineno-0-267" name="__codelineno-0-267" href="#__codelineno-0-267"></a><span class="w">        </span><span class="nv">mask_plato</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>np.zeros<span class="o">(</span>frame.shape<span class="o">[</span>:2<span class="o">]</span>,<span class="w"> </span><span class="nv">dtype</span><span class="o">=</span><span class="s2">&quot;uint8&quot;</span><span class="o">)</span>
</span><span id="__span-0-268"><a id="__codelineno-0-268" name="__codelineno-0-268" href="#__codelineno-0-268"></a><span class="w">        </span>cv2.circle<span class="o">(</span>mask_plato,<span class="w"> </span><span class="o">(</span>plato_cx_f,<span class="w"> </span>plato_cy_f<span class="o">)</span>,<span class="w"> </span>plato_r_f<span class="w"> </span>-<span class="w"> </span><span class="m">5</span>,<span class="w"> </span><span class="m">255</span>,<span class="w"> </span>-1<span class="o">)</span><span class="w"> </span>
</span><span id="__span-0-269"><a id="__codelineno-0-269" name="__codelineno-0-269" href="#__codelineno-0-269"></a><span class="w">        </span><span class="nv">frame_deteccion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>cv2.bitwise_and<span class="o">(</span>frame,<span class="w"> </span>frame,<span class="w"> </span><span class="nv">mask</span><span class="o">=</span>mask_plato<span class="o">)</span>
</span><span id="__span-0-270"><a id="__codelineno-0-270" name="__codelineno-0-270" href="#__codelineno-0-270"></a><span class="w">    </span><span class="k">else</span>:
</span><span id="__span-0-271"><a id="__codelineno-0-271" name="__codelineno-0-271" href="#__codelineno-0-271"></a><span class="w">        </span><span class="nv">frame_deteccion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>frame
</span><span id="__span-0-272"><a id="__codelineno-0-272" name="__codelineno-0-272" href="#__codelineno-0-272"></a>
</span><span id="__span-0-273"><a id="__codelineno-0-273" name="__codelineno-0-273" href="#__codelineno-0-273"></a><span class="w">    </span><span class="c1"># --- 2) DETECCION PELOTA ROJA (COLOR / CENTROIDE) ---</span>
</span><span id="__span-0-274"><a id="__codelineno-0-274" name="__codelineno-0-274" href="#__codelineno-0-274"></a><span class="w">    </span><span class="nv">red_low1</span><span class="w">  </span><span class="o">=</span><span class="w"> </span>np.array<span class="o">([</span><span class="m">0</span>,<span class="w"> </span><span class="m">150</span>,<span class="w"> </span><span class="m">50</span><span class="o">]</span>,<span class="w"> </span>np.uint8<span class="o">)</span>
</span><span id="__span-0-275"><a id="__codelineno-0-275" name="__codelineno-0-275" href="#__codelineno-0-275"></a><span class="w">    </span><span class="nv">red_high1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>np.array<span class="o">([</span><span class="m">8</span>,<span class="w"> </span><span class="m">255</span>,<span class="w"> </span><span class="m">255</span><span class="o">]</span>,<span class="w"> </span>np.uint8<span class="o">)</span>
</span><span id="__span-0-276"><a id="__codelineno-0-276" name="__codelineno-0-276" href="#__codelineno-0-276"></a><span class="w">    </span><span class="nv">red_low2</span><span class="w">  </span><span class="o">=</span><span class="w"> </span>np.array<span class="o">([</span><span class="m">170</span>,<span class="w"> </span><span class="m">150</span>,<span class="w"> </span><span class="m">50</span><span class="o">]</span>,<span class="w"> </span>np.uint8<span class="o">)</span>
</span><span id="__span-0-277"><a id="__codelineno-0-277" name="__codelineno-0-277" href="#__codelineno-0-277"></a><span class="w">    </span><span class="nv">red_high2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>np.array<span class="o">([</span><span class="m">179</span>,<span class="w"> </span><span class="m">255</span>,<span class="w"> </span><span class="m">255</span><span class="o">]</span>,<span class="w"> </span>np.uint8<span class="o">)</span>
</span><span id="__span-0-278"><a id="__codelineno-0-278" name="__codelineno-0-278" href="#__codelineno-0-278"></a>
</span><span id="__span-0-279"><a id="__codelineno-0-279" name="__codelineno-0-279" href="#__codelineno-0-279"></a><span class="w">    </span><span class="nv">hsv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>cv2.cvtColor<span class="o">(</span>frame_deteccion,<span class="w"> </span>cv2.COLOR_BGR2HSV<span class="o">)</span>
</span><span id="__span-0-280"><a id="__codelineno-0-280" name="__codelineno-0-280" href="#__codelineno-0-280"></a><span class="w">    </span><span class="nv">mask1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>cv2.inRange<span class="o">(</span>hsv,<span class="w"> </span>red_low1,<span class="w"> </span>red_high1<span class="o">)</span>
</span><span id="__span-0-281"><a id="__codelineno-0-281" name="__codelineno-0-281" href="#__codelineno-0-281"></a><span class="w">    </span><span class="nv">mask2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>cv2.inRange<span class="o">(</span>hsv,<span class="w"> </span>red_low2,<span class="w"> </span>red_high2<span class="o">)</span>
</span><span id="__span-0-282"><a id="__codelineno-0-282" name="__codelineno-0-282" href="#__codelineno-0-282"></a><span class="w">    </span><span class="nv">mask</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>cv2.add<span class="o">(</span>mask1,<span class="w"> </span>mask2<span class="o">)</span>
</span><span id="__span-0-283"><a id="__codelineno-0-283" name="__codelineno-0-283" href="#__codelineno-0-283"></a>
</span><span id="__span-0-284"><a id="__codelineno-0-284" name="__codelineno-0-284" href="#__codelineno-0-284"></a><span class="w">    </span><span class="nv">kernel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>cv2.getStructuringElement<span class="o">(</span>cv2.MORPH_ELLIPSE,<span class="w"> </span><span class="o">(</span><span class="m">5</span>,5<span class="o">))</span>
</span><span id="__span-0-285"><a id="__codelineno-0-285" name="__codelineno-0-285" href="#__codelineno-0-285"></a><span class="w">    </span><span class="nv">mask</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>cv2.morphologyEx<span class="o">(</span>mask,<span class="w"> </span>cv2.MORPH_OPEN,<span class="w"> </span>kernel<span class="o">)</span>
</span><span id="__span-0-286"><a id="__codelineno-0-286" name="__codelineno-0-286" href="#__codelineno-0-286"></a><span class="w">    </span><span class="nv">mask</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>cv2.morphologyEx<span class="o">(</span>mask,<span class="w"> </span>cv2.MORPH_CLOSE,<span class="w"> </span>kernel<span class="o">)</span>
</span><span id="__span-0-287"><a id="__codelineno-0-287" name="__codelineno-0-287" href="#__codelineno-0-287"></a>
</span><span id="__span-0-288"><a id="__codelineno-0-288" name="__codelineno-0-288" href="#__codelineno-0-288"></a><span class="w">    </span>contornos,<span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>cv2.findContours<span class="o">(</span>mask,<span class="w"> </span>cv2.RETR_EXTERNAL,<span class="w"> </span>cv2.CHAIN_APPROX_SIMPLE<span class="o">)</span>
</span><span id="__span-0-289"><a id="__codelineno-0-289" name="__codelineno-0-289" href="#__codelineno-0-289"></a>
</span><span id="__span-0-290"><a id="__codelineno-0-290" name="__codelineno-0-290" href="#__codelineno-0-290"></a><span class="w">    </span><span class="nv">mejor_c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>None
</span><span id="__span-0-291"><a id="__codelineno-0-291" name="__codelineno-0-291" href="#__codelineno-0-291"></a><span class="w">    </span><span class="nv">mejor_cx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">mejor_cy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span>
</span><span id="__span-0-292"><a id="__codelineno-0-292" name="__codelineno-0-292" href="#__codelineno-0-292"></a><span class="w">    </span><span class="nv">mejor_area</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span>
</span><span id="__span-0-293"><a id="__codelineno-0-293" name="__codelineno-0-293" href="#__codelineno-0-293"></a>
</span><span id="__span-0-294"><a id="__codelineno-0-294" name="__codelineno-0-294" href="#__codelineno-0-294"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span>c<span class="w"> </span><span class="k">in</span><span class="w"> </span>contornos:
</span><span id="__span-0-295"><a id="__codelineno-0-295" name="__codelineno-0-295" href="#__codelineno-0-295"></a><span class="w">        </span><span class="nv">area</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>cv2.contourArea<span class="o">(</span>c<span class="o">)</span>
</span><span id="__span-0-296"><a id="__codelineno-0-296" name="__codelineno-0-296" href="#__codelineno-0-296"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="m">100</span><span class="w"> </span>&lt;<span class="w"> </span>area<span class="w"> </span>&lt;<span class="w"> </span><span class="m">5000</span>:
</span><span id="__span-0-297"><a id="__codelineno-0-297" name="__codelineno-0-297" href="#__codelineno-0-297"></a><span class="w">            </span><span class="nv">M</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>cv2.moments<span class="o">(</span>c<span class="o">)</span>
</span><span id="__span-0-298"><a id="__codelineno-0-298" name="__codelineno-0-298" href="#__codelineno-0-298"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span>M<span class="o">[</span><span class="s2">&quot;m00&quot;</span><span class="o">]</span><span class="w"> </span>!<span class="o">=</span><span class="w"> </span><span class="m">0</span>:
</span><span id="__span-0-299"><a id="__codelineno-0-299" name="__codelineno-0-299" href="#__codelineno-0-299"></a><span class="w">                </span><span class="nv">cx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>int<span class="o">(</span>M<span class="o">[</span><span class="s2">&quot;m10&quot;</span><span class="o">]</span>/M<span class="o">[</span><span class="s2">&quot;m00&quot;</span><span class="o">])</span>
</span><span id="__span-0-300"><a id="__codelineno-0-300" name="__codelineno-0-300" href="#__codelineno-0-300"></a><span class="w">                </span><span class="nv">cy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>int<span class="o">(</span>M<span class="o">[</span><span class="s2">&quot;m01&quot;</span><span class="o">]</span>/M<span class="o">[</span><span class="s2">&quot;m00&quot;</span><span class="o">])</span>
</span><span id="__span-0-301"><a id="__codelineno-0-301" name="__codelineno-0-301" href="#__codelineno-0-301"></a>
</span><span id="__span-0-302"><a id="__codelineno-0-302" name="__codelineno-0-302" href="#__codelineno-0-302"></a><span class="w">                </span><span class="k">if</span><span class="w"> </span>mejor_c<span class="w"> </span>is<span class="w"> </span>None<span class="w"> </span>or<span class="w"> </span>area<span class="w"> </span>&gt;<span class="w"> </span>mejor_area:
</span><span id="__span-0-303"><a id="__codelineno-0-303" name="__codelineno-0-303" href="#__codelineno-0-303"></a><span class="w">                    </span>mejor_c,<span class="w"> </span>mejor_cx,<span class="w"> </span>mejor_cy,<span class="w"> </span><span class="nv">mejor_area</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>c,<span class="w"> </span>cx,<span class="w"> </span>cy,<span class="w"> </span>area
</span><span id="__span-0-304"><a id="__codelineno-0-304" name="__codelineno-0-304" href="#__codelineno-0-304"></a>
</span><span id="__span-0-305"><a id="__codelineno-0-305" name="__codelineno-0-305" href="#__codelineno-0-305"></a><span class="w">    </span><span class="c1"># --- 3) CALCULO Y SUAVIZADO DE ERROR ---</span>
</span><span id="__span-0-306"><a id="__codelineno-0-306" name="__codelineno-0-306" href="#__codelineno-0-306"></a><span class="w">    </span><span class="nv">errX_raw</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span>.0
</span><span id="__span-0-307"><a id="__codelineno-0-307" name="__codelineno-0-307" href="#__codelineno-0-307"></a><span class="w">    </span><span class="nv">errY_raw</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span>.0
</span><span id="__span-0-308"><a id="__codelineno-0-308" name="__codelineno-0-308" href="#__codelineno-0-308"></a><span class="w">    </span><span class="nv">pelota_detectada</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>False
</span><span id="__span-0-309"><a id="__codelineno-0-309" name="__codelineno-0-309" href="#__codelineno-0-309"></a>
</span><span id="__span-0-310"><a id="__codelineno-0-310" name="__codelineno-0-310" href="#__codelineno-0-310"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span>mejor_c<span class="w"> </span>is<span class="w"> </span>not<span class="w"> </span>None<span class="w"> </span>and<span class="w"> </span>plato_cx_f<span class="w"> </span>is<span class="w"> </span>not<span class="w"> </span>None:
</span><span id="__span-0-311"><a id="__codelineno-0-311" name="__codelineno-0-311" href="#__codelineno-0-311"></a><span class="w">        </span><span class="nv">dist_al_centro</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>math.hypot<span class="o">(</span>mejor_cx<span class="w"> </span>-<span class="w"> </span>plato_cx_f,<span class="w"> </span>mejor_cy<span class="w"> </span>-<span class="w"> </span>plato_cy_f<span class="o">)</span>
</span><span id="__span-0-312"><a id="__codelineno-0-312" name="__codelineno-0-312" href="#__codelineno-0-312"></a>
</span><span id="__span-0-313"><a id="__codelineno-0-313" name="__codelineno-0-313" href="#__codelineno-0-313"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span>dist_al_centro<span class="w"> </span>&lt;<span class="w"> </span>plato_r_f:
</span><span id="__span-0-314"><a id="__codelineno-0-314" name="__codelineno-0-314" href="#__codelineno-0-314"></a><span class="w">            </span><span class="nv">pelota_detectada</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>True
</span><span id="__span-0-315"><a id="__codelineno-0-315" name="__codelineno-0-315" href="#__codelineno-0-315"></a>
</span><span id="__span-0-316"><a id="__codelineno-0-316" name="__codelineno-0-316" href="#__codelineno-0-316"></a><span class="w">            </span><span class="nv">errX_raw</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>mejor_cx<span class="w"> </span>-<span class="w"> </span>plato_cx_f<span class="w"> </span>
</span><span id="__span-0-317"><a id="__codelineno-0-317" name="__codelineno-0-317" href="#__codelineno-0-317"></a><span class="w">            </span><span class="nv">errY_raw</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>mejor_cy<span class="w"> </span>-<span class="w"> </span>plato_cy_f<span class="w"> </span>
</span><span id="__span-0-318"><a id="__codelineno-0-318" name="__codelineno-0-318" href="#__codelineno-0-318"></a>
</span><span id="__span-0-319"><a id="__codelineno-0-319" name="__codelineno-0-319" href="#__codelineno-0-319"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span>plato_r_f<span class="w"> </span>&gt;<span class="w"> </span><span class="m">0</span>:
</span><span id="__span-0-320"><a id="__codelineno-0-320" name="__codelineno-0-320" href="#__codelineno-0-320"></a><span class="w">                 </span><span class="nv">errX_norm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>errX_raw<span class="w"> </span>/<span class="w"> </span>plato_r_f
</span><span id="__span-0-321"><a id="__codelineno-0-321" name="__codelineno-0-321" href="#__codelineno-0-321"></a><span class="w">                 </span><span class="nv">errY_norm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>errY_raw<span class="w"> </span>/<span class="w"> </span>plato_r_f
</span><span id="__span-0-322"><a id="__codelineno-0-322" name="__codelineno-0-322" href="#__codelineno-0-322"></a><span class="w">            </span><span class="k">else</span>:
</span><span id="__span-0-323"><a id="__codelineno-0-323" name="__codelineno-0-323" href="#__codelineno-0-323"></a><span class="w">                 </span>errX_norm,<span class="w"> </span><span class="nv">errY_norm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span>.0,<span class="w"> </span><span class="m">0</span>.0
</span><span id="__span-0-324"><a id="__codelineno-0-324" name="__codelineno-0-324" href="#__codelineno-0-324"></a>
</span><span id="__span-0-325"><a id="__codelineno-0-325" name="__codelineno-0-325" href="#__codelineno-0-325"></a><span class="w">            </span><span class="nv">errX_f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>alpha_err<span class="w"> </span>*<span class="w"> </span>errX_norm<span class="w"> </span>+<span class="w"> </span><span class="o">(</span><span class="m">1</span>-alpha_err<span class="o">)</span><span class="w"> </span>*<span class="w"> </span>errX_f
</span><span id="__span-0-326"><a id="__codelineno-0-326" name="__codelineno-0-326" href="#__codelineno-0-326"></a><span class="w">            </span><span class="nv">errY_f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>alpha_err<span class="w"> </span>*<span class="w"> </span>errY_norm<span class="w"> </span>+<span class="w"> </span><span class="o">(</span><span class="m">1</span>-alpha_err<span class="o">)</span><span class="w"> </span>*<span class="w"> </span>errY_f
</span><span id="__span-0-327"><a id="__codelineno-0-327" name="__codelineno-0-327" href="#__codelineno-0-327"></a>
</span><span id="__span-0-328"><a id="__codelineno-0-328" name="__codelineno-0-328" href="#__codelineno-0-328"></a><span class="w">            </span>cv2.circle<span class="o">(</span>frame_display,<span class="w"> </span><span class="o">(</span>mejor_cx,<span class="w"> </span>mejor_cy<span class="o">)</span>,<span class="w"> </span><span class="m">8</span>,<span class="w"> </span><span class="o">(</span><span class="m">0</span>,0,255<span class="o">)</span>,<span class="w"> </span>-1<span class="o">)</span>
</span><span id="__span-0-329"><a id="__codelineno-0-329" name="__codelineno-0-329" href="#__codelineno-0-329"></a><span class="w">            </span>cv2.line<span class="o">(</span>frame_display,<span class="w"> </span><span class="o">(</span>mejor_cx,<span class="w"> </span>mejor_cy<span class="o">)</span>,<span class="w"> </span><span class="o">(</span>plato_cx_f,<span class="w"> </span>plato_cy_f<span class="o">)</span>,<span class="w"> </span><span class="o">(</span><span class="m">255</span>,0,0<span class="o">)</span>,<span class="w"> </span><span class="m">2</span><span class="o">)</span>
</span><span id="__span-0-330"><a id="__codelineno-0-330" name="__codelineno-0-330" href="#__codelineno-0-330"></a>
</span><span id="__span-0-331"><a id="__codelineno-0-331" name="__codelineno-0-331" href="#__codelineno-0-331"></a><span class="w">        </span><span class="k">else</span>:
</span><span id="__span-0-332"><a id="__codelineno-0-332" name="__codelineno-0-332" href="#__codelineno-0-332"></a><span class="w">            </span>errX_f,<span class="w"> </span><span class="nv">errY_f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span>.0,<span class="w"> </span><span class="m">0</span>.0
</span><span id="__span-0-333"><a id="__codelineno-0-333" name="__codelineno-0-333" href="#__codelineno-0-333"></a><span class="w">            </span><span class="c1"># RESETEAR PID cuando no hay pelota</span>
</span><span id="__span-0-334"><a id="__codelineno-0-334" name="__codelineno-0-334" href="#__codelineno-0-334"></a><span class="w">            </span>pid_x.integral<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span>.0
</span><span id="__span-0-335"><a id="__codelineno-0-335" name="__codelineno-0-335" href="#__codelineno-0-335"></a><span class="w">            </span>pid_y.integral<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span>.0
</span><span id="__span-0-336"><a id="__codelineno-0-336" name="__codelineno-0-336" href="#__codelineno-0-336"></a><span class="w">            </span>pid_x.prev_error<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span>.0
</span><span id="__span-0-337"><a id="__codelineno-0-337" name="__codelineno-0-337" href="#__codelineno-0-337"></a><span class="w">            </span>pid_y.prev_error<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span>.0
</span><span id="__span-0-338"><a id="__codelineno-0-338" name="__codelineno-0-338" href="#__codelineno-0-338"></a><span class="w">    </span><span class="k">else</span>:
</span><span id="__span-0-339"><a id="__codelineno-0-339" name="__codelineno-0-339" href="#__codelineno-0-339"></a><span class="w">        </span>errX_f,<span class="w"> </span><span class="nv">errY_f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span>.0,<span class="w"> </span><span class="m">0</span>.0
</span><span id="__span-0-340"><a id="__codelineno-0-340" name="__codelineno-0-340" href="#__codelineno-0-340"></a><span class="w">        </span><span class="c1"># RESETEAR PID cuando no hay pelota</span>
</span><span id="__span-0-341"><a id="__codelineno-0-341" name="__codelineno-0-341" href="#__codelineno-0-341"></a><span class="w">        </span>pid_x.integral<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span>.0
</span><span id="__span-0-342"><a id="__codelineno-0-342" name="__codelineno-0-342" href="#__codelineno-0-342"></a><span class="w">        </span>pid_y.integral<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span>.0
</span><span id="__span-0-343"><a id="__codelineno-0-343" name="__codelineno-0-343" href="#__codelineno-0-343"></a><span class="w">        </span>pid_x.prev_error<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span>.0
</span><span id="__span-0-344"><a id="__codelineno-0-344" name="__codelineno-0-344" href="#__codelineno-0-344"></a><span class="w">        </span>pid_y.prev_error<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span>.0
</span><span id="__span-0-345"><a id="__codelineno-0-345" name="__codelineno-0-345" href="#__codelineno-0-345"></a>
</span><span id="__span-0-346"><a id="__codelineno-0-346" name="__codelineno-0-346" href="#__codelineno-0-346"></a><span class="w">    </span><span class="c1"># --- 4) CONTROL PID Y ENVÍO SERIAL (🎯 LÓGICA CORREGIDA) ---</span>
</span><span id="__span-0-347"><a id="__codelineno-0-347" name="__codelineno-0-347" href="#__codelineno-0-347"></a><span class="w">    </span><span class="nv">errX_input</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>errX_f<span class="w"> </span>*<span class="w"> </span><span class="m">100</span>
</span><span id="__span-0-348"><a id="__codelineno-0-348" name="__codelineno-0-348" href="#__codelineno-0-348"></a><span class="w">    </span><span class="nv">errY_input</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>errY_f<span class="w"> </span>*<span class="w"> </span><span class="m">100</span>
</span><span id="__span-0-349"><a id="__codelineno-0-349" name="__codelineno-0-349" href="#__codelineno-0-349"></a>
</span><span id="__span-0-350"><a id="__codelineno-0-350" name="__codelineno-0-350" href="#__codelineno-0-350"></a><span class="w">    </span><span class="c1"># Zona muerta para estabilidad</span>
</span><span id="__span-0-351"><a id="__codelineno-0-351" name="__codelineno-0-351" href="#__codelineno-0-351"></a><span class="w">    </span><span class="nv">DEADZONE_ERR_INPUT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">5</span>.0
</span><span id="__span-0-352"><a id="__codelineno-0-352" name="__codelineno-0-352" href="#__codelineno-0-352"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span>abs<span class="o">(</span>errX_input<span class="o">)</span><span class="w"> </span>&lt;<span class="w"> </span>DEADZONE_ERR_INPUT:
</span><span id="__span-0-353"><a id="__codelineno-0-353" name="__codelineno-0-353" href="#__codelineno-0-353"></a><span class="w">        </span><span class="nv">errX_input</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span>.0
</span><span id="__span-0-354"><a id="__codelineno-0-354" name="__codelineno-0-354" href="#__codelineno-0-354"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span>abs<span class="o">(</span>errY_input<span class="o">)</span><span class="w"> </span>&lt;<span class="w"> </span>DEADZONE_ERR_INPUT:
</span><span id="__span-0-355"><a id="__codelineno-0-355" name="__codelineno-0-355" href="#__codelineno-0-355"></a><span class="w">        </span><span class="nv">errY_input</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span>.0
</span><span id="__span-0-356"><a id="__codelineno-0-356" name="__codelineno-0-356" href="#__codelineno-0-356"></a>
</span><span id="__span-0-357"><a id="__codelineno-0-357" name="__codelineno-0-357" href="#__codelineno-0-357"></a><span class="w">    </span><span class="c1"># 🎯 CORRECCIÓN CLAVE: INVERTIR SEÑAL DE CONTROL</span>
</span><span id="__span-0-358"><a id="__codelineno-0-358" name="__codelineno-0-358" href="#__codelineno-0-358"></a><span class="w">    </span><span class="nv">theta_X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>-pid_x.update<span class="o">(</span>errX_input<span class="o">)</span><span class="w">  </span><span class="c1"># ← NEGATIVO: COMPENSA el error</span>
</span><span id="__span-0-359"><a id="__codelineno-0-359" name="__codelineno-0-359" href="#__codelineno-0-359"></a><span class="w">    </span><span class="nv">theta_Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>-pid_y.update<span class="o">(</span>errY_input<span class="o">)</span><span class="w">  </span><span class="c1"># ← NEGATIVO: COMPENSA el error</span>
</span><span id="__span-0-360"><a id="__codelineno-0-360" name="__codelineno-0-360" href="#__codelineno-0-360"></a>
</span><span id="__span-0-361"><a id="__codelineno-0-361" name="__codelineno-0-361" href="#__codelineno-0-361"></a><span class="w">    </span><span class="c1"># Limitar inclinaciones extremas</span>
</span><span id="__span-0-362"><a id="__codelineno-0-362" name="__codelineno-0-362" href="#__codelineno-0-362"></a><span class="w">    </span><span class="nv">theta_X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>np.clip<span class="o">(</span>theta_X,<span class="w"> </span>-25,<span class="w"> </span><span class="m">25</span><span class="o">)</span>
</span><span id="__span-0-363"><a id="__codelineno-0-363" name="__codelineno-0-363" href="#__codelineno-0-363"></a><span class="w">    </span><span class="nv">theta_Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>np.clip<span class="o">(</span>theta_Y,<span class="w"> </span>-25,<span class="w"> </span><span class="m">25</span><span class="o">)</span>
</span><span id="__span-0-364"><a id="__codelineno-0-364" name="__codelineno-0-364" href="#__codelineno-0-364"></a>
</span><span id="__span-0-365"><a id="__codelineno-0-365" name="__codelineno-0-365" href="#__codelineno-0-365"></a><span class="w">    </span>A1,<span class="w"> </span>A2,<span class="w"> </span><span class="nv">A3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>calcular_angulos_servos<span class="o">(</span>theta_X,<span class="w"> </span>theta_Y,<span class="w"> </span>current_base,<span class="w"> </span>current_min,<span class="w"> </span>current_max<span class="o">)</span>
</span><span id="__span-0-366"><a id="__codelineno-0-366" name="__codelineno-0-366" href="#__codelineno-0-366"></a>
</span><span id="__span-0-367"><a id="__codelineno-0-367" name="__codelineno-0-367" href="#__codelineno-0-367"></a><span class="w">    </span><span class="nv">comando</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>f<span class="s2">&quot;A1:{A1},A2:{A2},A3:{A3}\n&quot;</span>
</span><span id="__span-0-368"><a id="__codelineno-0-368" name="__codelineno-0-368" href="#__codelineno-0-368"></a>
</span><span id="__span-0-369"><a id="__codelineno-0-369" name="__codelineno-0-369" href="#__codelineno-0-369"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span>arduino<span class="w"> </span>is<span class="w"> </span>not<span class="w"> </span>None:
</span><span id="__span-0-370"><a id="__codelineno-0-370" name="__codelineno-0-370" href="#__codelineno-0-370"></a><span class="w">        </span>try:
</span><span id="__span-0-371"><a id="__codelineno-0-371" name="__codelineno-0-371" href="#__codelineno-0-371"></a><span class="w">            </span>arduino.write<span class="o">(</span>comando.encode<span class="o">(</span><span class="s1">&#39;ascii&#39;</span><span class="o">))</span>
</span><span id="__span-0-372"><a id="__codelineno-0-372" name="__codelineno-0-372" href="#__codelineno-0-372"></a><span class="w">        </span>except<span class="w"> </span>Exception<span class="w"> </span>as<span class="w"> </span>e:
</span><span id="__span-0-373"><a id="__codelineno-0-373" name="__codelineno-0-373" href="#__codelineno-0-373"></a><span class="w">            </span>print<span class="o">(</span>f<span class="s2">&quot;Error al enviar datos: {e}&quot;</span><span class="o">)</span>
</span><span id="__span-0-374"><a id="__codelineno-0-374" name="__codelineno-0-374" href="#__codelineno-0-374"></a>
</span><span id="__span-0-375"><a id="__codelineno-0-375" name="__codelineno-0-375" href="#__codelineno-0-375"></a><span class="w">    </span><span class="c1"># --- 5) HUD FINAL ---</span>
</span><span id="__span-0-376"><a id="__codelineno-0-376" name="__codelineno-0-376" href="#__codelineno-0-376"></a><span class="w">    </span><span class="nv">font</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>cv2.FONT_HERSHEY_SIMPLEX
</span><span id="__span-0-377"><a id="__codelineno-0-377" name="__codelineno-0-377" href="#__codelineno-0-377"></a>
</span><span id="__span-0-378"><a id="__codelineno-0-378" name="__codelineno-0-378" href="#__codelineno-0-378"></a><span class="w">    </span>cv2.putText<span class="o">(</span>frame_display,<span class="w"> </span>f<span class="s2">&quot;Kp:{kp_val:.1f} Ki:{ki_val:.2f} Kd:{kd_val:.1f}&quot;</span>,<span class="w"> </span>
</span><span id="__span-0-379"><a id="__codelineno-0-379" name="__codelineno-0-379" href="#__codelineno-0-379"></a><span class="w">                </span><span class="o">(</span><span class="m">10</span>,<span class="w"> </span>frame_display.shape<span class="o">[</span><span class="m">0</span><span class="o">]</span>-120<span class="o">)</span>,<span class="w"> </span>font,<span class="w"> </span><span class="m">0</span>.5,<span class="w"> </span><span class="o">(</span><span class="m">255</span>,255,0<span class="o">)</span>,<span class="w"> </span><span class="m">2</span><span class="o">)</span>
</span><span id="__span-0-380"><a id="__codelineno-0-380" name="__codelineno-0-380" href="#__codelineno-0-380"></a>
</span><span id="__span-0-381"><a id="__codelineno-0-381" name="__codelineno-0-381" href="#__codelineno-0-381"></a><span class="w">    </span>cv2.putText<span class="o">(</span>frame_display,<span class="w"> </span>f<span class="s2">&quot;Base:{current_base} Min:{current_min} Max:{current_max}&quot;</span>,<span class="w"> </span>
</span><span id="__span-0-382"><a id="__codelineno-0-382" name="__codelineno-0-382" href="#__codelineno-0-382"></a><span class="w">                </span><span class="o">(</span><span class="m">10</span>,<span class="w"> </span>frame_display.shape<span class="o">[</span><span class="m">0</span><span class="o">]</span>-95<span class="o">)</span>,<span class="w"> </span>font,<span class="w"> </span><span class="m">0</span>.5,<span class="w"> </span><span class="o">(</span><span class="m">255</span>,165,0<span class="o">)</span>,<span class="w"> </span><span class="m">2</span><span class="o">)</span>
</span><span id="__span-0-383"><a id="__codelineno-0-383" name="__codelineno-0-383" href="#__codelineno-0-383"></a>
</span><span id="__span-0-384"><a id="__codelineno-0-384" name="__codelineno-0-384" href="#__codelineno-0-384"></a><span class="w">    </span>cv2.putText<span class="o">(</span>frame_display,<span class="w"> </span>f<span class="s2">&quot;Angulos: A1:{A1} A2:{A2} A3:{A3}&quot;</span>,<span class="w"> </span>
</span><span id="__span-0-385"><a id="__codelineno-0-385" name="__codelineno-0-385" href="#__codelineno-0-385"></a><span class="w">                </span><span class="o">(</span><span class="m">10</span>,<span class="w"> </span>frame_display.shape<span class="o">[</span><span class="m">0</span><span class="o">]</span>-70<span class="o">)</span>,<span class="w"> </span>font,<span class="w"> </span><span class="m">0</span>.5,<span class="w"> </span><span class="o">(</span><span class="m">255</span>,255,0<span class="o">)</span>,<span class="w"> </span><span class="m">2</span><span class="o">)</span>
</span><span id="__span-0-386"><a id="__codelineno-0-386" name="__codelineno-0-386" href="#__codelineno-0-386"></a>
</span><span id="__span-0-387"><a id="__codelineno-0-387" name="__codelineno-0-387" href="#__codelineno-0-387"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span>pelota_detectada:
</span><span id="__span-0-388"><a id="__codelineno-0-388" name="__codelineno-0-388" href="#__codelineno-0-388"></a><span class="w">        </span>cv2.putText<span class="o">(</span>frame_display,<span class="w"> </span>
</span><span id="__span-0-389"><a id="__codelineno-0-389" name="__codelineno-0-389" href="#__codelineno-0-389"></a><span class="w">                    </span>f<span class="s1">&#39;Inclinacion X,Y: ({theta_X:+.1f} deg, {theta_Y:+.1f} deg)&#39;</span>,<span class="w"> </span>
</span><span id="__span-0-390"><a id="__codelineno-0-390" name="__codelineno-0-390" href="#__codelineno-0-390"></a><span class="w">                    </span><span class="o">(</span><span class="m">10</span>,<span class="w"> </span>frame_display.shape<span class="o">[</span><span class="m">0</span><span class="o">]</span>-45<span class="o">)</span>,<span class="w"> </span>font,<span class="w"> </span><span class="m">0</span>.5,<span class="w"> </span><span class="o">(</span><span class="m">0</span>,255,0<span class="o">)</span>,<span class="w"> </span><span class="m">2</span><span class="o">)</span>
</span><span id="__span-0-391"><a id="__codelineno-0-391" name="__codelineno-0-391" href="#__codelineno-0-391"></a><span class="w">        </span>cv2.putText<span class="o">(</span>frame_display,<span class="w"> </span>
</span><span id="__span-0-392"><a id="__codelineno-0-392" name="__codelineno-0-392" href="#__codelineno-0-392"></a><span class="w">                    </span>f<span class="s1">&#39;Error Norm X,Y: ({errX_f:+.2f}, {errY_f:+.2f})&#39;</span>,<span class="w"> </span>
</span><span id="__span-0-393"><a id="__codelineno-0-393" name="__codelineno-0-393" href="#__codelineno-0-393"></a><span class="w">                    </span><span class="o">(</span><span class="m">10</span>,<span class="w"> </span>frame_display.shape<span class="o">[</span><span class="m">0</span><span class="o">]</span>-20<span class="o">)</span>,<span class="w"> </span>font,<span class="w"> </span><span class="m">0</span>.5,<span class="w"> </span><span class="o">(</span><span class="m">0</span>,255,255<span class="o">)</span>,<span class="w"> </span><span class="m">2</span><span class="o">)</span>
</span><span id="__span-0-394"><a id="__codelineno-0-394" name="__codelineno-0-394" href="#__codelineno-0-394"></a><span class="w">    </span><span class="k">else</span>:
</span><span id="__span-0-395"><a id="__codelineno-0-395" name="__codelineno-0-395" href="#__codelineno-0-395"></a><span class="w">        </span>cv2.putText<span class="o">(</span>frame_display,<span class="w"> </span><span class="s2">&quot;PELOTA NO DETECTADA O FUERA DEL PLATO&quot;</span>,<span class="w"> </span>
</span><span id="__span-0-396"><a id="__codelineno-0-396" name="__codelineno-0-396" href="#__codelineno-0-396"></a><span class="w">                    </span><span class="o">(</span><span class="m">10</span>,<span class="w"> </span>frame_display.shape<span class="o">[</span><span class="m">0</span><span class="o">]</span>-20<span class="o">)</span>,<span class="w"> </span>font,<span class="w"> </span><span class="m">0</span>.5,<span class="w"> </span><span class="o">(</span><span class="m">0</span>,165,255<span class="o">)</span>,<span class="w"> </span><span class="m">2</span><span class="o">)</span>
</span><span id="__span-0-397"><a id="__codelineno-0-397" name="__codelineno-0-397" href="#__codelineno-0-397"></a>
</span><span id="__span-0-398"><a id="__codelineno-0-398" name="__codelineno-0-398" href="#__codelineno-0-398"></a><span class="w">    </span>cv2.imshow<span class="o">(</span><span class="s1">&#39;CONTROL DE BALANZA (PID ACTIVO)&#39;</span>,<span class="w"> </span>frame_display<span class="o">)</span>
</span><span id="__span-0-399"><a id="__codelineno-0-399" name="__codelineno-0-399" href="#__codelineno-0-399"></a><span class="w">    </span>cv2.imshow<span class="o">(</span><span class="s1">&#39;Imagen de Deteccion (Solo Plato Visible)&#39;</span>,<span class="w"> </span>frame_deteccion<span class="o">)</span>
</span><span id="__span-0-400"><a id="__codelineno-0-400" name="__codelineno-0-400" href="#__codelineno-0-400"></a>
</span><span id="__span-0-401"><a id="__codelineno-0-401" name="__codelineno-0-401" href="#__codelineno-0-401"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span>cv2.waitKey<span class="o">(</span><span class="m">1</span><span class="o">)</span><span class="w"> </span><span class="p">&amp;</span><span class="w"> </span><span class="nv">0xFF</span><span class="w"> </span><span class="o">==</span><span class="w"> </span>ord<span class="o">(</span><span class="s1">&#39;q&#39;</span><span class="o">)</span>:
</span><span id="__span-0-402"><a id="__codelineno-0-402" name="__codelineno-0-402" href="#__codelineno-0-402"></a><span class="w">        </span><span class="k">break</span>
</span><span id="__span-0-403"><a id="__codelineno-0-403" name="__codelineno-0-403" href="#__codelineno-0-403"></a>
</span><span id="__span-0-404"><a id="__codelineno-0-404" name="__codelineno-0-404" href="#__codelineno-0-404"></a><span class="w">    </span>time.sleep<span class="o">(</span>pid_dt<span class="o">)</span><span class="w"> </span>
</span><span id="__span-0-405"><a id="__codelineno-0-405" name="__codelineno-0-405" href="#__codelineno-0-405"></a>
</span><span id="__span-0-406"><a id="__codelineno-0-406" name="__codelineno-0-406" href="#__codelineno-0-406"></a><span class="c1"># ===================== LIMPIEZA =====================</span>
</span><span id="__span-0-407"><a id="__codelineno-0-407" name="__codelineno-0-407" href="#__codelineno-0-407"></a>print<span class="o">(</span><span class="s2">&quot;\n✓ Sistema cerrado. Centrando Servos...&quot;</span><span class="o">)</span>
</span><span id="__span-0-408"><a id="__codelineno-0-408" name="__codelineno-0-408" href="#__codelineno-0-408"></a><span class="k">if</span><span class="w"> </span>arduino<span class="w"> </span>is<span class="w"> </span>not<span class="w"> </span>None:
</span><span id="__span-0-409"><a id="__codelineno-0-409" name="__codelineno-0-409" href="#__codelineno-0-409"></a><span class="w">    </span><span class="nv">comando_cierre</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>f<span class="s2">&quot;A1:{current_base},A2:{current_base},A3:{current_base}\n&quot;</span>
</span><span id="__span-0-410"><a id="__codelineno-0-410" name="__codelineno-0-410" href="#__codelineno-0-410"></a><span class="w">    </span>arduino.write<span class="o">(</span>comando_cierre.encode<span class="o">(</span><span class="s1">&#39;ascii&#39;</span><span class="o">))</span>
</span><span id="__span-0-411"><a id="__codelineno-0-411" name="__codelineno-0-411" href="#__codelineno-0-411"></a><span class="w">    </span>time.sleep<span class="o">(</span><span class="m">0</span>.5<span class="o">)</span>
</span><span id="__span-0-412"><a id="__codelineno-0-412" name="__codelineno-0-412" href="#__codelineno-0-412"></a><span class="w">    </span>arduino.close<span class="o">()</span>
</span><span id="__span-0-413"><a id="__codelineno-0-413" name="__codelineno-0-413" href="#__codelineno-0-413"></a>
</span><span id="__span-0-414"><a id="__codelineno-0-414" name="__codelineno-0-414" href="#__codelineno-0-414"></a>cap.release<span class="o">()</span>
</span><span id="__span-0-415"><a id="__codelineno-0-415" name="__codelineno-0-415" href="#__codelineno-0-415"></a>cv2.destroyAllWindows<span class="o">()</span>
</span></code></pre></div>
<h2 id="codigo-test-de-cuadrantes">Codigo Test de Cuadrantes</h2>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>import<span class="w"> </span>cv2
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>import<span class="w"> </span>numpy<span class="w"> </span>as<span class="w"> </span>np
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a>import<span class="w"> </span>serial
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a>import<span class="w"> </span>serial.tools.list_ports
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a>import<span class="w"> </span><span class="nb">time</span>
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a>import<span class="w"> </span>math
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a>
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a><span class="c1"># Configuración serial ARDUINO UNO</span>
</span><span id="__span-1-9"><a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a><span class="nv">PUERTO_SERIAL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;COM11&#39;</span>
</span><span id="__span-1-10"><a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a><span class="nv">BAUDRATE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">11520</span>
</span><span id="__span-1-11"><a id="__codelineno-1-11" name="__codelineno-1-11" href="#__codelineno-1-11"></a><span class="nv">TIMEOUT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span>.01
</span><span id="__span-1-12"><a id="__codelineno-1-12" name="__codelineno-1-12" href="#__codelineno-1-12"></a>
</span><span id="__span-1-13"><a id="__codelineno-1-13" name="__codelineno-1-13" href="#__codelineno-1-13"></a><span class="c1"># Slicers interactivos para área</span>
</span><span id="__span-1-14"><a id="__codelineno-1-14" name="__codelineno-1-14" href="#__codelineno-1-14"></a><span class="nv">min_area</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">100</span>
</span><span id="__span-1-15"><a id="__codelineno-1-15" name="__codelineno-1-15" href="#__codelineno-1-15"></a><span class="nv">max_area</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">8000</span>
</span><span id="__span-1-16"><a id="__codelineno-1-16" name="__codelineno-1-16" href="#__codelineno-1-16"></a><span class="nv">alto_slicer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">30</span>
</span><span id="__span-1-17"><a id="__codelineno-1-17" name="__codelineno-1-17" href="#__codelineno-1-17"></a>
</span><span id="__span-1-18"><a id="__codelineno-1-18" name="__codelineno-1-18" href="#__codelineno-1-18"></a><span class="c1"># Variables globales para mouse</span>
</span><span id="__span-1-19"><a id="__codelineno-1-19" name="__codelineno-1-19" href="#__codelineno-1-19"></a>mouse_x,<span class="w"> </span><span class="nv">mouse_y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span>,<span class="w"> </span><span class="m">0</span>
</span><span id="__span-1-20"><a id="__codelineno-1-20" name="__codelineno-1-20" href="#__codelineno-1-20"></a>
</span><span id="__span-1-21"><a id="__codelineno-1-21" name="__codelineno-1-21" href="#__codelineno-1-21"></a><span class="c1"># Función para encontrar puerto Arduino automáticamente</span>
</span><span id="__span-1-22"><a id="__codelineno-1-22" name="__codelineno-1-22" href="#__codelineno-1-22"></a>def<span class="w"> </span>encontrar_arduino<span class="o">()</span>:
</span><span id="__span-1-23"><a id="__codelineno-1-23" name="__codelineno-1-23" href="#__codelineno-1-23"></a><span class="w">    </span><span class="nv">puertos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>serial.tools.list_ports.comports<span class="o">()</span>
</span><span id="__span-1-24"><a id="__codelineno-1-24" name="__codelineno-1-24" href="#__codelineno-1-24"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span>puerto<span class="w"> </span><span class="k">in</span><span class="w"> </span>puertos:
</span><span id="__span-1-25"><a id="__codelineno-1-25" name="__codelineno-1-25" href="#__codelineno-1-25"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="s1">&#39;Arduino&#39;</span><span class="w"> </span><span class="k">in</span><span class="w"> </span>puerto.description<span class="w"> </span>or<span class="w"> </span><span class="s1">&#39;CH340&#39;</span><span class="w"> </span><span class="k">in</span><span class="w"> </span>puerto.description<span class="w"> </span>or<span class="w"> </span><span class="s1">&#39;USB-SERIAL&#39;</span><span class="w"> </span><span class="k">in</span><span class="w"> </span>puerto.description:
</span><span id="__span-1-26"><a id="__codelineno-1-26" name="__codelineno-1-26" href="#__codelineno-1-26"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span>puerto.device
</span><span id="__span-1-27"><a id="__codelineno-1-27" name="__codelineno-1-27" href="#__codelineno-1-27"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span>None
</span><span id="__span-1-28"><a id="__codelineno-1-28" name="__codelineno-1-28" href="#__codelineno-1-28"></a>
</span><span id="__span-1-29"><a id="__codelineno-1-29" name="__codelineno-1-29" href="#__codelineno-1-29"></a><span class="c1"># Función slicer interactivo</span>
</span><span id="__span-1-30"><a id="__codelineno-1-30" name="__codelineno-1-30" href="#__codelineno-1-30"></a>def<span class="w"> </span>dibujar_slicer<span class="o">(</span>frame,<span class="w"> </span>y_pos,<span class="w"> </span>valor,<span class="w"> </span>label,<span class="w"> </span>min_val,<span class="w"> </span>max_val,<span class="w"> </span><span class="nv">color</span><span class="o">=(</span><span class="m">0</span>,255,0<span class="o">))</span>:
</span><span id="__span-1-31"><a id="__codelineno-1-31" name="__codelineno-1-31" href="#__codelineno-1-31"></a><span class="w">    </span><span class="nv">ancho</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>frame.shape<span class="o">[</span><span class="m">1</span><span class="o">]</span><span class="w"> </span>-<span class="w"> </span><span class="m">20</span>
</span><span id="__span-1-32"><a id="__codelineno-1-32" name="__codelineno-1-32" href="#__codelineno-1-32"></a><span class="w">    </span><span class="nv">x_inicio</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">10</span>
</span><span id="__span-1-33"><a id="__codelineno-1-33" name="__codelineno-1-33" href="#__codelineno-1-33"></a>
</span><span id="__span-1-34"><a id="__codelineno-1-34" name="__codelineno-1-34" href="#__codelineno-1-34"></a><span class="w">    </span>cv2.rectangle<span class="o">(</span>frame,<span class="w"> </span><span class="o">(</span>x_inicio,<span class="w"> </span>y_pos<span class="o">)</span>,<span class="w"> </span><span class="o">(</span>x_inicio<span class="w"> </span>+<span class="w"> </span>ancho,<span class="w"> </span>y_pos<span class="w"> </span>+<span class="w"> </span>alto_slicer<span class="o">)</span>,<span class="w"> </span><span class="o">(</span><span class="m">50</span>,50,50<span class="o">)</span>,<span class="w"> </span>-1<span class="o">)</span>
</span><span id="__span-1-35"><a id="__codelineno-1-35" name="__codelineno-1-35" href="#__codelineno-1-35"></a>
</span><span id="__span-1-36"><a id="__codelineno-1-36" name="__codelineno-1-36" href="#__codelineno-1-36"></a><span class="w">    </span><span class="nv">proporcion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">(</span>valor<span class="w"> </span>-<span class="w"> </span>min_val<span class="o">)</span><span class="w"> </span>/<span class="w"> </span><span class="o">(</span>max_val<span class="w"> </span>-<span class="w"> </span>min_val<span class="o">)</span>
</span><span id="__span-1-37"><a id="__codelineno-1-37" name="__codelineno-1-37" href="#__codelineno-1-37"></a><span class="w">    </span><span class="nv">ancho_activo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>int<span class="o">(</span>proporcion<span class="w"> </span>*<span class="w"> </span>ancho<span class="o">)</span>
</span><span id="__span-1-38"><a id="__codelineno-1-38" name="__codelineno-1-38" href="#__codelineno-1-38"></a><span class="w">    </span>cv2.rectangle<span class="o">(</span>frame,<span class="w"> </span><span class="o">(</span>x_inicio,<span class="w"> </span>y_pos<span class="o">)</span>,<span class="w"> </span><span class="o">(</span>x_inicio<span class="w"> </span>+<span class="w"> </span>ancho_activo,<span class="w"> </span>y_pos<span class="w"> </span>+<span class="w"> </span>alto_slicer<span class="o">)</span>,<span class="w"> </span>color,<span class="w"> </span>-1<span class="o">)</span>
</span><span id="__span-1-39"><a id="__codelineno-1-39" name="__codelineno-1-39" href="#__codelineno-1-39"></a>
</span><span id="__span-1-40"><a id="__codelineno-1-40" name="__codelineno-1-40" href="#__codelineno-1-40"></a><span class="w">    </span>cv2.putText<span class="o">(</span>frame,<span class="w"> </span>f<span class="s1">&#39;{label}: {int(valor)}&#39;</span>,<span class="w"> </span><span class="o">(</span>x_inicio,<span class="w"> </span>y_pos-5<span class="o">)</span>,<span class="w"> </span>
</span><span id="__span-1-41"><a id="__codelineno-1-41" name="__codelineno-1-41" href="#__codelineno-1-41"></a><span class="w">                </span>cv2.FONT_HERSHEY_SIMPLEX,<span class="w"> </span><span class="m">0</span>.6,<span class="w"> </span><span class="o">(</span><span class="m">255</span>,255,255<span class="o">)</span>,<span class="w"> </span><span class="m">2</span><span class="o">)</span>
</span><span id="__span-1-42"><a id="__codelineno-1-42" name="__codelineno-1-42" href="#__codelineno-1-42"></a>
</span><span id="__span-1-43"><a id="__codelineno-1-43" name="__codelineno-1-43" href="#__codelineno-1-43"></a><span class="w">    </span>cv2.putText<span class="o">(</span>frame,<span class="w"> </span>f<span class="s1">&#39;[{min_val}-{max_val}]&#39;</span>,<span class="w"> </span><span class="o">(</span>x_inicio<span class="w"> </span>+<span class="w"> </span>ancho<span class="w"> </span>+<span class="w"> </span><span class="m">10</span>,<span class="w"> </span>y_pos<span class="w"> </span>+<span class="w"> </span><span class="m">22</span><span class="o">)</span>,<span class="w"> </span>
</span><span id="__span-1-44"><a id="__codelineno-1-44" name="__codelineno-1-44" href="#__codelineno-1-44"></a><span class="w">                </span>cv2.FONT_HERSHEY_SIMPLEX,<span class="w"> </span><span class="m">0</span>.5,<span class="w"> </span><span class="o">(</span><span class="m">150</span>,150,150<span class="o">)</span>,<span class="w"> </span><span class="m">1</span><span class="o">)</span>
</span><span id="__span-1-45"><a id="__codelineno-1-45" name="__codelineno-1-45" href="#__codelineno-1-45"></a>
</span><span id="__span-1-46"><a id="__codelineno-1-46" name="__codelineno-1-46" href="#__codelineno-1-46"></a><span class="c1"># 🔥 FUNCIÓN 6 CUADRANTES POLARES (60° cada uno)</span>
</span><span id="__span-1-47"><a id="__codelineno-1-47" name="__codelineno-1-47" href="#__codelineno-1-47"></a>def<span class="w"> </span>obtener_cuadrante_6<span class="o">(</span>cx,<span class="w"> </span>cy,<span class="w"> </span>centrox,<span class="w"> </span>centroy<span class="o">)</span>:
</span><span id="__span-1-48"><a id="__codelineno-1-48" name="__codelineno-1-48" href="#__codelineno-1-48"></a><span class="w">    </span><span class="s2">&quot;&quot;&quot;</span>
</span><span id="__span-1-49"><a id="__codelineno-1-49" name="__codelineno-1-49" href="#__codelineno-1-49"></a><span class="s2">    Divide en 6 cuadrantes polares cada 60° + CENTRO_SUP/INF</span>
</span><span id="__span-1-50"><a id="__codelineno-1-50" name="__codelineno-1-50" href="#__codelineno-1-50"></a><span class="s2">    Ángulos: 0°(Der), 60°, 120°, 180°(Izq), 240°, 300°</span>
</span><span id="__span-1-51"><a id="__codelineno-1-51" name="__codelineno-1-51" href="#__codelineno-1-51"></a><span class="s2">    &quot;&quot;&quot;</span>
</span><span id="__span-1-52"><a id="__codelineno-1-52" name="__codelineno-1-52" href="#__codelineno-1-52"></a><span class="w">    </span><span class="nv">dx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>cx<span class="w"> </span>-<span class="w"> </span>centrox
</span><span id="__span-1-53"><a id="__codelineno-1-53" name="__codelineno-1-53" href="#__codelineno-1-53"></a><span class="w">    </span><span class="nv">dy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>cy<span class="w"> </span>-<span class="w"> </span>centroy
</span><span id="__span-1-54"><a id="__codelineno-1-54" name="__codelineno-1-54" href="#__codelineno-1-54"></a>
</span><span id="__span-1-55"><a id="__codelineno-1-55" name="__codelineno-1-55" href="#__codelineno-1-55"></a><span class="w">    </span><span class="c1"># Distancia desde centro (para detectar centro)</span>
</span><span id="__span-1-56"><a id="__codelineno-1-56" name="__codelineno-1-56" href="#__codelineno-1-56"></a><span class="w">    </span><span class="nv">distancia</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>math.sqrt<span class="o">(</span>dx**2<span class="w"> </span>+<span class="w"> </span>dy**2<span class="o">)</span>
</span><span id="__span-1-57"><a id="__codelineno-1-57" name="__codelineno-1-57" href="#__codelineno-1-57"></a><span class="w">    </span><span class="nv">radio_centro</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">50</span><span class="w">  </span><span class="c1"># Píxeles para considerar &quot;centro&quot;</span>
</span><span id="__span-1-58"><a id="__codelineno-1-58" name="__codelineno-1-58" href="#__codelineno-1-58"></a>
</span><span id="__span-1-59"><a id="__codelineno-1-59" name="__codelineno-1-59" href="#__codelineno-1-59"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span>distancia<span class="w"> </span>&lt;<span class="w"> </span>radio_centro:
</span><span id="__span-1-60"><a id="__codelineno-1-60" name="__codelineno-1-60" href="#__codelineno-1-60"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span>dy<span class="w"> </span>&lt;<span class="w"> </span><span class="m">0</span>:<span class="w">  </span><span class="c1"># CENTRO_SUPERIOR</span>
</span><span id="__span-1-61"><a id="__codelineno-1-61" name="__codelineno-1-61" href="#__codelineno-1-61"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="s2">&quot;CENTRO_SUP&quot;</span>,<span class="w"> </span><span class="m">0</span>.0,<span class="w"> </span><span class="m">0</span>.0,<span class="w"> </span><span class="o">(</span><span class="m">0</span>,<span class="w"> </span><span class="m">255</span>,<span class="w"> </span><span class="m">255</span><span class="o">)</span>
</span><span id="__span-1-62"><a id="__codelineno-1-62" name="__codelineno-1-62" href="#__codelineno-1-62"></a><span class="w">        </span><span class="k">else</span>:<span class="w">       </span><span class="c1"># CENTRO_INFERIOR</span>
</span><span id="__span-1-63"><a id="__codelineno-1-63" name="__codelineno-1-63" href="#__codelineno-1-63"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="s2">&quot;CENTRO_INF&quot;</span>,<span class="w"> </span><span class="m">0</span>.0,<span class="w"> </span><span class="m">0</span>.0,<span class="w"> </span><span class="o">(</span><span class="m">255</span>,<span class="w"> </span><span class="m">255</span>,<span class="w"> </span><span class="m">0</span><span class="o">)</span>
</span><span id="__span-1-64"><a id="__codelineno-1-64" name="__codelineno-1-64" href="#__codelineno-1-64"></a>
</span><span id="__span-1-65"><a id="__codelineno-1-65" name="__codelineno-1-65" href="#__codelineno-1-65"></a><span class="w">    </span><span class="c1"># Ángulo polar (0°=derecha, sentido antihorario)</span>
</span><span id="__span-1-66"><a id="__codelineno-1-66" name="__codelineno-1-66" href="#__codelineno-1-66"></a><span class="w">    </span><span class="nv">angulo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>math.atan2<span class="o">(</span>dy,<span class="w"> </span>dx<span class="o">)</span><span class="w"> </span>*<span class="w"> </span><span class="m">180</span><span class="w"> </span>/<span class="w"> </span>math.pi
</span><span id="__span-1-67"><a id="__codelineno-1-67" name="__codelineno-1-67" href="#__codelineno-1-67"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span>angulo<span class="w"> </span>&lt;<span class="w"> </span><span class="m">0</span>:
</span><span id="__span-1-68"><a id="__codelineno-1-68" name="__codelineno-1-68" href="#__codelineno-1-68"></a><span class="w">        </span><span class="nv">angulo</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="m">360</span>
</span><span id="__span-1-69"><a id="__codelineno-1-69" name="__codelineno-1-69" href="#__codelineno-1-69"></a>
</span><span id="__span-1-70"><a id="__codelineno-1-70" name="__codelineno-1-70" href="#__codelineno-1-70"></a><span class="w">    </span><span class="c1"># Dividir en 6 sectores de 60°</span>
</span><span id="__span-1-71"><a id="__codelineno-1-71" name="__codelineno-1-71" href="#__codelineno-1-71"></a><span class="w">    </span><span class="nv">sector</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>int<span class="o">(</span>angulo<span class="w"> </span>//<span class="w"> </span><span class="m">60</span><span class="o">)</span>
</span><span id="__span-1-72"><a id="__codelineno-1-72" name="__codelineno-1-72" href="#__codelineno-1-72"></a>
</span><span id="__span-1-73"><a id="__codelineno-1-73" name="__codelineno-1-73" href="#__codelineno-1-73"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nv">sector</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">0</span>:
</span><span id="__span-1-74"><a id="__codelineno-1-74" name="__codelineno-1-74" href="#__codelineno-1-74"></a><span class="w">        </span><span class="nv">cuadrante</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Cuadrante 6&quot;</span>
</span><span id="__span-1-75"><a id="__codelineno-1-75" name="__codelineno-1-75" href="#__codelineno-1-75"></a><span class="w">        </span><span class="nv">color_cuad</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">(</span><span class="m">0</span>,<span class="w"> </span><span class="m">0</span>,<span class="w"> </span><span class="m">255</span><span class="o">)</span><span class="w">  </span><span class="c1"># Rojo</span>
</span><span id="__span-1-76"><a id="__codelineno-1-76" name="__codelineno-1-76" href="#__codelineno-1-76"></a><span class="w">    </span><span class="k">elif</span><span class="w"> </span><span class="nv">sector</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">1</span>:
</span><span id="__span-1-77"><a id="__codelineno-1-77" name="__codelineno-1-77" href="#__codelineno-1-77"></a><span class="w">        </span><span class="nv">cuadrante</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Cuadrante 5&quot;</span>
</span><span id="__span-1-78"><a id="__codelineno-1-78" name="__codelineno-1-78" href="#__codelineno-1-78"></a><span class="w">        </span><span class="nv">color_cuad</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">(</span><span class="m">0</span>,<span class="w"> </span><span class="m">165</span>,<span class="w"> </span><span class="m">255</span><span class="o">)</span><span class="w">  </span><span class="c1"># Naranja</span>
</span><span id="__span-1-79"><a id="__codelineno-1-79" name="__codelineno-1-79" href="#__codelineno-1-79"></a><span class="w">    </span><span class="k">elif</span><span class="w"> </span><span class="nv">sector</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">2</span>:
</span><span id="__span-1-80"><a id="__codelineno-1-80" name="__codelineno-1-80" href="#__codelineno-1-80"></a><span class="w">        </span><span class="nv">cuadrante</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Cuadrante 4&quot;</span>
</span><span id="__span-1-81"><a id="__codelineno-1-81" name="__codelineno-1-81" href="#__codelineno-1-81"></a><span class="w">        </span><span class="nv">color_cuad</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">(</span><span class="m">255</span>,<span class="w"> </span><span class="m">0</span>,<span class="w"> </span><span class="m">255</span><span class="o">)</span><span class="w">  </span><span class="c1"># Magenta</span>
</span><span id="__span-1-82"><a id="__codelineno-1-82" name="__codelineno-1-82" href="#__codelineno-1-82"></a><span class="w">    </span><span class="k">elif</span><span class="w"> </span><span class="nv">sector</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">3</span>:
</span><span id="__span-1-83"><a id="__codelineno-1-83" name="__codelineno-1-83" href="#__codelineno-1-83"></a><span class="w">        </span><span class="nv">cuadrante</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Cuadrante 3&quot;</span>
</span><span id="__span-1-84"><a id="__codelineno-1-84" name="__codelineno-1-84" href="#__codelineno-1-84"></a><span class="w">        </span><span class="nv">color_cuad</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">(</span><span class="m">255</span>,<span class="w"> </span><span class="m">255</span>,<span class="w"> </span><span class="m">0</span><span class="o">)</span><span class="w">  </span><span class="c1"># Cian</span>
</span><span id="__span-1-85"><a id="__codelineno-1-85" name="__codelineno-1-85" href="#__codelineno-1-85"></a><span class="w">    </span><span class="k">elif</span><span class="w"> </span><span class="nv">sector</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">4</span>:
</span><span id="__span-1-86"><a id="__codelineno-1-86" name="__codelineno-1-86" href="#__codelineno-1-86"></a><span class="w">        </span><span class="nv">cuadrante</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Cuadrante 2&quot;</span>
</span><span id="__span-1-87"><a id="__codelineno-1-87" name="__codelineno-1-87" href="#__codelineno-1-87"></a><span class="w">        </span><span class="nv">color_cuad</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">(</span><span class="m">255</span>,<span class="w"> </span><span class="m">0</span>,<span class="w"> </span><span class="m">0</span><span class="o">)</span><span class="w">  </span><span class="c1"># Rosa</span>
</span><span id="__span-1-88"><a id="__codelineno-1-88" name="__codelineno-1-88" href="#__codelineno-1-88"></a><span class="w">    </span><span class="k">else</span>:<span class="w">  </span><span class="c1"># sector == 5</span>
</span><span id="__span-1-89"><a id="__codelineno-1-89" name="__codelineno-1-89" href="#__codelineno-1-89"></a><span class="w">        </span><span class="nv">cuadrante</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Cuadrante 1&quot;</span>
</span><span id="__span-1-90"><a id="__codelineno-1-90" name="__codelineno-1-90" href="#__codelineno-1-90"></a><span class="w">        </span><span class="nv">color_cuad</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">(</span><span class="m">0</span>,<span class="w"> </span><span class="m">255</span>,<span class="w"> </span><span class="m">0</span><span class="o">)</span><span class="w">  </span><span class="c1"># Verde</span>
</span><span id="__span-1-91"><a id="__codelineno-1-91" name="__codelineno-1-91" href="#__codelineno-1-91"></a>
</span><span id="__span-1-92"><a id="__codelineno-1-92" name="__codelineno-1-92" href="#__codelineno-1-92"></a><span class="w">    </span><span class="c1"># Errores normalizados por distancia máxima</span>
</span><span id="__span-1-93"><a id="__codelineno-1-93" name="__codelineno-1-93" href="#__codelineno-1-93"></a><span class="w">    </span><span class="nv">dist_max</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">250</span><span class="w">  </span><span class="c1"># Radio máximo para normalización</span>
</span><span id="__span-1-94"><a id="__codelineno-1-94" name="__codelineno-1-94" href="#__codelineno-1-94"></a><span class="w">    </span><span class="nv">error_magnitud</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>np.clip<span class="o">(</span>distancia<span class="w"> </span>/<span class="w"> </span>dist_max,<span class="w"> </span><span class="m">0</span>,<span class="w"> </span><span class="m">1</span>.0<span class="o">)</span>
</span><span id="__span-1-95"><a id="__codelineno-1-95" name="__codelineno-1-95" href="#__codelineno-1-95"></a>
</span><span id="__span-1-96"><a id="__codelineno-1-96" name="__codelineno-1-96" href="#__codelineno-1-96"></a><span class="w">    </span><span class="c1"># Dirección del error (vector unitario)</span>
</span><span id="__span-1-97"><a id="__codelineno-1-97" name="__codelineno-1-97" href="#__codelineno-1-97"></a><span class="w">    </span><span class="nv">errorX_norm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">(</span>dx<span class="w"> </span>/<span class="w"> </span>distancia<span class="o">)</span><span class="w"> </span>*<span class="w"> </span>error_magnitud<span class="w"> </span><span class="k">if</span><span class="w"> </span>distancia<span class="w"> </span>&gt;<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="m">0</span>
</span><span id="__span-1-98"><a id="__codelineno-1-98" name="__codelineno-1-98" href="#__codelineno-1-98"></a><span class="w">    </span><span class="nv">errorY_norm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">(</span>dy<span class="w"> </span>/<span class="w"> </span>distancia<span class="o">)</span><span class="w"> </span>*<span class="w"> </span>error_magnitud<span class="w"> </span><span class="k">if</span><span class="w"> </span>distancia<span class="w"> </span>&gt;<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="m">0</span>
</span><span id="__span-1-99"><a id="__codelineno-1-99" name="__codelineno-1-99" href="#__codelineno-1-99"></a>
</span><span id="__span-1-100"><a id="__codelineno-1-100" name="__codelineno-1-100" href="#__codelineno-1-100"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span>cuadrante,<span class="w"> </span>errorX_norm,<span class="w"> </span>errorY_norm,<span class="w"> </span>color_cuad
</span><span id="__span-1-101"><a id="__codelineno-1-101" name="__codelineno-1-101" href="#__codelineno-1-101"></a>
</span><span id="__span-1-102"><a id="__codelineno-1-102" name="__codelineno-1-102" href="#__codelineno-1-102"></a><span class="c1"># Mouse callback para ventana SLICER</span>
</span><span id="__span-1-103"><a id="__codelineno-1-103" name="__codelineno-1-103" href="#__codelineno-1-103"></a>def<span class="w"> </span>mouse_callback_slicer<span class="o">(</span>event,<span class="w"> </span>x,<span class="w"> </span>y,<span class="w"> </span>flags,<span class="w"> </span>param<span class="o">)</span>:
</span><span id="__span-1-104"><a id="__codelineno-1-104" name="__codelineno-1-104" href="#__codelineno-1-104"></a><span class="w">    </span>global<span class="w"> </span>min_area,<span class="w"> </span>max_area,<span class="w"> </span>mouse_x,<span class="w"> </span>mouse_y
</span><span id="__span-1-105"><a id="__codelineno-1-105" name="__codelineno-1-105" href="#__codelineno-1-105"></a><span class="w">    </span>mouse_x,<span class="w"> </span><span class="nv">mouse_y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>x,<span class="w"> </span>y
</span><span id="__span-1-106"><a id="__codelineno-1-106" name="__codelineno-1-106" href="#__codelineno-1-106"></a>
</span><span id="__span-1-107"><a id="__codelineno-1-107" name="__codelineno-1-107" href="#__codelineno-1-107"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nv">event</span><span class="w"> </span><span class="o">==</span><span class="w"> </span>cv2.EVENT_MOUSEWHEEL:
</span><span id="__span-1-108"><a id="__codelineno-1-108" name="__codelineno-1-108" href="#__codelineno-1-108"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="m">100</span><span class="w"> </span>&lt;<span class="o">=</span><span class="w"> </span>y<span class="w"> </span>&lt;<span class="o">=</span><span class="w"> </span><span class="m">160</span>:
</span><span id="__span-1-109"><a id="__codelineno-1-109" name="__codelineno-1-109" href="#__codelineno-1-109"></a><span class="w">            </span><span class="nv">delta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">50</span><span class="w"> </span><span class="k">if</span><span class="w"> </span>event<span class="w"> </span>&gt;<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="k">else</span><span class="w"> </span>-50
</span><span id="__span-1-110"><a id="__codelineno-1-110" name="__codelineno-1-110" href="#__codelineno-1-110"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="m">100</span><span class="w"> </span>&lt;<span class="o">=</span><span class="w"> </span>y<span class="w"> </span>&lt;<span class="o">=</span><span class="w"> </span><span class="m">130</span>:
</span><span id="__span-1-111"><a id="__codelineno-1-111" name="__codelineno-1-111" href="#__codelineno-1-111"></a><span class="w">                </span><span class="nv">min_area</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>np.clip<span class="o">(</span>min_area<span class="w"> </span>+<span class="w"> </span>delta,<span class="w"> </span><span class="m">50</span>,<span class="w"> </span><span class="m">5000</span><span class="o">)</span>
</span><span id="__span-1-112"><a id="__codelineno-1-112" name="__codelineno-1-112" href="#__codelineno-1-112"></a><span class="w">            </span><span class="k">else</span>:
</span><span id="__span-1-113"><a id="__codelineno-1-113" name="__codelineno-1-113" href="#__codelineno-1-113"></a><span class="w">                </span><span class="nv">max_area</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>np.clip<span class="o">(</span>max_area<span class="w"> </span>+<span class="w"> </span>delta<span class="w"> </span>*<span class="w"> </span><span class="m">2</span>,<span class="w"> </span><span class="m">500</span>,<span class="w"> </span><span class="m">15000</span><span class="o">)</span>
</span><span id="__span-1-114"><a id="__codelineno-1-114" name="__codelineno-1-114" href="#__codelineno-1-114"></a>
</span><span id="__span-1-115"><a id="__codelineno-1-115" name="__codelineno-1-115" href="#__codelineno-1-115"></a><span class="c1"># Inicializar comunicación serial</span>
</span><span id="__span-1-116"><a id="__codelineno-1-116" name="__codelineno-1-116" href="#__codelineno-1-116"></a>print<span class="o">(</span><span class="s2">&quot;🔍 Buscando Arduino en COM11...&quot;</span><span class="o">)</span>
</span><span id="__span-1-117"><a id="__codelineno-1-117" name="__codelineno-1-117" href="#__codelineno-1-117"></a>try:
</span><span id="__span-1-118"><a id="__codelineno-1-118" name="__codelineno-1-118" href="#__codelineno-1-118"></a><span class="w">    </span><span class="nv">arduino</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>serial.Serial<span class="o">(</span>PUERTO_SERIAL,<span class="w"> </span>BAUDRATE,<span class="w"> </span><span class="nv">timeout</span><span class="o">=</span>TIMEOUT<span class="o">)</span>
</span><span id="__span-1-119"><a id="__codelineno-1-119" name="__codelineno-1-119" href="#__codelineno-1-119"></a><span class="w">    </span>time.sleep<span class="o">(</span><span class="m">2</span><span class="o">)</span>
</span><span id="__span-1-120"><a id="__codelineno-1-120" name="__codelineno-1-120" href="#__codelineno-1-120"></a><span class="w">    </span>print<span class="o">(</span><span class="s2">&quot;✓ Serial conectado en COM11&quot;</span><span class="o">)</span>
</span><span id="__span-1-121"><a id="__codelineno-1-121" name="__codelineno-1-121" href="#__codelineno-1-121"></a>except:
</span><span id="__span-1-122"><a id="__codelineno-1-122" name="__codelineno-1-122" href="#__codelineno-1-122"></a><span class="w">    </span>print<span class="o">(</span><span class="s2">&quot;✗ ERROR: No se pudo conectar en COM11&quot;</span><span class="o">)</span>
</span><span id="__span-1-123"><a id="__codelineno-1-123" name="__codelineno-1-123" href="#__codelineno-1-123"></a><span class="w">    </span>exit<span class="o">()</span>
</span><span id="__span-1-124"><a id="__codelineno-1-124" name="__codelineno-1-124" href="#__codelineno-1-124"></a>
</span><span id="__span-1-125"><a id="__codelineno-1-125" name="__codelineno-1-125" href="#__codelineno-1-125"></a><span class="c1"># Clase PID</span>
</span><span id="__span-1-126"><a id="__codelineno-1-126" name="__codelineno-1-126" href="#__codelineno-1-126"></a>class<span class="w"> </span>PID:
</span><span id="__span-1-127"><a id="__codelineno-1-127" name="__codelineno-1-127" href="#__codelineno-1-127"></a><span class="w">    </span>def<span class="w"> </span>__init__<span class="o">(</span>self,<span class="w"> </span>Kp,<span class="w"> </span>Ki,<span class="w"> </span>Kd,<span class="w"> </span><span class="nv">setpoint</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">dt</span><span class="o">=</span><span class="m">0</span>.03<span class="o">)</span>:
</span><span id="__span-1-128"><a id="__codelineno-1-128" name="__codelineno-1-128" href="#__codelineno-1-128"></a><span class="w">        </span>self.Kp<span class="w"> </span><span class="o">=</span><span class="w"> </span>Kp
</span><span id="__span-1-129"><a id="__codelineno-1-129" name="__codelineno-1-129" href="#__codelineno-1-129"></a><span class="w">        </span>self.Ki<span class="w"> </span><span class="o">=</span><span class="w"> </span>Ki
</span><span id="__span-1-130"><a id="__codelineno-1-130" name="__codelineno-1-130" href="#__codelineno-1-130"></a><span class="w">        </span>self.Kd<span class="w"> </span><span class="o">=</span><span class="w"> </span>Kd
</span><span id="__span-1-131"><a id="__codelineno-1-131" name="__codelineno-1-131" href="#__codelineno-1-131"></a><span class="w">        </span>self.setpoint<span class="w"> </span><span class="o">=</span><span class="w"> </span>setpoint
</span><span id="__span-1-132"><a id="__codelineno-1-132" name="__codelineno-1-132" href="#__codelineno-1-132"></a><span class="w">        </span>self.dt<span class="w"> </span><span class="o">=</span><span class="w"> </span>dt
</span><span id="__span-1-133"><a id="__codelineno-1-133" name="__codelineno-1-133" href="#__codelineno-1-133"></a><span class="w">        </span>self.prev_error<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span>
</span><span id="__span-1-134"><a id="__codelineno-1-134" name="__codelineno-1-134" href="#__codelineno-1-134"></a><span class="w">        </span>self.integral<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span>
</span><span id="__span-1-135"><a id="__codelineno-1-135" name="__codelineno-1-135" href="#__codelineno-1-135"></a><span class="w">        </span>self.output<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span>
</span><span id="__span-1-136"><a id="__codelineno-1-136" name="__codelineno-1-136" href="#__codelineno-1-136"></a>
</span><span id="__span-1-137"><a id="__codelineno-1-137" name="__codelineno-1-137" href="#__codelineno-1-137"></a><span class="w">    </span>def<span class="w"> </span>update<span class="o">(</span>self,<span class="w"> </span>measurement<span class="o">)</span>:
</span><span id="__span-1-138"><a id="__codelineno-1-138" name="__codelineno-1-138" href="#__codelineno-1-138"></a><span class="w">        </span><span class="nv">error</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>self.setpoint<span class="w"> </span>-<span class="w"> </span>measurement
</span><span id="__span-1-139"><a id="__codelineno-1-139" name="__codelineno-1-139" href="#__codelineno-1-139"></a><span class="w">        </span>self.integral<span class="w"> </span>+<span class="o">=</span><span class="w"> </span>error<span class="w"> </span>*<span class="w"> </span>self.dt
</span><span id="__span-1-140"><a id="__codelineno-1-140" name="__codelineno-1-140" href="#__codelineno-1-140"></a><span class="w">        </span>self.integral<span class="w"> </span><span class="o">=</span><span class="w"> </span>np.clip<span class="o">(</span>self.integral,<span class="w"> </span>-50,<span class="w"> </span><span class="m">50</span><span class="o">)</span>
</span><span id="__span-1-141"><a id="__codelineno-1-141" name="__codelineno-1-141" href="#__codelineno-1-141"></a><span class="w">        </span><span class="nv">derivative</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">(</span>error<span class="w"> </span>-<span class="w"> </span>self.prev_error<span class="o">)</span><span class="w"> </span>/<span class="w"> </span>self.dt
</span><span id="__span-1-142"><a id="__codelineno-1-142" name="__codelineno-1-142" href="#__codelineno-1-142"></a><span class="w">        </span>self.output<span class="w"> </span><span class="o">=</span><span class="w"> </span>self.Kp<span class="w"> </span>*<span class="w"> </span>error<span class="w"> </span>+<span class="w"> </span>self.Ki<span class="w"> </span>*<span class="w"> </span>self.integral<span class="w"> </span>+<span class="w"> </span>self.Kd<span class="w"> </span>*<span class="w"> </span>derivative
</span><span id="__span-1-143"><a id="__codelineno-1-143" name="__codelineno-1-143" href="#__codelineno-1-143"></a><span class="w">        </span>self.output<span class="w"> </span><span class="o">=</span><span class="w"> </span>np.clip<span class="o">(</span>self.output,<span class="w"> </span>-90,<span class="w"> </span><span class="m">90</span><span class="o">)</span>
</span><span id="__span-1-144"><a id="__codelineno-1-144" name="__codelineno-1-144" href="#__codelineno-1-144"></a><span class="w">        </span>self.prev_error<span class="w"> </span><span class="o">=</span><span class="w"> </span>error
</span><span id="__span-1-145"><a id="__codelineno-1-145" name="__codelineno-1-145" href="#__codelineno-1-145"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span>self.output
</span><span id="__span-1-146"><a id="__codelineno-1-146" name="__codelineno-1-146" href="#__codelineno-1-146"></a>
</span><span id="__span-1-147"><a id="__codelineno-1-147" name="__codelineno-1-147" href="#__codelineno-1-147"></a><span class="c1"># Inicializar PIDs</span>
</span><span id="__span-1-148"><a id="__codelineno-1-148" name="__codelineno-1-148" href="#__codelineno-1-148"></a><span class="nv">pid_x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>PID<span class="o">(</span><span class="nv">Kp</span><span class="o">=</span><span class="m">0</span>.8,<span class="w"> </span><span class="nv">Ki</span><span class="o">=</span><span class="m">0</span>.05,<span class="w"> </span><span class="nv">Kd</span><span class="o">=</span><span class="m">0</span>.15<span class="o">)</span>
</span><span id="__span-1-149"><a id="__codelineno-1-149" name="__codelineno-1-149" href="#__codelineno-1-149"></a><span class="nv">pid_y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>PID<span class="o">(</span><span class="nv">Kp</span><span class="o">=</span><span class="m">0</span>.8,<span class="w"> </span><span class="nv">Ki</span><span class="o">=</span><span class="m">0</span>.05,<span class="w"> </span><span class="nv">Kd</span><span class="o">=</span><span class="m">0</span>.15<span class="o">)</span>
</span><span id="__span-1-150"><a id="__codelineno-1-150" name="__codelineno-1-150" href="#__codelineno-1-150"></a><span class="nv">pid_area</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>PID<span class="o">(</span><span class="nv">Kp</span><span class="o">=</span><span class="m">0</span>.3,<span class="w"> </span><span class="nv">Ki</span><span class="o">=</span><span class="m">0</span>.02,<span class="w"> </span><span class="nv">Kd</span><span class="o">=</span><span class="m">0</span>.08,<span class="w"> </span><span class="nv">setpoint</span><span class="o">=</span><span class="m">2000</span><span class="o">)</span>
</span><span id="__span-1-151"><a id="__codelineno-1-151" name="__codelineno-1-151" href="#__codelineno-1-151"></a>
</span><span id="__span-1-152"><a id="__codelineno-1-152" name="__codelineno-1-152" href="#__codelineno-1-152"></a><span class="nv">cap</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>cv2.VideoCapture<span class="o">(</span><span class="m">0</span><span class="o">)</span>
</span><span id="__span-1-153"><a id="__codelineno-1-153" name="__codelineno-1-153" href="#__codelineno-1-153"></a>cap.set<span class="o">(</span>cv2.CAP_PROP_FRAME_WIDTH,<span class="w"> </span><span class="m">640</span><span class="o">)</span>
</span><span id="__span-1-154"><a id="__codelineno-1-154" name="__codelineno-1-154" href="#__codelineno-1-154"></a>cap.set<span class="o">(</span>cv2.CAP_PROP_FRAME_HEIGHT,<span class="w"> </span><span class="m">480</span><span class="o">)</span>
</span><span id="__span-1-155"><a id="__codelineno-1-155" name="__codelineno-1-155" href="#__codelineno-1-155"></a><span class="nv">alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span>.6
</span><span id="__span-1-156"><a id="__codelineno-1-156" name="__codelineno-1-156" href="#__codelineno-1-156"></a>prev_errorX,<span class="w"> </span><span class="nv">prev_errorY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span>,<span class="w"> </span><span class="m">0</span>
</span><span id="__span-1-157"><a id="__codelineno-1-157" name="__codelineno-1-157" href="#__codelineno-1-157"></a>
</span><span id="__span-1-158"><a id="__codelineno-1-158" name="__codelineno-1-158" href="#__codelineno-1-158"></a>print<span class="o">(</span><span class="s2">&quot;\n🎯 BALANZA PID 3D - 6 CUADRANTES POLARES&quot;</span><span class="o">)</span>
</span><span id="__span-1-159"><a id="__codelineno-1-159" name="__codelineno-1-159" href="#__codelineno-1-159"></a>print<span class="o">(</span><span class="s2">&quot;VENTANA 1: &#39;Camera&#39; → 6 sectores 60° + CENTRO_SUP/INF&quot;</span><span class="o">)</span>
</span><span id="__span-1-160"><a id="__codelineno-1-160" name="__codelineno-1-160" href="#__codelineno-1-160"></a>print<span class="o">(</span><span class="s2">&quot;VENTANA 2: &#39;SLICER&#39; → ↑↓Rueda | A/Z:Min | S/X:Max&quot;</span><span class="o">)</span>
</span><span id="__span-1-161"><a id="__codelineno-1-161" name="__codelineno-1-161" href="#__codelineno-1-161"></a>
</span><span id="__span-1-162"><a id="__codelineno-1-162" name="__codelineno-1-162" href="#__codelineno-1-162"></a><span class="c1"># 2 VENTANAS</span>
</span><span id="__span-1-163"><a id="__codelineno-1-163" name="__codelineno-1-163" href="#__codelineno-1-163"></a><span class="nv">ventana_camera</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Camera - 6 CUADRANTES POLARES&#39;</span>
</span><span id="__span-1-164"><a id="__codelineno-1-164" name="__codelineno-1-164" href="#__codelineno-1-164"></a><span class="nv">ventana_slicer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;SLICER CONTROL&#39;</span>
</span><span id="__span-1-165"><a id="__codelineno-1-165" name="__codelineno-1-165" href="#__codelineno-1-165"></a>
</span><span id="__span-1-166"><a id="__codelineno-1-166" name="__codelineno-1-166" href="#__codelineno-1-166"></a>cv2.namedWindow<span class="o">(</span>ventana_camera<span class="o">)</span>
</span><span id="__span-1-167"><a id="__codelineno-1-167" name="__codelineno-1-167" href="#__codelineno-1-167"></a>cv2.namedWindow<span class="o">(</span>ventana_slicer<span class="o">)</span>
</span><span id="__span-1-168"><a id="__codelineno-1-168" name="__codelineno-1-168" href="#__codelineno-1-168"></a>cv2.setMouseCallback<span class="o">(</span>ventana_slicer,<span class="w"> </span>mouse_callback_slicer<span class="o">)</span>
</span><span id="__span-1-169"><a id="__codelineno-1-169" name="__codelineno-1-169" href="#__codelineno-1-169"></a>
</span><span id="__span-1-170"><a id="__codelineno-1-170" name="__codelineno-1-170" href="#__codelineno-1-170"></a><span class="nv">frame_slicer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>np.zeros<span class="o">((</span><span class="m">200</span>,<span class="w"> </span><span class="m">320</span>,<span class="w"> </span><span class="m">3</span><span class="o">)</span>,<span class="w"> </span><span class="nv">dtype</span><span class="o">=</span>np.uint8<span class="o">)</span>
</span><span id="__span-1-171"><a id="__codelineno-1-171" name="__codelineno-1-171" href="#__codelineno-1-171"></a>frame_slicer.fill<span class="o">(</span><span class="m">20</span><span class="o">)</span>
</span><span id="__span-1-172"><a id="__codelineno-1-172" name="__codelineno-1-172" href="#__codelineno-1-172"></a>
</span><span id="__span-1-173"><a id="__codelineno-1-173" name="__codelineno-1-173" href="#__codelineno-1-173"></a><span class="k">while</span><span class="w"> </span>True:
</span><span id="__span-1-174"><a id="__codelineno-1-174" name="__codelineno-1-174" href="#__codelineno-1-174"></a><span class="w">    </span>ret,<span class="w"> </span><span class="nv">frame</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>cap.read<span class="o">()</span>
</span><span id="__span-1-175"><a id="__codelineno-1-175" name="__codelineno-1-175" href="#__codelineno-1-175"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span>not<span class="w"> </span>ret:
</span><span id="__span-1-176"><a id="__codelineno-1-176" name="__codelineno-1-176" href="#__codelineno-1-176"></a><span class="w">        </span><span class="k">break</span>
</span><span id="__span-1-177"><a id="__codelineno-1-177" name="__codelineno-1-177" href="#__codelineno-1-177"></a>
</span><span id="__span-1-178"><a id="__codelineno-1-178" name="__codelineno-1-178" href="#__codelineno-1-178"></a><span class="w">    </span><span class="nv">frame</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>cv2.flip<span class="o">(</span>frame,<span class="w"> </span><span class="m">1</span><span class="o">)</span>
</span><span id="__span-1-179"><a id="__codelineno-1-179" name="__codelineno-1-179" href="#__codelineno-1-179"></a><span class="w">    </span><span class="nv">centrox</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>frame.shape<span class="o">[</span><span class="m">1</span><span class="o">]</span><span class="w"> </span>//<span class="w"> </span><span class="m">2</span>
</span><span id="__span-1-180"><a id="__codelineno-1-180" name="__codelineno-1-180" href="#__codelineno-1-180"></a><span class="w">    </span><span class="nv">centroy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>frame.shape<span class="o">[</span><span class="m">0</span><span class="o">]</span><span class="w"> </span>//<span class="w"> </span><span class="m">2</span>
</span><span id="__span-1-181"><a id="__codelineno-1-181" name="__codelineno-1-181" href="#__codelineno-1-181"></a>
</span><span id="__span-1-182"><a id="__codelineno-1-182" name="__codelineno-1-182" href="#__codelineno-1-182"></a><span class="w">    </span><span class="c1"># Detección roja</span>
</span><span id="__span-1-183"><a id="__codelineno-1-183" name="__codelineno-1-183" href="#__codelineno-1-183"></a><span class="w">    </span><span class="nv">redbajo1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>np.array<span class="o">([</span><span class="m">0</span>,<span class="w"> </span><span class="m">150</span>,<span class="w"> </span><span class="m">50</span><span class="o">]</span>,<span class="w"> </span>np.uint8<span class="o">)</span>
</span><span id="__span-1-184"><a id="__codelineno-1-184" name="__codelineno-1-184" href="#__codelineno-1-184"></a><span class="w">    </span><span class="nv">redalto1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>np.array<span class="o">([</span><span class="m">8</span>,<span class="w"> </span><span class="m">255</span>,<span class="w"> </span><span class="m">255</span><span class="o">]</span>,<span class="w"> </span>np.uint8<span class="o">)</span>
</span><span id="__span-1-185"><a id="__codelineno-1-185" name="__codelineno-1-185" href="#__codelineno-1-185"></a><span class="w">    </span><span class="nv">redbajo2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>np.array<span class="o">([</span><span class="m">170</span>,<span class="w"> </span><span class="m">150</span>,<span class="w"> </span><span class="m">50</span><span class="o">]</span>,<span class="w"> </span>np.uint8<span class="o">)</span>
</span><span id="__span-1-186"><a id="__codelineno-1-186" name="__codelineno-1-186" href="#__codelineno-1-186"></a><span class="w">    </span><span class="nv">redalto2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>np.array<span class="o">([</span><span class="m">179</span>,<span class="w"> </span><span class="m">255</span>,<span class="w"> </span><span class="m">255</span><span class="o">]</span>,<span class="w"> </span>np.uint8<span class="o">)</span>
</span><span id="__span-1-187"><a id="__codelineno-1-187" name="__codelineno-1-187" href="#__codelineno-1-187"></a>
</span><span id="__span-1-188"><a id="__codelineno-1-188" name="__codelineno-1-188" href="#__codelineno-1-188"></a><span class="w">    </span><span class="nv">hsv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>cv2.cvtColor<span class="o">(</span>frame,<span class="w"> </span>cv2.COLOR_BGR2HSV<span class="o">)</span>
</span><span id="__span-1-189"><a id="__codelineno-1-189" name="__codelineno-1-189" href="#__codelineno-1-189"></a><span class="w">    </span><span class="nv">mask1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>cv2.inRange<span class="o">(</span>hsv,<span class="w"> </span>redbajo1,<span class="w"> </span>redalto1<span class="o">)</span>
</span><span id="__span-1-190"><a id="__codelineno-1-190" name="__codelineno-1-190" href="#__codelineno-1-190"></a><span class="w">    </span><span class="nv">mask2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>cv2.inRange<span class="o">(</span>hsv,<span class="w"> </span>redbajo2,<span class="w"> </span>redalto2<span class="o">)</span>
</span><span id="__span-1-191"><a id="__codelineno-1-191" name="__codelineno-1-191" href="#__codelineno-1-191"></a><span class="w">    </span><span class="nv">mask</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>cv2.add<span class="o">(</span>mask1,<span class="w"> </span>mask2<span class="o">)</span>
</span><span id="__span-1-192"><a id="__codelineno-1-192" name="__codelineno-1-192" href="#__codelineno-1-192"></a>
</span><span id="__span-1-193"><a id="__codelineno-1-193" name="__codelineno-1-193" href="#__codelineno-1-193"></a><span class="w">    </span><span class="nv">kernel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>cv2.getStructuringElement<span class="o">(</span>cv2.MORPH_ELLIPSE,<span class="w"> </span><span class="o">(</span><span class="m">5</span>,5<span class="o">))</span>
</span><span id="__span-1-194"><a id="__codelineno-1-194" name="__codelineno-1-194" href="#__codelineno-1-194"></a><span class="w">    </span><span class="nv">mask</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>cv2.morphologyEx<span class="o">(</span>mask,<span class="w"> </span>cv2.MORPH_OPEN,<span class="w"> </span>kernel<span class="o">)</span>
</span><span id="__span-1-195"><a id="__codelineno-1-195" name="__codelineno-1-195" href="#__codelineno-1-195"></a><span class="w">    </span><span class="nv">mask</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>cv2.morphologyEx<span class="o">(</span>mask,<span class="w"> </span>cv2.MORPH_CLOSE,<span class="w"> </span>kernel<span class="o">)</span>
</span><span id="__span-1-196"><a id="__codelineno-1-196" name="__codelineno-1-196" href="#__codelineno-1-196"></a>
</span><span id="__span-1-197"><a id="__codelineno-1-197" name="__codelineno-1-197" href="#__codelineno-1-197"></a><span class="w">    </span>contornos,<span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>cv2.findContours<span class="o">(</span>mask,<span class="w"> </span>cv2.RETR_EXTERNAL,<span class="w"> </span>cv2.CHAIN_APPROX_SIMPLE<span class="o">)</span>
</span><span id="__span-1-198"><a id="__codelineno-1-198" name="__codelineno-1-198" href="#__codelineno-1-198"></a>
</span><span id="__span-1-199"><a id="__codelineno-1-199" name="__codelineno-1-199" href="#__codelineno-1-199"></a><span class="w">    </span><span class="nv">mejor_contorno</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>None
</span><span id="__span-1-200"><a id="__codelineno-1-200" name="__codelineno-1-200" href="#__codelineno-1-200"></a><span class="w">    </span>mejor_cx,<span class="w"> </span>mejor_cy,<span class="w"> </span><span class="nv">mejor_area</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>None,<span class="w"> </span>None,<span class="w"> </span><span class="m">0</span>
</span><span id="__span-1-201"><a id="__codelineno-1-201" name="__codelineno-1-201" href="#__codelineno-1-201"></a><span class="w">    </span><span class="nv">cuadrante_actual</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;CENTRO&quot;</span>
</span><span id="__span-1-202"><a id="__codelineno-1-202" name="__codelineno-1-202" href="#__codelineno-1-202"></a><span class="w">    </span>errorX_norm,<span class="w"> </span><span class="nv">errorY_norm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span>,<span class="w"> </span><span class="m">0</span>
</span><span id="__span-1-203"><a id="__codelineno-1-203" name="__codelineno-1-203" href="#__codelineno-1-203"></a>
</span><span id="__span-1-204"><a id="__codelineno-1-204" name="__codelineno-1-204" href="#__codelineno-1-204"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span>c<span class="w"> </span><span class="k">in</span><span class="w"> </span>contornos:
</span><span id="__span-1-205"><a id="__codelineno-1-205" name="__codelineno-1-205" href="#__codelineno-1-205"></a><span class="w">        </span><span class="nv">area</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>cv2.contourArea<span class="o">(</span>c<span class="o">)</span>
</span><span id="__span-1-206"><a id="__codelineno-1-206" name="__codelineno-1-206" href="#__codelineno-1-206"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span>min_area<span class="w"> </span>&lt;<span class="w"> </span>area<span class="w"> </span>&lt;<span class="w"> </span>max_area:
</span><span id="__span-1-207"><a id="__codelineno-1-207" name="__codelineno-1-207" href="#__codelineno-1-207"></a><span class="w">            </span><span class="nv">M</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>cv2.moments<span class="o">(</span>c<span class="o">)</span>
</span><span id="__span-1-208"><a id="__codelineno-1-208" name="__codelineno-1-208" href="#__codelineno-1-208"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span>M<span class="o">[</span><span class="s2">&quot;m00&quot;</span><span class="o">]</span><span class="w"> </span>!<span class="o">=</span><span class="w"> </span><span class="m">0</span>:
</span><span id="__span-1-209"><a id="__codelineno-1-209" name="__codelineno-1-209" href="#__codelineno-1-209"></a><span class="w">                </span><span class="nv">cx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>int<span class="o">(</span>M<span class="o">[</span><span class="s2">&quot;m10&quot;</span><span class="o">]</span><span class="w"> </span>/<span class="w"> </span>M<span class="o">[</span><span class="s2">&quot;m00&quot;</span><span class="o">])</span>
</span><span id="__span-1-210"><a id="__codelineno-1-210" name="__codelineno-1-210" href="#__codelineno-1-210"></a><span class="w">                </span><span class="nv">cy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>int<span class="o">(</span>M<span class="o">[</span><span class="s2">&quot;m01&quot;</span><span class="o">]</span><span class="w"> </span>/<span class="w"> </span>M<span class="o">[</span><span class="s2">&quot;m00&quot;</span><span class="o">])</span>
</span><span id="__span-1-211"><a id="__codelineno-1-211" name="__codelineno-1-211" href="#__codelineno-1-211"></a><span class="w">                </span><span class="k">if</span><span class="w"> </span>mejor_contorno<span class="w"> </span>is<span class="w"> </span>None<span class="w"> </span>or<span class="w"> </span>area<span class="w"> </span>&gt;<span class="w"> </span>mejor_area:
</span><span id="__span-1-212"><a id="__codelineno-1-212" name="__codelineno-1-212" href="#__codelineno-1-212"></a><span class="w">                    </span><span class="nv">mejor_contorno</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>c
</span><span id="__span-1-213"><a id="__codelineno-1-213" name="__codelineno-1-213" href="#__codelineno-1-213"></a><span class="w">                    </span>mejor_cx,<span class="w"> </span><span class="nv">mejor_cy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>cx,<span class="w"> </span>cy
</span><span id="__span-1-214"><a id="__codelineno-1-214" name="__codelineno-1-214" href="#__codelineno-1-214"></a><span class="w">                    </span><span class="nv">mejor_area</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>area
</span><span id="__span-1-215"><a id="__codelineno-1-215" name="__codelineno-1-215" href="#__codelineno-1-215"></a>
</span><span id="__span-1-216"><a id="__codelineno-1-216" name="__codelineno-1-216" href="#__codelineno-1-216"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span>mejor_contorno<span class="w"> </span>is<span class="w"> </span>not<span class="w"> </span>None:
</span><span id="__span-1-217"><a id="__codelineno-1-217" name="__codelineno-1-217" href="#__codelineno-1-217"></a><span class="w">        </span>cuadrante_actual,<span class="w"> </span>errorX_norm,<span class="w"> </span>errorY_norm,<span class="w"> </span><span class="nv">color_cuad</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>obtener_cuadrante_6<span class="o">(</span>
</span><span id="__span-1-218"><a id="__codelineno-1-218" name="__codelineno-1-218" href="#__codelineno-1-218"></a><span class="w">            </span>mejor_cx,<span class="w"> </span>mejor_cy,<span class="w"> </span>centrox,<span class="w"> </span>centroy
</span><span id="__span-1-219"><a id="__codelineno-1-219" name="__codelineno-1-219" href="#__codelineno-1-219"></a><span class="w">        </span><span class="o">)</span>
</span><span id="__span-1-220"><a id="__codelineno-1-220" name="__codelineno-1-220" href="#__codelineno-1-220"></a>
</span><span id="__span-1-221"><a id="__codelineno-1-221" name="__codelineno-1-221" href="#__codelineno-1-221"></a><span class="w">        </span><span class="nv">errorX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>alpha<span class="w"> </span>*<span class="w"> </span>errorX_norm<span class="w"> </span>+<span class="w"> </span><span class="o">(</span><span class="m">1</span>-alpha<span class="o">)</span><span class="w"> </span>*<span class="w"> </span>prev_errorX
</span><span id="__span-1-222"><a id="__codelineno-1-222" name="__codelineno-1-222" href="#__codelineno-1-222"></a><span class="w">        </span><span class="nv">errorY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>alpha<span class="w"> </span>*<span class="w"> </span>errorY_norm<span class="w"> </span>+<span class="w"> </span><span class="o">(</span><span class="m">1</span>-alpha<span class="o">)</span><span class="w"> </span>*<span class="w"> </span>prev_errorY
</span><span id="__span-1-223"><a id="__codelineno-1-223" name="__codelineno-1-223" href="#__codelineno-1-223"></a><span class="w">        </span>prev_errorX,<span class="w"> </span><span class="nv">prev_errorY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>errorX,<span class="w"> </span>errorY
</span><span id="__span-1-224"><a id="__codelineno-1-224" name="__codelineno-1-224" href="#__codelineno-1-224"></a><span class="w">    </span><span class="k">else</span>:
</span><span id="__span-1-225"><a id="__codelineno-1-225" name="__codelineno-1-225" href="#__codelineno-1-225"></a><span class="w">        </span>errorX,<span class="w"> </span><span class="nv">errorY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span>,<span class="w"> </span><span class="m">0</span>
</span><span id="__span-1-226"><a id="__codelineno-1-226" name="__codelineno-1-226" href="#__codelineno-1-226"></a><span class="w">        </span>arduino.write<span class="o">(</span>b<span class="s2">&quot;X:0,Y:0,Z:0\n&quot;</span><span class="o">)</span>
</span><span id="__span-1-227"><a id="__codelineno-1-227" name="__codelineno-1-227" href="#__codelineno-1-227"></a>
</span><span id="__span-1-228"><a id="__codelineno-1-228" name="__codelineno-1-228" href="#__codelineno-1-228"></a><span class="w">    </span><span class="nv">outputX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>pid_x.update<span class="o">(</span>errorX<span class="w"> </span>*<span class="w"> </span><span class="m">100</span><span class="o">)</span>
</span><span id="__span-1-229"><a id="__codelineno-1-229" name="__codelineno-1-229" href="#__codelineno-1-229"></a><span class="w">    </span><span class="nv">outputY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>pid_y.update<span class="o">(</span>errorY<span class="w"> </span>*<span class="w"> </span><span class="m">100</span><span class="o">)</span>
</span><span id="__span-1-230"><a id="__codelineno-1-230" name="__codelineno-1-230" href="#__codelineno-1-230"></a><span class="w">    </span><span class="nv">outputArea</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>pid_area.update<span class="o">(</span>mejor_area<span class="o">)</span>
</span><span id="__span-1-231"><a id="__codelineno-1-231" name="__codelineno-1-231" href="#__codelineno-1-231"></a>
</span><span id="__span-1-232"><a id="__codelineno-1-232" name="__codelineno-1-232" href="#__codelineno-1-232"></a><span class="w">    </span><span class="nv">comando</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>f<span class="s2">&quot;X:{int(outputX)},Y:{int(outputY)},Z:{int(outputArea)}\n&quot;</span>
</span><span id="__span-1-233"><a id="__codelineno-1-233" name="__codelineno-1-233" href="#__codelineno-1-233"></a><span class="w">    </span>arduino.write<span class="o">(</span>comando.encode<span class="o">())</span>
</span><span id="__span-1-234"><a id="__codelineno-1-234" name="__codelineno-1-234" href="#__codelineno-1-234"></a>
</span><span id="__span-1-235"><a id="__codelineno-1-235" name="__codelineno-1-235" href="#__codelineno-1-235"></a><span class="w">    </span><span class="c1"># 🔥 VENTANA 1: CÁMARA + 6 LÍNEAS POLARES</span>
</span><span id="__span-1-236"><a id="__codelineno-1-236" name="__codelineno-1-236" href="#__codelineno-1-236"></a><span class="w">    </span><span class="nv">font</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>cv2.FONT_HERSHEY_SIMPLEX
</span><span id="__span-1-237"><a id="__codelineno-1-237" name="__codelineno-1-237" href="#__codelineno-1-237"></a>
</span><span id="__span-1-238"><a id="__codelineno-1-238" name="__codelineno-1-238" href="#__codelineno-1-238"></a><span class="w">    </span><span class="c1"># Círculo centro + área sensible</span>
</span><span id="__span-1-239"><a id="__codelineno-1-239" name="__codelineno-1-239" href="#__codelineno-1-239"></a><span class="w">    </span>cv2.circle<span class="o">(</span>frame,<span class="w"> </span><span class="o">(</span>centrox,<span class="w"> </span>centroy<span class="o">)</span>,<span class="w"> </span><span class="m">10</span>,<span class="w"> </span><span class="o">(</span><span class="m">0</span>,<span class="w"> </span><span class="m">255</span>,<span class="w"> </span><span class="m">0</span><span class="o">)</span>,<span class="w"> </span>-1<span class="o">)</span>
</span><span id="__span-1-240"><a id="__codelineno-1-240" name="__codelineno-1-240" href="#__codelineno-1-240"></a><span class="w">    </span>cv2.circle<span class="o">(</span>frame,<span class="w"> </span><span class="o">(</span>centrox,<span class="w"> </span>centroy<span class="o">)</span>,<span class="w"> </span><span class="m">50</span>,<span class="w"> </span><span class="o">(</span><span class="m">0</span>,<span class="w"> </span><span class="m">255</span>,<span class="w"> </span><span class="m">0</span><span class="o">)</span>,<span class="w"> </span><span class="m">1</span><span class="o">)</span><span class="w">  </span><span class="c1"># Radio CENTRO</span>
</span><span id="__span-1-241"><a id="__codelineno-1-241" name="__codelineno-1-241" href="#__codelineno-1-241"></a>
</span><span id="__span-1-242"><a id="__codelineno-1-242" name="__codelineno-1-242" href="#__codelineno-1-242"></a><span class="w">    </span><span class="c1"># 🔥 6 LÍNEAS RADIALES CADA 60° (150px largo)</span>
</span><span id="__span-1-243"><a id="__codelineno-1-243" name="__codelineno-1-243" href="#__codelineno-1-243"></a><span class="w">    </span><span class="nv">radio_lineas</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">150</span>
</span><span id="__span-1-244"><a id="__codelineno-1-244" name="__codelineno-1-244" href="#__codelineno-1-244"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span>angulo<span class="w"> </span><span class="k">in</span><span class="w"> </span>range<span class="o">(</span><span class="m">0</span>,<span class="w"> </span><span class="m">360</span>,<span class="w"> </span><span class="m">60</span><span class="o">)</span>:
</span><span id="__span-1-245"><a id="__codelineno-1-245" name="__codelineno-1-245" href="#__codelineno-1-245"></a><span class="w">        </span><span class="nv">rad</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>math.radians<span class="o">(</span>angulo<span class="o">)</span>
</span><span id="__span-1-246"><a id="__codelineno-1-246" name="__codelineno-1-246" href="#__codelineno-1-246"></a><span class="w">        </span><span class="nv">x_fin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>int<span class="o">(</span>centrox<span class="w"> </span>+<span class="w"> </span>radio_lineas<span class="w"> </span>*<span class="w"> </span>math.cos<span class="o">(</span>rad<span class="o">))</span>
</span><span id="__span-1-247"><a id="__codelineno-1-247" name="__codelineno-1-247" href="#__codelineno-1-247"></a><span class="w">        </span><span class="nv">y_fin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>int<span class="o">(</span>centroy<span class="w"> </span>+<span class="w"> </span>radio_lineas<span class="w"> </span>*<span class="w"> </span>math.sin<span class="o">(</span>rad<span class="o">))</span>
</span><span id="__span-1-248"><a id="__codelineno-1-248" name="__codelineno-1-248" href="#__codelineno-1-248"></a><span class="w">        </span>cv2.line<span class="o">(</span>frame,<span class="w"> </span><span class="o">(</span>centrox,<span class="w"> </span>centroy<span class="o">)</span>,<span class="w"> </span><span class="o">(</span>x_fin,<span class="w"> </span>y_fin<span class="o">)</span>,<span class="w"> </span><span class="o">(</span><span class="m">0</span>,<span class="w"> </span><span class="m">255</span>,<span class="w"> </span><span class="m">0</span><span class="o">)</span>,<span class="w"> </span><span class="m">2</span><span class="o">)</span>
</span><span id="__span-1-249"><a id="__codelineno-1-249" name="__codelineno-1-249" href="#__codelineno-1-249"></a>
</span><span id="__span-1-250"><a id="__codelineno-1-250" name="__codelineno-1-250" href="#__codelineno-1-250"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span>mejor_contorno<span class="w"> </span>is<span class="w"> </span>not<span class="w"> </span>None:
</span><span id="__span-1-251"><a id="__codelineno-1-251" name="__codelineno-1-251" href="#__codelineno-1-251"></a><span class="w">        </span>cv2.circle<span class="o">(</span>frame,<span class="w"> </span><span class="o">(</span>int<span class="o">(</span>mejor_cx<span class="o">)</span>,<span class="w"> </span>int<span class="o">(</span>mejor_cy<span class="o">))</span>,<span class="w"> </span><span class="m">8</span>,<span class="w"> </span>color_cuad,<span class="w"> </span>-1<span class="o">)</span>
</span><span id="__span-1-252"><a id="__codelineno-1-252" name="__codelineno-1-252" href="#__codelineno-1-252"></a><span class="w">        </span><span class="nv">hull</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>cv2.convexHull<span class="o">(</span>mejor_contorno<span class="o">)</span>
</span><span id="__span-1-253"><a id="__codelineno-1-253" name="__codelineno-1-253" href="#__codelineno-1-253"></a><span class="w">        </span>cv2.drawContours<span class="o">(</span>frame,<span class="w"> </span><span class="o">[</span>hull<span class="o">]</span>,<span class="w"> </span><span class="m">0</span>,<span class="w"> </span>color_cuad,<span class="w"> </span><span class="m">3</span><span class="o">)</span>
</span><span id="__span-1-254"><a id="__codelineno-1-254" name="__codelineno-1-254" href="#__codelineno-1-254"></a>
</span><span id="__span-1-255"><a id="__codelineno-1-255" name="__codelineno-1-255" href="#__codelineno-1-255"></a><span class="w">        </span>cv2.putText<span class="o">(</span>frame,<span class="w"> </span>f<span class="s1">&#39;{cuadrante_actual}&#39;</span>,<span class="w"> </span><span class="o">(</span><span class="m">10</span>,<span class="w"> </span><span class="m">30</span><span class="o">)</span>,<span class="w"> </span>font,<span class="w"> </span><span class="m">0</span>.7,<span class="w"> </span>color_cuad,<span class="w"> </span><span class="m">2</span><span class="o">)</span>
</span><span id="__span-1-256"><a id="__codelineno-1-256" name="__codelineno-1-256" href="#__codelineno-1-256"></a><span class="w">        </span>cv2.putText<span class="o">(</span>frame,<span class="w"> </span>f<span class="s1">&#39;X:{errorX_norm:+.2f}&#39;</span>,<span class="w"> </span><span class="o">(</span><span class="m">10</span>,<span class="w"> </span><span class="m">55</span><span class="o">)</span>,<span class="w"> </span>font,<span class="w"> </span><span class="m">0</span>.6,<span class="w"> </span><span class="o">(</span><span class="m">0</span>,255,0<span class="o">)</span>,<span class="w"> </span><span class="m">2</span><span class="o">)</span>
</span><span id="__span-1-257"><a id="__codelineno-1-257" name="__codelineno-1-257" href="#__codelineno-1-257"></a><span class="w">        </span>cv2.putText<span class="o">(</span>frame,<span class="w"> </span>f<span class="s1">&#39;Y:{errorY_norm:+.2f}&#39;</span>,<span class="w"> </span><span class="o">(</span><span class="m">10</span>,<span class="w"> </span><span class="m">80</span><span class="o">)</span>,<span class="w"> </span>font,<span class="w"> </span><span class="m">0</span>.6,<span class="w"> </span><span class="o">(</span><span class="m">0</span>,255,0<span class="o">)</span>,<span class="w"> </span><span class="m">2</span><span class="o">)</span>
</span><span id="__span-1-258"><a id="__codelineno-1-258" name="__codelineno-1-258" href="#__codelineno-1-258"></a><span class="w">        </span>cv2.putText<span class="o">(</span>frame,<span class="w"> </span>f<span class="s1">&#39;A:{int(mejor_area)}&#39;</span>,<span class="w"> </span><span class="o">(</span><span class="m">10</span>,<span class="w"> </span><span class="m">105</span><span class="o">)</span>,<span class="w"> </span>font,<span class="w"> </span><span class="m">0</span>.6,<span class="w"> </span><span class="o">(</span><span class="m">255</span>,255,0<span class="o">)</span>,<span class="w"> </span><span class="m">2</span><span class="o">)</span>
</span><span id="__span-1-259"><a id="__codelineno-1-259" name="__codelineno-1-259" href="#__codelineno-1-259"></a><span class="w">        </span>cv2.putText<span class="o">(</span>frame,<span class="w"> </span>f<span class="s1">&#39;PID: X{int(outputX)} Y{int(outputY)} Z{int(outputArea)}&#39;</span>,<span class="w"> </span>
</span><span id="__span-1-260"><a id="__codelineno-1-260" name="__codelineno-1-260" href="#__codelineno-1-260"></a><span class="w">                   </span><span class="o">(</span><span class="m">10</span>,<span class="w"> </span>frame.shape<span class="o">[</span><span class="m">0</span><span class="o">]</span>-30<span class="o">)</span>,<span class="w"> </span>font,<span class="w"> </span><span class="m">0</span>.5,<span class="w"> </span><span class="o">(</span><span class="m">0</span>,255,0<span class="o">)</span>,<span class="w"> </span><span class="m">2</span><span class="o">)</span>
</span><span id="__span-1-261"><a id="__codelineno-1-261" name="__codelineno-1-261" href="#__codelineno-1-261"></a><span class="w">    </span><span class="k">else</span>:
</span><span id="__span-1-262"><a id="__codelineno-1-262" name="__codelineno-1-262" href="#__codelineno-1-262"></a><span class="w">        </span>cv2.putText<span class="o">(</span>frame,<span class="w"> </span><span class="s1">&#39;NO BALL&#39;</span>,<span class="w"> </span><span class="o">(</span><span class="m">10</span>,<span class="w"> </span><span class="m">105</span><span class="o">)</span>,<span class="w"> </span>font,<span class="w"> </span><span class="m">0</span>.6,<span class="w"> </span><span class="o">(</span><span class="m">0</span>,0,255<span class="o">)</span>,<span class="w"> </span><span class="m">2</span><span class="o">)</span>
</span><span id="__span-1-263"><a id="__codelineno-1-263" name="__codelineno-1-263" href="#__codelineno-1-263"></a>
</span><span id="__span-1-264"><a id="__codelineno-1-264" name="__codelineno-1-264" href="#__codelineno-1-264"></a><span class="w">    </span><span class="c1"># 🔥 VENTANA 2: SLICERS</span>
</span><span id="__span-1-265"><a id="__codelineno-1-265" name="__codelineno-1-265" href="#__codelineno-1-265"></a><span class="w">    </span>frame_slicer.fill<span class="o">(</span><span class="m">20</span><span class="o">)</span>
</span><span id="__span-1-266"><a id="__codelineno-1-266" name="__codelineno-1-266" href="#__codelineno-1-266"></a><span class="w">    </span>dibujar_slicer<span class="o">(</span>frame_slicer,<span class="w"> </span><span class="m">100</span>,<span class="w"> </span>min_area,<span class="w"> </span><span class="s1">&#39;MIN_AREA&#39;</span>,<span class="w"> </span><span class="m">50</span>,<span class="w"> </span><span class="m">5000</span>,<span class="w"> </span><span class="o">(</span><span class="m">0</span>,255,0<span class="o">))</span>
</span><span id="__span-1-267"><a id="__codelineno-1-267" name="__codelineno-1-267" href="#__codelineno-1-267"></a><span class="w">    </span>dibujar_slicer<span class="o">(</span>frame_slicer,<span class="w"> </span><span class="m">135</span>,<span class="w"> </span>max_area,<span class="w"> </span><span class="s1">&#39;MAX_AREA&#39;</span>,<span class="w"> </span><span class="m">500</span>,<span class="w"> </span><span class="m">15000</span>,<span class="w"> </span><span class="o">(</span><span class="m">0</span>,150,255<span class="o">))</span>
</span><span id="__span-1-268"><a id="__codelineno-1-268" name="__codelineno-1-268" href="#__codelineno-1-268"></a>
</span><span id="__span-1-269"><a id="__codelineno-1-269" name="__codelineno-1-269" href="#__codelineno-1-269"></a><span class="w">    </span>cv2.circle<span class="o">(</span>frame_slicer,<span class="w"> </span><span class="o">(</span>mouse_x,<span class="w"> </span>mouse_y<span class="o">)</span>,<span class="w"> </span><span class="m">5</span>,<span class="w"> </span><span class="o">(</span><span class="m">255</span>,255,255<span class="o">)</span>,<span class="w"> </span>-1<span class="o">)</span>
</span><span id="__span-1-270"><a id="__codelineno-1-270" name="__codelineno-1-270" href="#__codelineno-1-270"></a>
</span><span id="__span-1-271"><a id="__codelineno-1-271" name="__codelineno-1-271" href="#__codelineno-1-271"></a><span class="w">    </span><span class="nv">font_slicer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>cv2.FONT_HERSHEY_SIMPLEX
</span><span id="__span-1-272"><a id="__codelineno-1-272" name="__codelineno-1-272" href="#__codelineno-1-272"></a><span class="w">    </span>cv2.putText<span class="o">(</span>frame_slicer,<span class="w"> </span>f<span class="s1">&#39;↑↓Rueda sobre slicers&#39;</span>,<span class="w"> </span><span class="o">(</span><span class="m">10</span>,<span class="w"> </span><span class="m">50</span><span class="o">)</span>,<span class="w"> </span>font_slicer,<span class="w"> </span><span class="m">0</span>.4,<span class="w"> </span><span class="o">(</span><span class="m">255</span>,255,0<span class="o">)</span>,<span class="w"> </span><span class="m">1</span><span class="o">)</span>
</span><span id="__span-1-273"><a id="__codelineno-1-273" name="__codelineno-1-273" href="#__codelineno-1-273"></a><span class="w">    </span>cv2.putText<span class="o">(</span>frame_slicer,<span class="w"> </span>f<span class="s1">&#39;A/Z:Min±100 S/X:Max±200&#39;</span>,<span class="w"> </span><span class="o">(</span><span class="m">10</span>,<span class="w"> </span><span class="m">75</span><span class="o">)</span>,<span class="w"> </span>font_slicer,<span class="w"> </span><span class="m">0</span>.4,<span class="w"> </span><span class="o">(</span><span class="m">255</span>,255,0<span class="o">)</span>,<span class="w"> </span><span class="m">1</span><span class="o">)</span>
</span><span id="__span-1-274"><a id="__codelineno-1-274" name="__codelineno-1-274" href="#__codelineno-1-274"></a><span class="w">    </span>cv2.putText<span class="o">(</span>frame_slicer,<span class="w"> </span>f<span class="s1">&#39;Rango: {min_area}-{max_area}&#39;</span>,<span class="w"> </span><span class="o">(</span><span class="m">10</span>,<span class="w"> </span><span class="m">180</span><span class="o">)</span>,<span class="w"> </span>font_slicer,<span class="w"> </span><span class="m">0</span>.5,<span class="w"> </span><span class="o">(</span><span class="m">0</span>,255,255<span class="o">)</span>,<span class="w"> </span><span class="m">2</span><span class="o">)</span>
</span><span id="__span-1-275"><a id="__codelineno-1-275" name="__codelineno-1-275" href="#__codelineno-1-275"></a>
</span><span id="__span-1-276"><a id="__codelineno-1-276" name="__codelineno-1-276" href="#__codelineno-1-276"></a><span class="w">    </span>cv2.imshow<span class="o">(</span>ventana_camera,<span class="w"> </span>frame<span class="o">)</span>
</span><span id="__span-1-277"><a id="__codelineno-1-277" name="__codelineno-1-277" href="#__codelineno-1-277"></a><span class="w">    </span>cv2.imshow<span class="o">(</span>ventana_slicer,<span class="w"> </span>frame_slicer<span class="o">)</span>
</span><span id="__span-1-278"><a id="__codelineno-1-278" name="__codelineno-1-278" href="#__codelineno-1-278"></a>
</span><span id="__span-1-279"><a id="__codelineno-1-279" name="__codelineno-1-279" href="#__codelineno-1-279"></a><span class="w">    </span><span class="nv">tecla</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>cv2.waitKey<span class="o">(</span><span class="m">1</span><span class="o">)</span><span class="w"> </span><span class="p">&amp;</span><span class="w"> </span>0xFF
</span><span id="__span-1-280"><a id="__codelineno-1-280" name="__codelineno-1-280" href="#__codelineno-1-280"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nv">tecla</span><span class="w"> </span><span class="o">==</span><span class="w"> </span>ord<span class="o">(</span><span class="s1">&#39;a&#39;</span><span class="o">)</span>:<span class="w"> </span><span class="nv">min_area</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>max<span class="o">(</span><span class="m">50</span>,<span class="w"> </span>min_area<span class="w"> </span>-<span class="w"> </span><span class="m">100</span><span class="o">)</span><span class="p">;</span><span class="w"> </span>print<span class="o">(</span>f<span class="s2">&quot;MIN_AREA: {min_area}&quot;</span><span class="o">)</span>
</span><span id="__span-1-281"><a id="__codelineno-1-281" name="__codelineno-1-281" href="#__codelineno-1-281"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nv">tecla</span><span class="w"> </span><span class="o">==</span><span class="w"> </span>ord<span class="o">(</span><span class="s1">&#39;z&#39;</span><span class="o">)</span>:<span class="w"> </span><span class="nv">min_area</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>min<span class="o">(</span><span class="m">5000</span>,<span class="w"> </span>min_area<span class="w"> </span>+<span class="w"> </span><span class="m">100</span><span class="o">)</span><span class="p">;</span><span class="w"> </span>print<span class="o">(</span>f<span class="s2">&quot;MIN_AREA: {min_area}&quot;</span><span class="o">)</span>
</span><span id="__span-1-282"><a id="__codelineno-1-282" name="__codelineno-1-282" href="#__codelineno-1-282"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nv">tecla</span><span class="w"> </span><span class="o">==</span><span class="w"> </span>ord<span class="o">(</span><span class="s1">&#39;s&#39;</span><span class="o">)</span>:<span class="w"> </span><span class="nv">max_area</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>max<span class="o">(</span><span class="m">500</span>,<span class="w"> </span>max_area<span class="w"> </span>-<span class="w"> </span><span class="m">200</span><span class="o">)</span><span class="p">;</span><span class="w"> </span>print<span class="o">(</span>f<span class="s2">&quot;MAX_AREA: {max_area}&quot;</span><span class="o">)</span>
</span><span id="__span-1-283"><a id="__codelineno-1-283" name="__codelineno-1-283" href="#__codelineno-1-283"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nv">tecla</span><span class="w"> </span><span class="o">==</span><span class="w"> </span>ord<span class="o">(</span><span class="s1">&#39;x&#39;</span><span class="o">)</span>:<span class="w"> </span><span class="nv">max_area</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>min<span class="o">(</span><span class="m">15000</span>,<span class="w"> </span>max_area<span class="w"> </span>+<span class="w"> </span><span class="m">200</span><span class="o">)</span><span class="p">;</span><span class="w"> </span>print<span class="o">(</span>f<span class="s2">&quot;MAX_AREA: {max_area}&quot;</span><span class="o">)</span>
</span><span id="__span-1-284"><a id="__codelineno-1-284" name="__codelineno-1-284" href="#__codelineno-1-284"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nv">tecla</span><span class="w"> </span><span class="o">==</span><span class="w"> </span>ord<span class="o">(</span><span class="s1">&#39;q&#39;</span><span class="o">)</span>:
</span><span id="__span-1-285"><a id="__codelineno-1-285" name="__codelineno-1-285" href="#__codelineno-1-285"></a><span class="w">        </span><span class="k">break</span>
</span><span id="__span-1-286"><a id="__codelineno-1-286" name="__codelineno-1-286" href="#__codelineno-1-286"></a>
</span><span id="__span-1-287"><a id="__codelineno-1-287" name="__codelineno-1-287" href="#__codelineno-1-287"></a><span class="c1"># Limpieza</span>
</span><span id="__span-1-288"><a id="__codelineno-1-288" name="__codelineno-1-288" href="#__codelineno-1-288"></a>arduino.write<span class="o">(</span>b<span class="s2">&quot;X:0,Y:0,Z:0\n&quot;</span><span class="o">)</span>
</span><span id="__span-1-289"><a id="__codelineno-1-289" name="__codelineno-1-289" href="#__codelineno-1-289"></a>time.sleep<span class="o">(</span><span class="m">0</span>.5<span class="o">)</span>
</span><span id="__span-1-290"><a id="__codelineno-1-290" name="__codelineno-1-290" href="#__codelineno-1-290"></a>cap.release<span class="o">()</span>
</span><span id="__span-1-291"><a id="__codelineno-1-291" name="__codelineno-1-291" href="#__codelineno-1-291"></a>arduino.close<span class="o">()</span>
</span><span id="__span-1-292"><a id="__codelineno-1-292" name="__codelineno-1-292" href="#__codelineno-1-292"></a>cv2.destroyAllWindows<span class="o">()</span>
</span><span id="__span-1-293"><a id="__codelineno-1-293" name="__codelineno-1-293" href="#__codelineno-1-293"></a>print<span class="o">(</span><span class="s2">&quot;✓ Sistema cerrado correctamente&quot;</span><span class="o">)</span>
</span><span id="__span-1-294"><a id="__codelineno-1-294" name="__codelineno-1-294" href="#__codelineno-1-294"></a>
</span><span id="__span-1-295"><a id="__codelineno-1-295" name="__codelineno-1-295" href="#__codelineno-1-295"></a><span class="w">    </span>Serial.println<span class="o">(</span><span class="s2">&quot;Recibido: &quot;</span><span class="w"> </span>+<span class="w"> </span>mensaje<span class="o">)</span><span class="p">;</span><span class="w">  </span>
</span><span id="__span-1-296"><a id="__codelineno-1-296" name="__codelineno-1-296" href="#__codelineno-1-296"></a><span class="w">  </span>delay<span class="o">(</span><span class="m">1000</span><span class="o">)</span><span class="p">;</span><span class="w">  </span>
</span><span id="__span-1-297"><a id="__codelineno-1-297" name="__codelineno-1-297" href="#__codelineno-1-297"></a><span class="o">}</span>
</span></code></pre></div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "..", "features": ["content.code.copy", "content.tooltips"], "search": "../assets/javascripts/workers/search.7a47a382.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.e71a0d61.min.js"></script>
      
    
  </body>
</html>